<!DOCTYPE HTML>
<!--
	MedCityAI - Real-time research analytics
	Article Overlay Page (No iframe)
-->
<html lang="en">
	<head>
		<title>MedCityAI - Article</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<meta property="og:site_name" content="MedCityAI" />
		<meta property="og:type" content="article" />
		<link rel="me" href="https://www.linkedin.com/company/medcityai/" />
		<meta property="article:publisher" content="https://www.linkedin.com/company/medcityai/" />

		<!-- Preconnect to Google Fonts for faster loading -->
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

		<!-- Load CSS asynchronously to prevent render blocking -->
		<link rel="stylesheet" href="assets/css/main.css" media="print" onload="this.media='all'">
		<link rel="stylesheet" href="assets/css/navigation.css" media="print" onload="this.media='all'">
		<noscript>
			<link rel="stylesheet" href="assets/css/main.css">
			<link rel="stylesheet" href="assets/css/navigation.css">
		</noscript>

		<!-- Load FontAwesome asynchronously (non-blocking) -->
		<link rel="stylesheet" href="assets/css/fontawesome-all.min.css" media="print" onload="this.media='all'">
		<noscript><link rel="stylesheet" href="assets/css/fontawesome-all.min.css"></noscript>

		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>

		<!-- Critical CSS - inline minimum styles for initial render -->
		<style>
		/* Basic layout to prevent layout shift */
		body {
			margin: 0;
			padding: 0;
			font-family: system-ui, -apple-system, "Segoe UI", "Helvetica Neue", Arial, sans-serif;
			background: #fff;
		}
		#page-wrapper {
			width: 100%;
		}
		.top-bar {
			background: #fff;
			box-shadow: 0 2px 4px rgba(0,0,0,0.1);
			position: fixed;
			top: 0;
			width: 100%;
			z-index: 1000;
		}

		/* Hero section */
		.hero-section {
			background: linear-gradient(120deg, #2568BE 0%, #1B4C7D 100%);
			min-height: 340px;
			display: flex;
			align-items: center;
			position: relative;
			overflow: hidden;
			z-index: 1;
			padding-top: 70px;
		}

		.hero-bg-blobs {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			z-index: 0;
			pointer-events: none;
			opacity: 1;
			transition: opacity 0.5s;
		}

		.hero-content {
			max-width: 1200px;
			margin: 0 auto;
			padding: 36px 20px;
			display: grid;
			grid-template-columns: 1fr;
			gap: 60px;
			align-items: center;
			position: relative;
			z-index: 2;
			width: 100%;
		}

		.hero-left h1 {
			font-size: 3em;
			font-weight: 800;
			color: #2c3e50;
			margin-bottom: 24px;
			line-height: 1.1;
			text-shadow: 0 2px 8px rgba(0,0,0,0.1);
		}

		.hero-left p {
			font-size: 1.1em;
			color: #34495e;
			margin-bottom: 36px;
			line-height: 1.7;
		}

		/* Hero Buttons */
		.hero-buttons {
			display: flex;
			gap: 8px;
			flex-wrap: nowrap;
			margin-top: 32px;
			width: 100%;
		}

		.hero-btn {
			display: inline-flex;
			align-items: center;
			justify-content: center;
			gap: 6px;
			padding: 10px 16px;
			border-radius: 50px;
			font-weight: 600;
			font-size: 13px;
			border: none;
			cursor: pointer;
			transition: all 0.3s ease;
			box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
			white-space: nowrap;
			flex: 1;
		}

		.hero-btn i {
			font-size: 13px;
		}

		.hero-btn-primary {
			background: linear-gradient(135deg, #3498db, #2980b9);
			color: white;
		}

		.hero-btn-primary:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
		}

		.hero-btn-secondary {
			background: rgba(255, 255, 255, 0.95);
			color: #2c3e50;
			border: 2px solid rgba(52, 152, 219, 0.3);
		}

		.hero-btn-secondary:hover {
			background: white;
			border-color: #3498db;
			transform: translateY(-2px);
			box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
		}

		/* Responsive design */
		@media (max-width: 900px) {
			.hero-content {
				grid-template-columns: 1fr;
				gap: 40px;
				text-align: center;
			}
			.hero-left h1 { font-size: 2.4em; }
			.hero-left p { font-size: 1.1em; }
			.nav-links {
				display: none !important;
			}
			.menu-icon {
				display: flex !important;
			}
		}

		@media (max-width: 600px) {
			.hero-section {
				min-height: 240px;
				display: flex;
				align-items: center;
				justify-content: center;
			}
			.hero-content {
				padding: 24px 15px 16px 15px;
				text-align: center;
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				width: 100%;
			}
			.hero-left {
				text-align: center;
				max-width: 100%;
			}
			.hero-left h1 { 
				font-size: 2em;
				margin: 0;
			}
			.hero-left p { 
				font-size: 1em;
				margin: 10px 0 0 0;
			}
		}

		/* Skip to main content link */
		.skip-link {
			position: absolute;
			top: -50px;
			left: 10px;
			background: #3498db;
			color: white;
			padding: 10px 20px;
			text-decoration: none;
			z-index: 10001;
			font-weight: 600;
			border-radius: 0 0 8px 8px;
			transition: top 0.3s;
		}

		.skip-link:focus {
			top: 0;
		}

		/* Enhanced focus styles for keyboard navigation */
		*:focus {
			outline: 3px solid #3498db;
			outline-offset: 2px;
		}

		a:focus {
			outline: 3px solid #3498db;
			outline-offset: 3px;
		}

		button:focus {
			outline: 3px solid #3498db;
			outline-offset: 3px;
		}

		/* Article Overlay Styles */
		.article-overlay-background {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(8, 15, 30, 0.65);
			z-index: 9998;
			backdrop-filter: blur(3px);
		}

		.article-overlay-background.active {
			display: block;
		}

		.article-overlay-container {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			z-index: 9999;
			display: none;
			align-items: center;
			justify-content: center;
			padding: 20px;
			box-sizing: border-box;
		}

		.article-overlay-container.active {
			display: flex;
		}

		.article-overlay-wrapper {
			position: relative;
			width: 100%;
			max-width: 980px;
			height: 90vh;
			background: #fff;
			border-radius: 12px;
			box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
			overflow: hidden;
			border: 1px solid rgba(0,0,0,0.06);
			display: flex;
			flex-direction: column;
		}

		.article-overlay-close {
			position: absolute;
			top: 12px;
			right: 14px;
			font-size: 22px;
			color: #6b7785;
			background: transparent;
			border: none;
			cursor: pointer;
			font-weight: 600;
			width: 24px;
			height: 24px;
			line-height: 24px;
			padding: 0;
			box-shadow: none;
			z-index: 10000;
		}

		.article-overlay-content {
			overflow-y: auto;
			padding: 70px 28px 30px 28px;
			position: relative;
			flex: 1;
		}

		.article-overlay-logo {
			position: absolute;
			top: 20px;
			left: 28px;
			width: 180px;
			opacity: 0.9;
			z-index: 2;
			display: inline-block;
		}

		.article-overlay-logo img {
			display: block;
			width: 100%;
			height: auto;
		}

		.article-overlay-content::before {
			content: '';
			position: absolute;
			right: -40px;
			top: -30px;
			width: 540px;
			height: 540px;
			background: url('images/medcityai_simple1.png') no-repeat;
			background-size: 540px 540px;
			opacity: 0.1;
			pointer-events: none;
			z-index: 0;
		}

		.article-overlay-title {
			font-size: 26px;
			line-height: 1.3;
			margin: 0 0 10px 0;
			color: #1f2d3d;
			font-weight: 800;
		}

		.article-overlay-authors-line {
			font-size: 17px;
			line-height: 1.7;
			color: #1f2d3d;
			margin: 10px 0 16px 0;
			font-weight: 500;
		}

		.roch-author {
			position: relative;
			color: #0b6b8a;
			font-weight: 500;
			text-decoration: underline dotted;
			text-underline-offset: 3px;
			cursor: pointer;
		}

		.roch-tooltip {
			position: absolute;
			left: 0;
			top: calc(100% + 8px);
			width: 280px;
			max-width: 70vw;
			background: #ffffff;
			border: 1px solid #d7dde3;
			border-radius: 10px;
			box-shadow: 0 12px 28px rgba(0, 0, 0, 0.18);
			padding: 10px 12px;
			font-size: 11px;
			line-height: 1.4;
			color: #1f2d3d;
			opacity: 0;
			visibility: hidden;
			transform: translateY(6px);
			transition: all 0.2s ease;
			z-index: 10000;
		}

		.roch-tooltip h5 {
			margin: 0 0 6px 0;
			font-size: 10px;
			color: #0b6b8a;
			font-weight: 700;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}

		.roch-tooltip ul {
			margin: 0 0 0 16px;
			padding: 0;
		}

		.roch-tooltip li {
			margin-bottom: 5px;
			font-size: 11px;
		}

		.article-overlay-meta {
			color: #4a5b6a;
			font-size: 14px;
			margin-bottom: 14px;
		}

		.article-overlay-spacer {
			height: 12px;
		}

		.article-overlay-section {
			margin-bottom: 22px;
			position: relative;
			z-index: 1;
		}

		.article-overlay-section h3 {
			font-size: 16px;
			margin: 0 0 10px 0;
			color: #1f2d3d;
			font-weight: 700;
		}

		.article-overlay-badges {
			display: flex;
			flex-wrap: wrap;
			gap: 8px;
		}

		.article-overlay-badge {
			background: #e9f0f8;
			color: #1565c0;
			font-weight: 700;
			padding: 6px 10px;
			border-radius: 14px;
			font-size: 12px;
		}

		.article-overlay-block {
			background: #f8fafc;
			border: 1px solid #e6edf3;
			border-radius: 10px;
			padding: 16px;
			line-height: 1.6;
			color: #2f3b4a;
		}

		.article-overlay-ai {
			background: #f8fafc;
			border: 1px solid #e6edf3;
			border-radius: 10px;
			padding: 16px;
			line-height: 1.6;
			color: #3a2f1b;
		}

		.article-overlay-disclaimer {
			margin-top: 12px;
			font-size: 12px;
			color: #000;
			background: #fafbfc;
			border-left: 3px solid #d0d7de;
			padding: 10px;
			border-radius: 6px;
		}

		.article-overlay-about {
			margin-top: 18px;
			background: #f6f4ef;
			border: 1px solid #e6dbcc;
			border-left: 4px solid #c08a2c;
			border-radius: 10px;
			padding: 14px 16px;
			color: #3a2f1b;
			font-size: 13px;
			line-height: 1.6;
		}

		.article-overlay-about h4 {
			margin: 0 0 8px 0;
			font-size: 13px;
			letter-spacing: 0.6px;
			text-transform: uppercase;
			color: #7a4f12;
			font-weight: 800;
		}

		.article-overlay-actions {
			display: flex;
			flex-wrap: wrap;
			gap: 12px;
			align-items: center;
			margin-top: 18px;
		}

		.article-overlay-actions a,
		.article-overlay-actions button {
			display: inline-flex;
			align-items: center;
			gap: 8px;
			padding: 10px 16px;
			border-radius: 20px;
			border: 1px solid #d7dde3;
			background: #fff;
			color: #1f2d3d;
			font-weight: 600;
			text-decoration: none;
			cursor: pointer;
			font-size: 14px;
		}

		.article-overlay-actions .overlay-primary {
			background: #0056a3;
			color: #fff;
			border-color: #0056a3;
		}

		.article-overlay-actions .overlay-linkedin {
			background: #0a66c2;
			color: #fff;
			border-color: #0a66c2;
		}

		.article-overlay-blurb {
			font-size: 13px;
			color: #5b6b7a;
			margin: 12px 0 0 0;
		}

		@media (max-width: 768px) {
			.article-overlay-wrapper {
				height: 92vh;
			}
			.article-overlay-title {
				font-size: 20px;
			}
			.article-overlay-actions {
				flex-direction: column;
				align-items: stretch;
			}
			.article-overlay-actions a,
			.article-overlay-actions button {
				justify-content: center;
				width: 100%;
			}
		}
		</style>
	</head>
	<body class="landing is-preload">
		<!-- Skip to main content link for keyboard users -->
		<a href="#footer" class="skip-link">Skip to footer</a>

		<!-- Article Overlay -->
		<div class="article-overlay-background" id="articleOverlayBackground"></div>
		<div class="article-overlay-container" id="articleOverlayContainer" role="dialog" aria-modal="true" aria-labelledby="articleOverlayTitle" aria-hidden="true">
			<div class="article-overlay-wrapper" role="document">
				<button class="article-overlay-close" id="articleOverlayClose" type="button" aria-label="Close article">&times;</button>
				<div class="article-overlay-content" id="articleOverlayContent"></div>
			</div>
		</div>

		<!-- Page Wrapper -->
		<div id="page-wrapper">
			<!-- Modern Medical Navigation Header -->
			<div id="navigation-placeholder"></div>

			<!-- Hero Section -->
			<section class="hero-section" aria-label="Hero banner" style="position:relative; overflow:hidden;">
				<!-- Animated SVG background blobs -->
				<svg class="hero-bg-blobs" width="100%" height="900" viewBox="0 0 1440 900" style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;" aria-hidden="true" role="presentation">
					<defs>
						<linearGradient id="blobGradient1" x1="0" y1="0" x2="1" y2="1">
							<stop offset="0%" stop-color="#3498db" stop-opacity="0.18"/>
							<stop offset="100%" stop-color="#b6c7e0" stop-opacity="0.12"/>
						</linearGradient>
						<linearGradient id="blobGradient2" x1="0" y1="1" x2="1" y2="0">
							<stop offset="0%" stop-color="#e3eaf3" stop-opacity="0.16"/>
							<stop offset="100%" stop-color="#2980b9" stop-opacity="0.10"/>
						</linearGradient>
					</defs>
					<g>
						<circle id="blob1" cx="330" cy="220" r="330" fill="url(#blobGradient1)">
							<animate attributeName="cx" values="330;1110;330" dur="15s" repeatCount="indefinite"/>
							<animate attributeName="cy" values="220;680;220" dur="13.125s" repeatCount="indefinite"/>
						</circle>
						<circle id="blob2" cx="270" cy="180" r="270" fill="url(#blobGradient2)">
							<animate attributeName="cx" values="270;1170;270" dur="16.875s" repeatCount="indefinite"/>
							<animate attributeName="cy" values="180;720;180" dur="11.25s" repeatCount="indefinite"/>
						</circle>
						<circle id="blob3" cx="450" cy="450" r="450" fill="url(#blobGradient1)" opacity="0.7">
							<animate attributeName="cx" values="450;990;450" dur="18.75s" repeatCount="indefinite"/>
							<animate attributeName="cy" values="450;850;450" dur="15s" repeatCount="indefinite"/>
						</circle>
					</g>
				</svg>
				<div class="hero-content">
					<div class="hero-left">
						<h1 style="color:#fff; text-shadow: 0 4px 18px rgba(0,0,0,0.28);">What's New in Rochester?</h1>
						<p style="color:#e0e0e0;">Real-time biomedical research feed for Rochester, Minnesota. All information sourced from the National Library of Medicine, PubMed.</p>

						<!-- Hero Action Buttons -->
						<div class="hero-buttons">
							<a href="index_share.html" class="hero-btn hero-btn-primary">
								<i class="fas fa-arrow-left"></i> Back to Share Page
							</a>
							<a href="index.html" class="hero-btn hero-btn-secondary">
								<i class="fas fa-home"></i> Full Index
							</a>
							<a href="search.html" class="hero-btn hero-btn-secondary">
								<i class="fas fa-search"></i> Search
							</a>
						</div>
					</div>
				</div>
			</section>

			<!-- Footer -->
			<footer id="footer">
				<ul class="icons">
					<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
					<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
					<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
					<li><a href="#" class="icon brands fa-dribbble"><span class="label">Dribbble</span></a></li>
					<li><a href="#" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
				</ul>
				<ul class="copyright">
					<li>&copy; MedCityAI</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li><li><a href="terms_of_use.html" style="color: #999;">Terms</a> | <a href="privacy_policy.html" style="color: #999;">Privacy</a> | <a href="cookie_policy.html" style="color: #999;">Cookies</a></li>
				</ul>
			</footer>
		</div>

		<!-- Scripts -->
		<script src="assets/js/jquery.min.js" defer></script>
		<script src="assets/js/jquery.scrollex.min.js" defer></script>
		<script src="assets/js/jquery.scrolly.min.js" defer></script>
		<script src="assets/js/browser.min.js" defer></script>
		<script src="assets/js/breakpoints.min.js" defer></script>
		<script src="assets/js/util.js" defer></script>
		<script src="assets/js/main.js" defer></script>
		<script src="assets/js/navigation.js" defer></script>

		<script>
		let allArticlesData = [];

		function parseCSVLine(line) {
			const result = [];
			let current = '';
			let inQuotes = false;
			let i = 0;
			while (i < line.length) {
				const char = line[i];
				if (char === '"') {
					if (inQuotes && i + 1 < line.length && line[i + 1] === '"') {
						current += '"';
						i += 2;
						continue;
					}
					inQuotes = !inQuotes;
				} else if (char === ',' && !inQuotes) {
					result.push(current.replace(/^"|"$/g, '').trim());
					current = '';
				} else {
					current += char;
				}
				i++;
			}
			result.push(current.replace(/^"|"$/g, '').trim());
			return result;
		}

		function escapeHtml(text) {
			if (!text) return '';
			const div = document.createElement('div');
			div.textContent = text;
			return div.innerHTML;
		}

		function escapeAttr(text) {
			return escapeHtml(text).replace(/"/g, '&quot;');
		}

		function formatAuthors(authorsRaw, rochRaw) {
			const cleaned = (authorsRaw || '').replace(/\|/g, ', ');
			const parts = cleaned.split(',').map(a => a.trim()).filter(Boolean);
			if (parts.length === 0) return 'Authors not available';

			const rochSet = new Set((rochRaw || '').split('|').map(a => a.trim()).filter(Boolean));

			return parts.map(name => {
				if (rochSet.has(name)) {
					const safeName = escapeHtml(name);
					const safeAttr = escapeAttr(name);
					return `<span class="roch-author" data-author="${safeAttr}" tabindex="0" role="link" aria-label="Search for ${safeName}">${safeName}<span class="roch-tooltip" aria-hidden="true">Loading recent works...</span></span>`;
				}
				return escapeHtml(name);
			}).join(', ');
		}

		function getArticleDate(article) {
			const monthNames = ["", "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
			const year = parseInt(article.year, 10);
			const month = monthNames.indexOf(article.month || '');
			const day = parseInt(article.day, 10) || 1;
			if (!year || month < 1) return new Date(0);
			return new Date(year, month - 1, day);
		}

		function getRecentWorksForAuthor(authorName) {
			if (!authorName || allArticlesData.length === 0) return [];
			const authorLower = authorName.toLowerCase();

			const matches = allArticlesData.filter(article => {
				const authorsDisplay = (article.authors_display || '').toLowerCase();
				const authorsList = (article.authors || '').split('|').map(a => a.trim().toLowerCase());
				return authorsDisplay.includes(authorLower) || authorsList.includes(authorLower);
			});

			matches.sort((a, b) => getArticleDate(b) - getArticleDate(a));
			return matches.slice(0, 3);
		}

		function populateAuthorTooltip(target) {
			if (!target || target.dataset.tooltipLoaded === 'true') return;
			const tooltip = target.querySelector('.roch-tooltip');
			if (!tooltip) return;

			const authorName = target.getAttribute('data-author') || target.textContent || '';
			const works = getRecentWorksForAuthor(authorName);
			let listHtml = '<p style="margin:0;">No recent works found.</p>';

			if (works.length > 0) {
				const items = works.map(work => {
					const title = escapeHtml(work.title || 'Untitled');
					return `<li>${title}</li>`;
				}).join('');
				listHtml = `<h5>Recent works</h5><ul>${items}</ul>`;
			}

			tooltip.innerHTML = listHtml;
			target.dataset.tooltipLoaded = 'true';
		}

		function typewriterEffect(element, text, speed = 100) {
			if (!element) return Promise.resolve();
			
			// Measure the full text size
			const measurement = document.createElement('div');
			measurement.style.visibility = 'hidden';
			measurement.style.position = 'absolute';
			measurement.style.pointerEvents = 'none';
			measurement.textContent = text;
			document.body.appendChild(measurement);
			
			// Copy relevant styles
			const styles = window.getComputedStyle(element);
			['fontSize', 'fontFamily', 'lineHeight', 'width', 'whiteSpace', 'fontWeight', 'letterSpacing'].forEach(prop => {
				measurement.style[prop] = styles[prop];
			});
			
			// Get the full height
			const fullHeight = measurement.offsetHeight;
			measurement.remove();
			
			// Set container to full size immediately
			element.style.minHeight = fullHeight + 'px';
			element.textContent = '';
			
			return new Promise(resolve => {
				let index = 0;
				const interval = setInterval(() => {
					if (index < text.length) {
						element.textContent += text.charAt(index);
						index++;
					} else {
						clearInterval(interval);
						element.style.minHeight = '';
						resolve();
					}
				}, speed);
			});
		}

		function getLastTwoSentences(text) {
			if (!text) return '';
			const sentences = text.match(/[^.!?]+[.!?]+/g) || [];
			if (sentences.length === 0) return text.substring(0, 150) + '...';
			return sentences.slice(-2).join(' ').trim();
		}

		function buildOverlayHTML(article) {
			const title = (article.title || 'Untitled').replace(/\.[\s]*$/, '');
			const authorsRaw = article.authors_display || article.authors || '';
			const formattedAuthors = formatAuthors(authorsRaw, article.rochester_authors || '');
			const journal = article.journal || 'Unknown Journal';
			const pubdate = article.pubdate || 'Unknown Date';
			const abstract = article.abstract || '';
			const llmSummary = article.llm_summary || '';
			const url = article.url || (article.pmid ? `https://pubmed.ncbi.nlm.nih.gov/${article.pmid}/` : '#');
			const primarySpecialty = article.primary_specialty || '';
			const secondarySpecialty = article.secondary_specialty || '';
			const pmid = article.pmid || '';

			const pubmedUrlWithUtm = url.includes('?')
				? `${url}&utm_source=linkedin&utm_medium=share&utm_campaign=medcityai_share`
				: `${url}?utm_source=linkedin&utm_medium=share&utm_campaign=medcityai_share`;

			const shareText = `New research worth noting:\n\n${getLastTwoSentences(llmSummary || abstract)}\n\n${pubmedUrlWithUtm}\nhttps://medcityai.com\n@MedCityAI`;

			return `
				<a class="article-overlay-logo" href="index.html" aria-label="Back to index">
					<img src="images/medcityai_logo1.png" alt="MedCityAI logo" />
				</a>
				<div class="article-overlay-section">
					<div class="article-overlay-spacer"></div>
					<h2 class="article-overlay-title" id="articleOverlayTitle">${escapeHtml(title)}</h2>
					<div class="article-overlay-authors-line">${formattedAuthors}</div>
					<div class="article-overlay-meta">${escapeHtml(journal)} · ${escapeHtml(pubdate)} · PMID ${escapeHtml(pmid)}</div>
					<div class="article-overlay-spacer"></div>
				</div>
				${llmSummary && llmSummary !== 'No abstract available.' ? `
				<div class="article-overlay-section">
					<h3>Research Spotlight</h3>
					<div class="article-overlay-ai">
						<div id="llmSummaryText"></div>
						<div class="article-overlay-disclaimer">
							<strong>AI Disclaimer:</strong> This summary was generated by AI and may contain inaccuracies. Refer to the full publication for accurate information. <a href="${pubmedUrlWithUtm}" target="_blank" rel="noopener" style="color: #0969da; text-decoration: underline;">View on PubMed</a>
						</div>
					</div>
				</div>
				` : `
				<div class="article-overlay-section">
					<h3>Abstract</h3>
					<div class="article-overlay-block">${escapeHtml(abstract || 'No abstract available.')}</div>
				</div>
				`}
				<div class="article-overlay-section">
					<div class="article-overlay-actions">
						<a class="overlay-primary" href="${url}" target="_blank" rel="noopener" aria-label="View on PubMed">
							<i class="fas fa-external-link-alt"></i> View on PubMed
						</a>
						<button class="overlay-linkedin" type="button" onclick="shareOverlayOnLinkedIn('${encodeURIComponent(shareText)}', '${encodeURIComponent(pubmedUrlWithUtm)}')">
							<i class="fab fa-linkedin"></i> Share on LinkedIn
						</button>
						<button type="button" onclick="copyOverlayShareText('${escapeHtml(shareText).replace(/'/g, "\\'")}')">
							<i class="fas fa-copy"></i> Copy Share Text
						</button>
					</div>
					<p class="article-overlay-blurb">MedCityAI is a Rochester, MN research platform to celebrate local research progress.</p>
					<div class="article-overlay-about">
						<h4>About MedCityAI</h4>
						<p>MedCityAI is a platform for celebrating research in Rochester, Minnesota. This platform curates recent biomedical publications and provides AI-generated summaries to make discoveries easier to understand and share.</p>
					</div>
				</div>
			`;
		}

		function showOverlay() {
			const overlayBg = document.getElementById('articleOverlayBackground');
			const overlayContainer = document.getElementById('articleOverlayContainer');
			const overlayContent = document.getElementById('articleOverlayContent');
			overlayBg.classList.add('active');
			overlayContainer.classList.add('active');
			overlayContainer.setAttribute('aria-hidden', 'false');
			overlayContent.scrollTop = 0;
			document.body.style.overflow = 'hidden';
		}

		function closeOverlay() {
			window.location.href = 'index.html';
		}

		async function loadArticleById(pmid) {
			const overlayContent = document.getElementById('articleOverlayContent');
			try {
				const response = await fetch('pubmed_data.csv');
				if (!response.ok) throw new Error('CSV not found');
				const csvText = await response.text();
				const lines = csvText.split('\n');
				if (lines.length < 2) throw new Error('CSV empty');

				const headers = lines[0].split(',').map(h => h.trim().replace(/^"|"$/g, ''));
				let found = null;
				allArticlesData = [];

				for (let i = 1; i < lines.length; i++) {
					if (!lines[i].trim()) continue;
					const row = parseCSVLine(lines[i]);
					if (row.length !== headers.length) continue;
					const article = {};
					headers.forEach((header, index) => {
						article[header] = row[index];
					});
					allArticlesData.push(article);
					if (!found && article.pmid && article.pmid.trim() === pmid) {
						found = article;
					}
				}

				if (!found) {
					overlayContent.innerHTML = '<div class="article-overlay-section"><h2 class="article-overlay-title" id="articleOverlayTitle">Article not found</h2><p class="article-overlay-meta">The requested article could not be located.</p></div>';
					return;
				}

				overlayContent.innerHTML = buildOverlayHTML(found);
				
				// Trigger typewriter effect for LLM summary
				if (found.llm_summary && found.llm_summary !== 'No abstract available.') {
					const summaryElement = overlayContent.querySelector('#llmSummaryText');
					if (summaryElement) {
						setTimeout(() => {
							typewriterEffect(summaryElement, found.llm_summary, 5);
						}, 100);
					}
				}
			} catch (error) {
				overlayContent.innerHTML = '<div class="article-overlay-section"><h2 class="article-overlay-title" id="articleOverlayTitle">Unable to load article</h2><p class="article-overlay-meta">Please try again later.</p></div>';
				console.error('Error loading article:', error);
			}
		}

		function shareOverlayOnLinkedIn(shareText, pubmedUrl) {
			const text = decodeURIComponent(shareText);
			navigator.clipboard.writeText(text).catch(() => {
				prompt('Copy this text to share on LinkedIn:', text);
			});
			window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${pubmedUrl}`, '_blank');
		}

		function copyOverlayShareText(text) {
			const cleanText = text.replace(/\\'/g, "'");
			navigator.clipboard.writeText(cleanText).then(() => {
				alert('Share text copied to clipboard!');
			}).catch(() => {
				prompt('Copy this text:', cleanText);
			});
		}

		document.addEventListener('DOMContentLoaded', function() {
			const overlayBg = document.getElementById('articleOverlayBackground');
			const overlayClose = document.getElementById('articleOverlayClose');
			const pmid = new URL(window.location.href).searchParams.get('id');

			if (overlayBg) {
				overlayBg.addEventListener('click', closeOverlay);
			}
			if (overlayClose) {
				overlayClose.addEventListener('click', closeOverlay);
			}
			document.addEventListener('keydown', function(e) {
				if (e.key === 'Escape') {
					closeOverlay();
				}
			});

			document.addEventListener('click', function(e) {
				const target = e.target.closest('.roch-author');
				if (target) {
					e.preventDefault();
					e.stopPropagation();
					const authorName = target.getAttribute('data-author') || target.textContent || '';
					if (authorName) {
						window.location.href = `search.html?q=${encodeURIComponent(authorName)}`;
					}
				}
			});

			document.addEventListener('keydown', function(e) {
				if ((e.key === 'Enter' || e.key === ' ') && e.target && e.target.closest('.roch-author')) {
					e.preventDefault();
					const target = e.target.closest('.roch-author');
					const authorName = target.getAttribute('data-author') || target.textContent || '';
					if (authorName) {
						window.location.href = `search.html?q=${encodeURIComponent(authorName)}`;
					}
				}
			});

			showOverlay();
			if (pmid) {
				loadArticleById(pmid.trim());
			} else {
				const overlayContent = document.getElementById('articleOverlayContent');
				overlayContent.innerHTML = '<div class="article-overlay-section"><h2 class="article-overlay-title" id="articleOverlayTitle">No article selected</h2><p class="article-overlay-meta">Return to the share page to pick an article.</p></div>';
			}
		});
		</script>
	</body>
</html>
