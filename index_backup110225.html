<!DOCTYPE HTML>
<!--
	MedCityAI - Real-time research analytics
-->
<html lang="en">
	<head>
		<title>Med City AI - Rochester MN Biomedical Research</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
		<style>
		/* Modal for abstracts */
		.modal-bg {
			display: none;
			position: fixed;
			top: 0; left: 0; width: 100vw; height: 100vh;
			background: rgba(0,0,0,0.5);
			z-index: 3000;
			justify-content: center;
			align-items: center;
		}
		.modal-content {
			background: #fff;
			border-radius: 10px;
			max-width: 600px;
			width: 90vw;
			max-height: 80vh;
			overflow-y: auto;
			padding: 32px 24px 24px 24px;
			box-shadow: 0 4px 24px rgba(0,0,0,0.18);
			position: relative;
		}
		.modal-close {
			position: absolute;
			top: 12px;
			right: 18px;
			font-size: 22px;
			color: #333;
			cursor: pointer;
			font-weight: bold;
		}
		.modal-abstract {
			margin-top: 18px;
			font-size: 15px;
			color: #222;
			line-height: 1.6;
		}
		.modal-abstract h4 {
			color: #0056a3;
			margin-top: 15px;
			margin-bottom: 10px;
			font-size: 16px;
		}
		.modal-abstract strong {
			color: #333;
		}

		/* Research results grid */
		.results {
			max-width: 1200px;
			margin: 40px auto;
			padding: 0 20px;
			column-count: 3;
			column-gap: 20px;
		}
		.result-item {
			background: transparent;
			border-radius: 10px;
			margin: 0 0 20px;
			display: inline-block;
			width: 100%;
			box-sizing: border-box;
			position: relative;
			perspective: 1000px;
			min-height: 200px;
		}
		
	.card-flip-container {
		position: relative;
		width: 100%;
		min-height: 100%;
		transition: transform 0.6s;
		transform-style: preserve-3d;
	}
	
	.card-flip-container.flipped {
		transform: rotateY(180deg);
	}
	
	.card-face {
		width: 100%;
		backface-visibility: hidden;
		-webkit-backface-visibility: hidden;
		border-radius: 10px;
		padding: 20px;
		box-shadow: 0 4px 12px rgba(0,0,0,0.15);
		background: #fff;
		box-sizing: border-box;
	}
	
	.card-front {
		position: relative;
		z-index: 2;
		cursor: pointer;
		overflow: hidden;
	}
	
	.card-back {
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		transform: rotateY(180deg);
		background: linear-gradient(135deg, #f0f7ff 0%, #e3f2fd 100%);
		border: 2px solid #2196f3;
		display: flex;
		flex-direction: column;
		overflow: hidden;
		z-index: 3;
	}
	
	.card-back::before {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: linear-gradient(135deg, #f0f7ff 0%, #e3f2fd 100%);
		z-index: -1;
	}
	
	.card-back-header {
		display: flex;
		align-items: center;
		margin-bottom: 12px;
		padding-bottom: 12px;
		border-bottom: 2px solid #2196f3;
		flex-shrink: 0;
		cursor: pointer;
	}
		
	.card-back-content {
		flex: 1;
		display: flex;
		flex-direction: column;
		overflow-y: auto;
		overflow-x: hidden;
		padding-right: 5px;
		position: relative;
		-webkit-overflow-scrolling: touch;
		touch-action: pan-y;
		cursor: default;
	}
	
	.card-back-content::after {
		content: '';
		position: sticky;
		bottom: 0;
		left: 0;
		right: 0;
		height: 30px;
		background: linear-gradient(to bottom, transparent, rgba(227, 242, 253, 0.9));
		pointer-events: none;
		z-index: 1;
	}
	
	.card-back-content::-webkit-scrollbar {
		width: 6px;
	}
	
	.card-back-content::-webkit-scrollbar-track {
		background: rgba(33, 150, 243, 0.1);
		border-radius: 3px;
	}
	
	.card-back-content::-webkit-scrollbar-thumb {
		background: #2196f3;
		border-radius: 3px;
	}
	
	.card-back-content::-webkit-scrollbar-thumb:hover {
		background: #1976d2;
	}
	
	.card-back-summary {
		flex: 1;
		line-height: 1.7;
		color: #1a237e;
		font-size: 15px;
		margin-bottom: 12px;
		touch-action: pan-y;
	}		.card-back-disclaimer {
			padding-top: 12px;
			border-top: 1px solid #bbdefb;
			margin-top: auto;
			flex-shrink: 0;
		}
		
	.flip-instruction {
		text-align: center;
		font-size: 12px;
		color: #999;
		margin-top: 8px;
		font-style: italic;
		flex-shrink: 0;
		cursor: pointer;
	}		.new-tab {
			position: absolute;
			top: 0;
			left: 0;
			background: #e74c3c;
			color: #fff;
			font-size: 12px;
			font-weight: bold;
			padding: 4px 12px;
			border-radius: 8px 0 8px 0;
			z-index: 10;
			pointer-events: none; /* Prevent blocking clicks */
		}
		
		.department-badge {
			position: absolute;
			top: 8px;
			right: 8px;
			background: transparent;
			color: #2c3e50;
			font-size: 11px;
			font-weight: 500;
			font-style: italic;
			padding: 4px 10px;
			border-radius: 4px;
			z-index: 10;
			max-width: 200px;
			text-align: right;
			line-height: 1.3;
			pointer-events: none; /* Prevent blocking clicks */
		}
		
		/* Department filter links */
		.dept-filter-link {
			display: inline-block;
			cursor: pointer;
		}
		.dept-filter-link:hover {
			color: #fff !important;
			background: rgba(255, 255, 255, 0.1);
			border-radius: 4px;
		}
		.dept-filter-link.active {
			color: #fff !important;
			background: rgba(255, 255, 255, 0.2);
			border-radius: 4px;
			font-weight: 600;
		}
		
		/* Filter bar below header */
		.filter-bar {
			background: #f5f5f5;
			border-bottom: 2px solid #e0e0e0;
			padding: 20px 0 20px 0;
			box-shadow: 0 2px 8px rgba(0,0,0,0.1);
		}
		
		.filter-bar-content {
			max-width: 1200px;
			margin: 0 auto;
			padding: 0 20px;
		}
		
		.filter-bar-content #pubmed-results {
			background: #f5f5f5;
			padding: 20px 0;
			margin-top: 0;
			border-radius: 0;
			box-shadow: none;
		}
		
		/* Add side padding only on mobile */
		@media (max-width: 768px) {
			.filter-bar-content #pubmed-results {
				padding: 20px 20px;
			}
		}
		
		.filter-bar-title {
			color: #2c3e50;
			font-size: 14px;
			font-weight: 600;
			margin-bottom: 12px;
		}
		
		.filter-bar-links {
			display: flex;
			flex-wrap: wrap;
			gap: 8px;
			align-items: center;
		}
		
		.filter-bar .dept-filter-link {
			color: #555;
			text-decoration: none;
			font-size: 14px;
			padding: 6px 12px;
			transition: all 0.2s;
			border-radius: 4px;
		}
		
		.filter-bar .dept-filter-link:hover {
			background: #f5f5f5;
			color: #2c3e50;
		}
		
		.filter-bar .dept-filter-link.active {
			color: #fff !important;
			background: #3498db;
		}
		
		.filter-bar-links span {
			color: #ccc;
		}
		
		/* Sidebar Filter */
		.sidebar-filter {
			width: 160px;
			background: white;
			border: 1px solid #ddd;
			border-radius: 8px;
			padding: 16px 12px;
			box-shadow: 0 2px 8px rgba(0,0,0,0.1);
		}
		
		.sidebar-filter .sidebar-header h3 {
			font-size: 14px !important;
			margin: 0 0 10px 0 !important;
		}
		
		.sidebar-content {
			display: flex;
			flex-direction: column;
			gap: 6px;
		}
		
		.filter-checkbox {
			display: flex;
			align-items: center;
			gap: 8px;
			cursor: pointer;
			padding: 4px 6px;
			border-radius: 4px;
			transition: background 0.2s;
			font-size: 13px;
		}
		
		.filter-checkbox:hover {
			background: #f5f5f5;
		}
		
		.filter-checkbox input[type="checkbox"] {
			cursor: pointer;
			width: 18px;
			height: 18px;
		}
		
		.filter-checkbox span {
			font-size: 14px;
			color: #2c3e50;
			user-select: none;
		}
		
		/* Main content layout with sidebar */
		#main-content {
			width: 100%;
			padding: 0;
		}
		
		.content-with-sidebar {
			max-width: 1200px;
			margin: 0 auto;
			padding: 40px 20px;
		}
		
		#one {
			max-width: 1200px;
			margin: 0 auto;
			padding: 0 20px;
		}
		
		/* Hide sidebar on smaller screens */
		@media (max-width: 1023px) {
			.sidebar-filter {
				display: none;
			}
		}
		
		.result-title {
			display: block;
			font-size: 18px;
			font-weight: 600;
			color: #0056a3;
			text-decoration: none;
			margin-bottom: 8px;
		}
		.result-title:hover { 
			text-decoration: underline; 
		}
		.result-authors { 
			color: #333; 
			font-size: 14px; 
			margin-bottom: 6px; 
		}
		
		/* Clickable Rochester authors */
		.result-authors .roch-author {
			color: #555;
			font-weight: normal;
			text-decoration: none;
			border-bottom: 1px dotted #3498db;
			cursor: pointer;
			transition: all 0.2s ease;
		}
		.result-authors .roch-author:hover {
			color: #2980b9;
			border-bottom-color: #2980b9;
		}
		
		.result-citation { 
			color: #666; 
			font-size: 13px; 
			margin-bottom: 10px; 
		}

		/* Share buttons */
		.share-buttons { 
			margin-top: 10px; 
		}
		.share-buttons a {
			display: inline-block;
			margin-right: 10px;
			font-size: 20px;
			color: #5e5e5e;
			padding: 6px 10px;
			border-radius: 6px;
			text-decoration: none;
			transition: opacity 0.3s ease;
		}
		.share-buttons a:hover { 
			opacity: 0.85; 
		}

		/* Top Navigation Bar */
		.top-bar {
			background: #ffffff;
			color: #2c3e50;
			padding: 15px 0;
			font-size: 14px;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			z-index: 1001;
			box-shadow: 0 2px 10px rgba(0,0,0,0.1);
			border-bottom: 1px solid #eee;
		}
		.top-bar-content {
			max-width: 1200px;
			margin: 0 auto;
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 0 20px;
		}
		.logo {
			display: flex;
			align-items: center;
		}
		.logo img {
			height: 40px;
			width: auto;
		}
		.nav-links {
			display: flex;
			gap: 30px;
			align-items: center;
		}
		.nav-links a {
			color: #2c3e50;
			text-decoration: none;
			font-weight: 500;
			font-size: 15px;
			transition: color 0.3s ease;
		}
		.nav-links a:hover {
			color: #3498db;
		}
		.cta-button {
			background: linear-gradient(135deg, #3498db, #2980b9);
			color: white;
			padding: 10px 20px;
			border-radius: 25px;
			text-decoration: none;
			font-weight: 600;
			font-size: 14px;
			transition: all 0.3s ease;
		}
		.cta-button:hover {
			transform: translateY(-1px);
			box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
		}
		.menu-icon {
			display: none;
			flex-direction: column;
			cursor: pointer;
		}
		.menu-icon div {
			width: 25px;
			height: 3px;
			background: #2c3e50;
			margin: 3px 0;
			transition: 0.3s;
		}

		/* Hero section */
		   .hero-section {
			   background: linear-gradient(120deg, #006FFD 0%, #0056a3 100%);
			   min-height: 340px;
			   display: flex;
			   align-items: center;
			   position: relative;
			   overflow: hidden;
			   margin-top: 70px;
			   z-index: 1;
		   }
		   .hero-bg-blobs {
			   position: absolute;
			   top: 0;
			   left: 0;
			   width: 100%;
			   height: 100%;
			   z-index: 0;
			   pointer-events: none;
			   opacity: 1;
			   transition: opacity 0.5s;
		   }

		/* Extend the backdrop into the results grid section */
		#one.wrapper.style1.special {
			background: linear-gradient(135deg, #e3eaf3 0%, #b6c7e0 100%);
			z-index: 0;
		}
		.hero-section::before {
			content: '';
			position: absolute;
			top: 0;
			right: 0;
			width: 50%;
			height: 100%;
			background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 600" fill="rgba(52,152,219,0.05)"><circle cx="300" cy="150" r="100"/><circle cx="350" cy="400" r="80"/><path d="M200,100 Q300,200 400,300" stroke="rgba(52,152,219,0.1)" stroke-width="3" fill="none"/></svg>') center/cover;
			z-index: 1;
		}
		.hero-content {
			max-width: 1200px;
			margin: 0 auto;
			   padding: 36px 20px;
			display: grid;
			grid-template-columns: 1fr 350px;
			gap: 60px;
			align-items: center;
			position: relative;
			z-index: 2;
		}
		.hero-right {
			position: relative;
		}
		.chart-container {
			position: relative;
			aspect-ratio: 1;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.hero-left h1 {
			font-size: 3em;
			font-weight: 800;
			color: #2c3e50;
			margin-bottom: 24px;
			line-height: 1.1;
		}
		.hero-left .subtitle {
			font-size: 1.2em;
			color: #7f8c8d;
			margin-bottom: 16px;
			font-weight: 500;
		}
		.hero-left p {
			font-size: 1.1em;
			color: #34495e;
			margin-bottom: 36px;
			line-height: 1.7;
		}
		.button-row {
			display: flex;
			gap: 16px;
			flex-wrap: wrap;
		}
		.btn {
			padding: 14px 28px;
			border-radius: 50px;
			font-weight: 600;
			text-decoration: none;
			transition: all 0.3s ease;
			border: none;
			cursor: pointer;
			font-size: 15px;
		}
		.btn-primary {
			background: linear-gradient(135deg, #3498db, #2980b9);
			color: white;
			box-shadow: 0 4px 16px rgba(52, 152, 219, 0.3);
		}
		.btn-primary:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
		}
		.btn-secondary {
			background: rgba(255, 255, 255, 0.1);
			color: white;
			border: 2px solid rgba(255, 255, 255, 0.3);
		}
		.btn-secondary:hover {
			background: rgba(255, 255, 255, 0.2);
			border-color: rgba(255, 255, 255, 0.5);
		}

		/* Stats card */
		.stats-card {
			background: #ffffff;
			border-radius: 15px;
			padding: 30px 24px;
			box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
			border: 1px solid #e8f4f8;
			position: relative;
		}
		.stats-card::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			height: 4px;
			background: linear-gradient(90deg, #3498db, #2980b9, #3498db);
			border-radius: 20px 20px 0 0;
			animation: shimmer 3s ease-in-out infinite;
		}
		@keyframes shimmer {
			0%, 100% { opacity: 0.6; }
			50% { opacity: 1; }
		}
		.daily-count {
			display: flex;
			align-items: center;
			margin-bottom: 20px;
			padding-bottom: 16px;
			border-bottom: 1px solid #eee;
		}
		.daily-count h3 {
			margin: 0;
			font-size: 1.1em;
			color: #2c3e50;
			font-weight: 600;
		}
		.count-number {
			font-size: 2.4em;
			font-weight: 800;
			color: #3498db;
			margin-left: 12px;
		}
		.ai-summary h4 {
			margin: 0 0 12px 0;
			color: #2c3e50;
			font-size: 1.1em;
			font-weight: 600;
			display: flex;
			align-items: center;
		}
		.ai-summary h4::before {
			content: 'ü§ñ';
			margin-right: 8px;
		}
		.summary-text {
			color: #34495e;
			line-height: 1.6;
			font-size: 14px;
		}
		.update-time {
			margin-top: 16px;
			padding-top: 12px;
			border-top: 1px solid #eee;
			font-size: 12px;
			color: #7f8c8d;
			text-align: center;
		}

		/* Responsive design */
		@media (max-width: 900px) {
			.results { column-count: 2; }
			.hero-content {
				grid-template-columns: 1fr;
				gap: 40px;
				text-align: center;
			}
			.chart-container {
				display: none;
			}
			.hero-left h1 { font-size: 2.4em; }
			.hero-left p { font-size: 1.1em; }
			.nav-links {
				display: none;
			}
			.menu-icon {
				display: flex;
			}
		}
		@media (max-width: 600px) {
			.results { column-count: 1; }
			.hero-content {
				padding: 40px 15px;
			}
			.hero-left h1 { font-size: 2em; }
			.hero-left p { font-size: 1em; }
			.button-row {
				justify-content: center;
			}
			.btn {
				padding: 12px 24px;
				font-size: 14px;
			}
			
			/* Hide scrollbar on mobile for cleaner look */
			.card-back-content::-webkit-scrollbar {
				display: none;
			}
			.card-back-content {
				-ms-overflow-style: none;
				scrollbar-width: none;
			}
			.chart-container {
				display: none;
			}

			.stats-card {
				padding: 24px 18px;
			}
			.count-number { font-size: 2em; }
		}
		
		/* Author Bibliography Modal */
		.author-modal {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.6);
			z-index: 4000;
			justify-content: center;
			align-items: center;
		}
		.author-modal-content {
			background: white;
			border-radius: 12px;
			max-width: 800px;
			width: 90%;
			max-height: 80vh;
			overflow: hidden;
			display: flex;
			flex-direction: column;
			box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
		}
		.author-modal-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 24px;
			border-bottom: 2px solid #e0e0e0;
			background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
		}
		.author-modal-header h3 {
			margin: 0;
			color: #2c3e50;
			font-size: 1.6em;
		}
		.author-modal-close {
			background: none;
			border: none;
			font-size: 28px;
			color: #95a5a6;
			cursor: pointer;
			transition: color 0.2s ease;
			padding: 0;
			width: 32px;
			height: 32px;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		.author-modal-close:hover {
			color: #2c3e50;
		}
		.author-modal-loading {
			text-align: center;
			padding: 40px;
			color: #7f8c8d;
		}
		.author-bibliography {
			list-style: none;
			padding: 24px;
			margin: 0;
			overflow-y: auto;
			flex: 1;
		}
		.author-bibliography li {
			padding: 16px 0;
			border-bottom: 1px solid #e0e0e0;
			font-size: 14px;
			line-height: 1.7;
			color: #2c3e50;
		}
		.author-bibliography li:last-child {
			border-bottom: none;
		}
		.author-bibliography .pub-journal {
			font-style: italic;
			color: #555;
		}
		.author-bibliography .pub-year {
			font-weight: 600;
			color: #2c3e50;
		}
		
		/* Loading spinner */
		.spinner {
			border: 3px solid #f3f3f3;
			border-top: 3px solid #3498db;
			border-radius: 50%;
			width: 40px;
			height: 40px;
			animation: spin 1s linear infinite;
			margin: 0 auto 20px;
		}
		@keyframes spin {
			0% { transform: rotate(0deg); }
			100% { transform: rotate(360deg); }
		}
		
		/* ===== ACCESSIBILITY IMPROVEMENTS ===== */
		
		/* Skip to main content link */
		.skip-link {
			position: absolute;
			top: -50px;
			left: 10px;
			background: #3498db;
			color: white;
			padding: 10px 20px;
			text-decoration: none;
			z-index: 10001;
			font-weight: 600;
			border-radius: 0 0 8px 8px;
			transition: top 0.3s;
		}
		.skip-link:focus {
			top: 0;
		}
		
		/* Enhanced focus styles for keyboard navigation */
		*:focus {
			outline: 3px solid #3498db;
			outline-offset: 2px;
		}
		
		a:focus {
			outline: 3px solid #3498db;
			outline-offset: 3px;
		}
		
		button:focus {
			outline: 3px solid #3498db;
			outline-offset: 3px;
		}
		
		.nav-links a:focus {
			text-decoration: underline;
		}
		
		.menu-icon {
			cursor: pointer;
			background: none;
			border: none;
			padding: 8px;
		}
		
		.menu-icon:hover,
		.menu-icon:focus {
			background: rgba(52, 152, 219, 0.1);
			border-radius: 4px;
		}
		
		/* Modal accessibility */
		.modal-bg[aria-hidden="true"] {
			display: none;
		}
		
		.modal-content {
			position: relative;
		}
		
		.modal-close {
			cursor: pointer;
			background: none;
			border: none;
			font-size: 28px;
			line-height: 1;
		}
		
		.modal-close:hover {
			color: #3498db;
		}
		
		.modal-close:focus {
			outline: 3px solid #3498db;
			outline-offset: 2px;
			border-radius: 4px;
		}
		
		/* Ensure sufficient color contrast */
		.result-authors {
			color: #2c3e50; /* Improved from #333 */
		}
		
		.result-citation {
			color: #555; /* Improved from #666 */
		}
		
		/* Screen reader only text */
		.sr-only {
			position: absolute;
			width: 1px;
			height: 1px;
			padding: 0;
			margin: -1px;
			overflow: hidden;
			clip: rect(0, 0, 0, 0);
			white-space: nowrap;
			border-width: 0;
		}
		</style>
	</head>
	<body class="landing is-preload">
		<!-- Skip to main content link for keyboard users -->
		<a href="#main-content" class="skip-link">Skip to main content</a>
		
		<!-- Page Wrapper -->
		<div id="page-wrapper">
			<!-- Modern Medical Navigation Header -->
			<nav class="top-bar" role="navigation" aria-label="Main navigation">
				<div class="top-bar-content">
					<div class="logo">
						<img src="images/medcityai_logo1.png" alt="Med City AI Logo" style="height:48px; width:auto;" />
					</div>
					<div class="nav-links" role="menubar">
						<a href="index.html" role="menuitem" aria-current="page">New Today</a>
						<a href="search.html" role="menuitem">Search</a>
						<a href="analytics.html" role="menuitem">Analytics</a>
						<a href="about.html" role="menuitem">About</a>
						<a href="contact.html" role="menuitem">Contact</a>
					</div>
					<div style="display: flex; align-items: center; gap: 15px;">
						<a href="#subscribe" class="cta-button">Subscribe</a>
						<button class="menu-icon" aria-label="Toggle mobile menu" aria-expanded="false" aria-controls="mobile-menu">
							<span class="sr-only">Menu</span>
							<div aria-hidden="true"></div>
							<div aria-hidden="true"></div>
							<div aria-hidden="true"></div>
						</button>
					</div>
				</div>
			</nav>

			<!-- Hero Section -->
			<section class="hero-section" aria-label="Hero banner" style="position:relative; overflow:hidden;">
				<!-- Animated SVG background blobs -->
				   <svg class="hero-bg-blobs" width="100%" height="900" viewBox="0 0 1440 900" style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;" aria-hidden="true" role="presentation">
					   <defs>
						   <linearGradient id="blobGradient1" x1="0" y1="0" x2="1" y2="1">
							   <stop offset="0%" stop-color="#3498db" stop-opacity="0.18"/>
							   <stop offset="100%" stop-color="#b6c7e0" stop-opacity="0.12"/>
						   </linearGradient>
						   <linearGradient id="blobGradient2" x1="0" y1="1" x2="1" y2="0">
							   <stop offset="0%" stop-color="#e3eaf3" stop-opacity="0.16"/>
							   <stop offset="100%" stop-color="#2980b9" stop-opacity="0.10"/>
						   </linearGradient>
					   </defs>
					   <g>
						   <circle id="blob1" cx="330" cy="220" r="330" fill="url(#blobGradient1)">
							   <animate attributeName="cx" values="330;1110;330" dur="15s" repeatCount="indefinite"/>
							   <animate attributeName="cy" values="220;680;220" dur="13.125s" repeatCount="indefinite"/>
						   </circle>
						   <circle id="blob2" cx="270" cy="180" r="270" fill="url(#blobGradient2)">
							   <animate attributeName="cx" values="270;1170;270" dur="16.875s" repeatCount="indefinite"/>
							   <animate attributeName="cy" values="180;720;180" dur="11.25s" repeatCount="indefinite"/>
						   </circle>
						   <circle id="blob3" cx="450" cy="450" r="450" fill="url(#blobGradient1)" opacity="0.7">
							   <animate attributeName="cx" values="450;990;450" dur="18.75s" repeatCount="indefinite"/>
							   <animate attributeName="cy" values="450;850;450" dur="15s" repeatCount="indefinite"/>
						   </circle>
					   </g>
				   </svg>
				<div class="hero-content">
					<div class="hero-left">
						<div class="subtitle" style="color:#e0e0e0;">Rochester, Minnesota</div>
						<h1 style="color:#fff; text-shadow: 0 4px 18px rgba(0,0,0,0.28);">What's New in Med City?</h1>
						<p style="color:#e0e0e0;">MedCityAI is a real-time feed of biomedical research from Rochester, MN. All information freely sourced from the National Library of Medicine (PubMed).</p>
					</div>
					<div class="hero-right">
						<div class="chart-container">
							<img src="images/med_city_publications_web.png" alt="Chart showing growth of Rochester, Minnesota biomedical publications over time" style="width: 100%; height: 100%; object-fit: contain;">
						</div>
					</div>
				</div>
			</section>

			<!-- Filter Bar -->
			<div class="filter-bar">
				<div class="filter-bar-content">
					<div class="filter-bar-title">Filter by Specialty:</div>
					<div class="filter-bar-links">
						<a href="#" class="dept-filter-link active" data-dept="">Everything</a>
						<span>‚Ä¢</span>
						<a href="#" class="dept-filter-link" data-dept="Surgery">Surgery</a>
						<span>‚Ä¢</span>
						<a href="#" class="dept-filter-link" data-dept="Cardiology">Cardiology</a>
						<span>‚Ä¢</span>
						<a href="#" class="dept-filter-link" data-dept="Neurology">Neurology</a>
						<span>‚Ä¢</span>
						<a href="#" class="dept-filter-link" data-dept="Oncology">Oncology</a>
						<span>‚Ä¢</span>
						<a href="#" class="dept-filter-link" data-dept="Radiation Oncology">Radiation Oncology</a>
						<span>‚Ä¢</span>
						<a href="#" class="dept-filter-link" data-dept="Radiology">Radiology</a>
						<span>‚Ä¢</span>
						<a href="#" class="dept-filter-link" data-dept="Pediatrics">Pediatrics</a>
						<span>‚Ä¢</span>
						<a href="#" class="dept-filter-link" data-dept="Internal Medicine">Internal Medicine</a>
						<span>‚Ä¢</span>
					<a href="#" class="dept-filter-link" data-dept="Psychiatry">Psychiatry</a>
					<span>‚Ä¢</span>
					<a href="#" class="dept-filter-link" data-dept="AI/ML/DL & Generative AI">AI/ML/DL & Generative AI</a>
				</div>					<!-- Results Grid -->
					<div id="pubmed-results" role="region" aria-live="polite" aria-atomic="false" aria-label="Publication results"></div>
					
					<!-- Pagination Controls -->
					<nav id="pagination-controls" style="display:none; text-align:center; margin: 30px 0; padding: 20px;" role="navigation" aria-label="Pagination">
						<button id="prevPage" aria-label="Go to previous page" style="padding:12px 24px; margin:0 10px; border-radius:25px; border:1px solid #3498db; background:white; color:#3498db; cursor:pointer; font-weight:600;">‚Üê Previous</button>
						<span id="pageInfo" role="status" aria-live="polite" style="margin:0 20px; font-size:16px; color:#2c3e50; font-weight:500;">Page 1</span>
						<button id="nextPage" aria-label="Go to next page" style="padding:12px 24px; margin:0 10px; border-radius:25px; border:1px solid #3498db; background:white; color:#3498db; cursor:pointer; font-weight:600;">Next ‚Üí</button>
					</nav>
				</div>
			</div>

			<!-- Main Content Section (Hidden) -->
			<main id="main-content" role="main" style="display: none;">
				<div class="content-with-sidebar">
					<!-- Fixed Sidebar Filter -->
					<aside id="sidebarFilter" class="sidebar-filter" role="complementary" aria-label="Department filters" style="display: none;">
						<div class="sidebar-header">
							<h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 700; color: #2c3e50;">Filter by Department</h3>
						</div>
					<div class="sidebar-content">
						<label class="filter-checkbox">
							<input type="checkbox" value="Surgery" class="dept-checkbox">
							<span>Surgery</span>
						</label>
						<label class="filter-checkbox">
							<input type="checkbox" value="Cardiology" class="dept-checkbox">
							<span>Cardiology</span>
						</label>
						<label class="filter-checkbox">
							<input type="checkbox" value="Neurology" class="dept-checkbox">
							<span>Neurology</span>
						</label>
						<label class="filter-checkbox">
							<input type="checkbox" value="Oncology" class="dept-checkbox">
							<span>Oncology</span>
						</label>
						<label class="filter-checkbox">
							<input type="checkbox" value="Radiology" class="dept-checkbox">
							<span>Radiology</span>
						</label>
						<label class="filter-checkbox">
							<input type="checkbox" value="Pediatrics" class="dept-checkbox">
							<span>Pediatrics</span>
						</label>
						<label class="filter-checkbox">
							<input type="checkbox" value="Internal Medicine" class="dept-checkbox">
							<span>Internal Medicine</span>
						</label>
						<label class="filter-checkbox">
							<input type="checkbox" value="Psychiatry" class="dept-checkbox">
							<span>Psychiatry</span>
						</label>
						<label class="filter-checkbox">
						</label>
						<button id="clearFilters" style="width: 100%; margin-top: 12px; padding: 6px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 600;">Clear All</button>
					</div>
				</aside>
				
				<section id="one" class="wrapper style1 special" style="padding: 40px 0;">
					<!-- Results Grid -->
					<div id="pubmed-results" role="region" aria-live="polite" aria-atomic="false" aria-label="Publication results" style="margin-top:40px;"></div>
					
					<!-- Pagination Controls -->
					<nav id="pagination-controls" style="display:none; text-align:center; margin: 30px 0; padding: 20px;" role="navigation" aria-label="Pagination">
						<button id="prevPage" aria-label="Go to previous page" style="padding:12px 24px; margin:0 10px; border-radius:25px; border:1px solid #3498db; background:white; color:#3498db; cursor:pointer; font-weight:600;">‚Üê Previous</button>
						<span id="pageInfo" role="status" aria-live="polite" style="margin:0 20px; font-size:16px; color:#2c3e50; font-weight:500;">Page 1</span>
						<button id="nextPage" aria-label="Go to next page" style="padding:12px 24px; margin:0 10px; border-radius:25px; border:1px solid #3498db; background:white; color:#3498db; cursor:pointer; font-weight:600;">Next ‚Üí</button>
					</nav>

					<!-- Modal for abstracts -->
					<div id="modalBg" class="modal-bg" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-hidden="true">
						<div class="modal-content" role="document">
							<button class="modal-close" id="modalClose" aria-label="Close modal">&times;</button>
							<h3 id="modalTitle"></h3>
							<div class="modal-abstract" id="modalAbstract"></div>
						</div>
					</div>
					
					<!-- Author Bibliography Modal -->
					<div id="authorModal" class="author-modal author-modal-bg" role="dialog" aria-modal="true" aria-labelledby="authorModalTitle" aria-hidden="true">
						<div class="author-modal-content" role="document">
							<div class="author-modal-header">
								<h3 id="authorModalTitle">Author Publications</h3>
								<button class="author-modal-close" onclick="closeAuthorModal()" aria-label="Close author publications modal">&times;</button>
							</div>
							<div id="authorModalLoading" class="author-modal-loading" style="display: none;" role="status" aria-live="polite">
								<div class="spinner" aria-hidden="true"></div>
								<p>Loading publications...</p>
							</div>
							<ol id="authorBibliography" class="author-bibliography" aria-label="List of author publications"></ol>
						</div>
					</div>
				</section>
			</div>
		</main>

		<!-- Footer -->
			<footer id="footer">
				<ul class="icons">
					<li><a href="https://www.linkedin.com/company/medcityai" aria-label="Follow MedCityAI on LinkedIn" style="display: flex; align-items: center; gap: 10px; text-decoration: none; color: inherit;">Follow MedCityAI on LinkedIn <i class="fab fa-linkedin-in" style="font-size: 1.3em; color: #0a66c2;"></i></a></li>
				</ul>
				<ul class="copyright">
					<li>&copy; Med City AI</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li><li><a href="terms_of_use.html" style="color: #999;">Terms</a> | <a href="privacy_policy.html" style="color: #999;">Privacy</a> | <a href="cookie_policy.html" style="color: #999;">Cookies</a></li>
				</ul>
			</footer>
		</div>

		<!-- Scripts -->
		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/jquery.scrollex.min.js"></script>
		<script src="assets/js/jquery.scrolly.min.js"></script>
		<script src="assets/js/browser.min.js"></script>
		<script src="assets/js/breakpoints.min.js"></script>
		<script src="assets/js/util.js"></script>
		<script src="assets/js/main.js"></script>

		<script>
		// Application state
		let VarTot = 0, VarDay = 0, VarWeek = 0, VarMonth = 0;
		let currentPage = 1;
		let currentSearchQuery = '';
		const resultsPerPage = 50;

		// Modal functions
		function showAbstractModal(link) {
			const modalBg = document.getElementById('modalBg');
			const modalTitle = document.getElementById('modalTitle');
			const modalAbstract = document.getElementById('modalAbstract');
			
			const title = link.getAttribute('data-title');
			const abstract = link.getAttribute('data-abstract');
			const pmid = link.getAttribute('data-pmid');
			const authors = link.getAttribute('data-authors');
			const affiliations = link.getAttribute('data-affiliations');
			const llmSummary = link.getAttribute('data-llm-summary');

			// Title in black at top
			modalTitle.innerHTML = `<span style='color:#111;font-weight:800;font-size:1.3em;'>${title}</span>`;

			// Authors and affiliations
			let authorList = '';
			if (authors) {
				authorList += `<div style='margin:10px 0 18px 0;font-size:1em;color:#222;'><strong>Authors:</strong> ${authors.replace(/;/g, '; ')}</div>`;
			}
			if (affiliations) {
				authorList += `<div style='margin-bottom:18px;font-size:0.95em;color:#444;'><strong>Affiliations:</strong> ${affiliations.replace(/;/g, '; ')}</div>`;
			}

			// Start with authors
			let content = authorList;
			
			// Show AI-Generated Summary if available, otherwise show original abstract
			if (llmSummary && llmSummary.trim() !== '' && llmSummary !== 'No abstract available.') {
				content += `<div style="background: linear-gradient(135deg, #f0f7ff 0%, #e3f2fd 100%); padding: 20px; border-radius: 12px; margin-bottom: 24px; border-left: 4px solid #2196f3; box-shadow: 0 2px 8px rgba(33, 150, 243, 0.1);">`;
				content += `<div style="display: flex; align-items: center; margin-bottom: 12px;">`;
				content += `<span style="font-size: 24px; margin-right: 10px;">ü§ñ</span>`;
				content += `<h4 style="color: #1565c0; margin: 0; font-size: 16px; font-weight: 700;">AI-GENERATED PLAIN LANGUAGE SUMMARY</h4>`;
				content += `</div>`;
				content += `<p style="margin: 0 0 12px 0; line-height: 1.7; color: #1a237e; font-size: 15px;">${llmSummary}</p>`;
				content += `<div style="padding-top: 12px; border-top: 1px solid #bbdefb; margin-top: 12px;">`;
				content += `<p style="margin: 0; font-size: 12px; color: #546e7a; font-style: italic; line-height: 1.5;">`;
				content += `<strong>‚ö†Ô∏è Disclaimer:</strong> This summary was generated by artificial intelligence and may contain inaccuracies or oversimplifications. `;
				content += `Please refer to the full publication for complete and accurate information. `;
				content += `This AI summary is provided for informational purposes only and should not be used for clinical decision-making.`;
				content += `</p>`;
				content += `</div>`;
				content += `</div>`;
			} else {
				// Fallback to original abstract if no LLM summary
				content += `<h4 style="color: #0056a3; border-bottom: 2px solid #0056a3; padding-bottom: 8px; margin-bottom: 12px;">Abstract</h4>`;
				content += `<p style="line-height: 1.6;">${abstract}</p>`;
			}

			modalAbstract.innerHTML = content;
			modalBg.style.display = 'flex';

			// Prevent scroll to top
			if (window.scrollY) {
				setTimeout(() => window.scrollTo({top: window.scrollY}), 0);
			}
		}

		function closeModal() {
			const modalBg = document.getElementById('modalBg');
			modalBg.style.display = 'none';
			modalBg.setAttribute('aria-hidden', 'true');
			
			// Return focus to the element that opened the modal
			if (window.lastFocusedElement) {
				window.lastFocusedElement.focus();
			}
		}
		
		// Author Bibliography Modal Functions
		async function showAuthorBibliography(authorName) {
			const modal = document.getElementById('authorModal');
			const title = document.getElementById('authorModalTitle');
			const loading = document.getElementById('authorModalLoading');
			const bibliography = document.getElementById('authorBibliography');
			
			// Store focus for accessibility
			window.lastFocusedElement = document.activeElement;
			
			// Show modal and loading state
			modal.style.display = 'flex';
			modal.setAttribute('aria-hidden', 'false');
			title.textContent = `Publications by ${authorName}`;
			loading.style.display = 'block';
			bibliography.innerHTML = '';
			
			try {
				// Build query for this author + Rochester affiliation
				const query = `(${authorName}[Author]) AND (Rochester[AD] AND (Minnesota[AD] OR MN[AD]))`;
				
				// Search PubMed
				const searchUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&term=${encodeURIComponent(query)}&retmax=100&retmode=json&sort=pub+date`;
				const searchResponse = await fetch(searchUrl);
				const searchData = await searchResponse.json();
				
				const articleIds = searchData.esearchresult.idlist;
				
				if (articleIds.length === 0) {
					bibliography.innerHTML = '<li style="color: #7f8c8d; text-align: center; padding: 40px;">No publications found for this author.</li>';
					loading.style.display = 'none';
					return;
				}
				
				// Fetch article details
				const fetchUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=pubmed&id=${articleIds.join(',')}&retmode=xml`;
				const fetchResponse = await fetch(fetchUrl);
				const xmlText = await fetchResponse.text();
				
				// Parse XML
				const parser = new DOMParser();
				const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
				const articles = parseAuthorArticles(xmlDoc);
				
				// Sort by year (most recent first)
				articles.sort((a, b) => {
					const yearA = parseInt(a.year) || 0;
					const yearB = parseInt(b.year) || 0;
					return yearB - yearA;
				});
				
				// Build bibliography HTML
				let bibliographyHTML = '';
				articles.forEach(article => {
					const citation = generateMLACitation(article);
					bibliographyHTML += `<li>${citation}</li>`;
				});
				
				bibliography.innerHTML = bibliographyHTML;
				loading.style.display = 'none';
				
			} catch (error) {
				console.error('Error fetching author bibliography:', error);
				bibliography.innerHTML = '<li style="color: #e74c3c; text-align: center; padding: 40px;">Error loading publications. Please try again.</li>';
				loading.style.display = 'none';
			}
		}
		
		function parseAuthorArticles(xmlDoc) {
			const articles = [];
			const articleNodes = xmlDoc.querySelectorAll('PubmedArticle');
			
			articleNodes.forEach(articleNode => {
				const article = {};
				
				// PMID
				const pmidNode = articleNode.querySelector('PMID');
				article.pmid = pmidNode ? pmidNode.textContent : '';
				article.url = `https://pubmed.ncbi.nlm.nih.gov/${article.pmid}/`;
				
				// Title
				const titleNode = articleNode.querySelector('ArticleTitle');
				article.title = titleNode ? titleNode.textContent : 'No title available';
				
				// Authors
				const authorNodes = articleNode.querySelectorAll('Author');
				const authorNames = [];
				authorNodes.forEach(authorNode => {
					const lastName = authorNode.querySelector('LastName')?.textContent || '';
					const initials = authorNode.querySelector('Initials')?.textContent || '';
					if (lastName) {
						authorNames.push(`${lastName} ${initials}`);
					}
				});
				article.authors = authorNames.length > 0 ? authorNames.slice(0, 3).join(', ') + (authorNames.length > 3 ? ', et al.' : '') : 'Unknown Authors';
				
				// Journal
				const journalNode = articleNode.querySelector('Title');
				article.journal = journalNode ? journalNode.textContent : 'Unknown Journal';
				
				// Publication Year
				const yearNode = articleNode.querySelector('PubDate Year');
				article.year = yearNode ? yearNode.textContent : 'n.d.';
				
				articles.push(article);
			});
			
			return articles;
		}
		
		function generateMLACitation(article) {
			return `${article.authors}. "${article.title}" <span class="pub-journal">${article.journal}</span>, <span class="pub-year">${article.year}</span>. <a href="${article.url}" target="_blank" style="color: #3498db;">PubMed</a>`;
		}
		
		function closeAuthorModal() {
			const modal = document.getElementById('authorModal');
			modal.style.display = 'none';
			modal.setAttribute('aria-hidden', 'true');
			
			// Return focus to triggering element
			if (window.lastFocusedElement) {
				window.lastFocusedElement.focus();
			}
		}
		
		// Accessibility: Focus trap for modal
		function trapFocus(element) {
			const focusableElements = element.querySelectorAll(
				'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
			);
			const firstFocusable = focusableElements[0];
			const lastFocusable = focusableElements[focusableElements.length - 1];

			element.addEventListener('keydown', function(e) {
				if (e.key === 'Tab') {
					if (e.shiftKey) {
						if (document.activeElement === firstFocusable) {
							e.preventDefault();
							lastFocusable.focus();
						}
					} else {
						if (document.activeElement === lastFocusable) {
							e.preventDefault();
							firstFocusable.focus();
						}
					}
				}
			});
		}
		
		// Accessibility: Keyboard support for modal
		document.addEventListener('keydown', function(e) {
			const modalBg = document.getElementById('modalBg');
			const authorModal = document.getElementById('authorModal');
			
			if (e.key === 'Escape') {
				if (modalBg.style.display === 'flex') {
					closeModal();
				} else if (authorModal.style.display === 'flex') {
					closeAuthorModal();
				}
			}
		});
		
		// Update showAbstractModal to handle focus and ARIA
		const originalShowAbstractModal = showAbstractModal;
		showAbstractModal = function(link) {
			// Store the element that triggered the modal
			window.lastFocusedElement = document.activeElement;
			
			// Call original function
			originalShowAbstractModal(link);
			
			// Update ARIA and focus
			const modalBg = document.getElementById('modalBg');
			const modalClose = document.getElementById('modalClose');
			modalBg.setAttribute('aria-hidden', 'false');
			
			// Set up focus trap
			trapFocus(modalBg);
			
			// Focus the close button
			setTimeout(() => modalClose.focus(), 100);
		};

		// Statistics loading
		async function loadStatistics() {
			try {
				const response = await fetch('./database/summary_stats.txt');
				if (!response.ok) throw new Error('Statistics file not found');
				
				const statsText = await response.text();
				statsText.split('\n').forEach(line => {
					const [key, value] = line.split('=');
					if (key && value) {
						const trimmedKey = key.trim();
						const numValue = parseInt(value.trim());
						
						switch(trimmedKey) {
							case 'VarTot': VarTot = numValue; break;
							case 'VarDay': VarDay = numValue; break;
							case 'VarWeek': VarWeek = numValue; break;
							case 'VarMonth': VarMonth = numValue; break;
						}
					}
				});

				// Update UI
				document.getElementById("VarTot").textContent = VarTot;
				document.getElementById("VarDay").textContent = VarDay;
				document.getElementById("VarWeek").textContent = VarWeek;
				document.getElementById("VarMonth").textContent = VarMonth;
				
				// Update live count in hero banner
				document.getElementById("live-count").textContent = VarDay;
			} catch (err) {
				console.error('Error loading statistics:', err);
			}
		}

		// Global variables for CSV data
		let allArticlesData = [];
		let filteredArticlesData = [];
		let currentlyFlippedCard = null;

		// Function to flip card and match heights (with keyboard support)
		function flipCard(container, event) {
			// Support both click and keyboard events
			if (event.type === 'keydown' && event.key !== 'Enter' && event.key !== ' ') {
				return; // Only respond to Enter or Space key
			}
			
			event.stopPropagation();
			event.preventDefault(); // Prevent space from scrolling
			
			const cardFront = container.querySelector('.card-front');
			const cardBack = container.querySelector('.card-back');
			
			// If there's a currently flipped card and it's not this one, flip it back
			if (currentlyFlippedCard && currentlyFlippedCard !== container && currentlyFlippedCard.classList.contains('flipped')) {
				currentlyFlippedCard.classList.remove('flipped');
			}
			
			if (!container.classList.contains('flipped')) {
				// Flipping to back - capture front height and apply to back
				const frontHeight = cardFront.offsetHeight;
				cardBack.style.height = frontHeight + 'px';
				currentlyFlippedCard = container;
			} else {
				currentlyFlippedCard = null;
			}
			
			container.classList.toggle('flipped');
		}

		// Load CSV data
		async function loadCSVData() {
			try {
				const response = await fetch('pubmed_data.csv');
				if (!response.ok) throw new Error('CSV file not found');
				
				const csvText = await response.text();
				const lines = csvText.split('\n');
				
				// Parse header
				const headers = lines[0].split(',').map(h => h.trim().replace(/^"|"$/g, ''));
				
				// Parse data rows
				allArticlesData = [];
				for (let i = 1; i < lines.length; i++) {
					if (!lines[i].trim()) continue;
					
					const row = parseCSVLine(lines[i]);
					if (row.length === headers.length) {
						const article = {};
						headers.forEach((header, index) => {
							article[header] = row[index];
						});
						allArticlesData.push(article);
					}
				}
				
				console.log(`Loaded ${allArticlesData.length} articles from CSV`);
				return allArticlesData;
			} catch (error) {
				console.error('Error loading CSV:', error);
				return [];
			}
		}

		// Populate department filter dropdown - NO LONGER NEEDED (using links instead)
		// function populateDepartmentFilter() { ... }


		// Parse CSV line handling quoted fields
		function parseCSVLine(line) {
			const result = [];
			let current = '';
			let inQuotes = false;
			
			for (let i = 0; i < line.length; i++) {
				const char = line[i];
				
				if (char === '"') {
					inQuotes = !inQuotes;
				} else if (char === ',' && !inQuotes) {
					result.push(current.trim());
					current = '';
				} else {
					current += char;
				}
			}
			result.push(current.trim());
			
			return result;
		}

		// Escape HTML for data attributes
		function escapeHtml(text) {
			const div = document.createElement('div');
			div.textContent = text;
			return div.innerHTML;
		}

		// PubMed data display with search and pagination (now using CSV data)
		async function fetchPubMedResults(searchQuery = '', page = 1, departmentFilter = '') {
			currentSearchQuery = searchQuery;
			currentPage = page;
			
			// Ensure data is loaded
			if (allArticlesData.length === 0) {
				await loadCSVData();
			}
			
			// Filter articles based on search query
			if (searchQuery && searchQuery.trim() !== '') {
				const query = searchQuery.trim().toLowerCase();
				filteredArticlesData = allArticlesData.filter(article => {
					return article.title.toLowerCase().includes(query) ||
						   article.abstract.toLowerCase().includes(query) ||
						   article.authors.toLowerCase().includes(query) ||
						   article.journal.toLowerCase().includes(query);
				});
			} else {
				// No search query, show all articles
				filteredArticlesData = [...allArticlesData];
			}
			
			// Apply department filter if selected
			if (departmentFilter && departmentFilter.trim() !== '') {
				// Define category mappings
				const categoryKeywords = {
					'Surgery': ['surgery', 'surgical', 'cardiovascular surgery', 'cardiac surgery', 'thoracic surgery', 'neurosurgery', 'orthopedic surgery', 'plastic surgery', 'vascular surgery', 'transplant surgery'],
					'Cardiology': ['cardiology', 'cardiovascular', 'cardiac', 'heart'],
					'Neurology': ['neurology', 'neurological', 'neuroscience', 'neuroimaging', 'brain'],
					'Oncology': ['oncology', 'cancer', 'hematology', 'medical oncology', 'leukemia', 'lymphoma'],
					'Radiation Oncology': ['radiation oncology', 'radiation', 'radiotherapy'],
					'Radiology': ['radiology', 'imaging', 'diagnostic radiology', 'interventional radiology'],
					'Pediatrics': ['pediatrics', 'pediatric', 'child', 'children', 'neonatal'],
					'Internal Medicine': ['internal medicine', 'medicine', 'general medicine'],
					'Psychiatry': ['psychiatry', 'psychiatric', 'mental health', 'psychology'],
					'AI/ML/DL': ['artificial intelligence', 'machine learning', 'deep learning', 'neural network', 'ai', 'ml', 'dl',
						'generative ai', 'large language model', 'llm', 'chatgpt', 'gpt', 'generative', 'gen ai'
					]
				};
				
				filteredArticlesData = filteredArticlesData.filter(article => {
					const affiliationsList = article.affiliations ? article.affiliations.split('|') : [];
					
					// Check if any affiliation contains a department that matches the selected category
					return affiliationsList.some(affiliation => {
						const deptMatch = affiliation.match(/(?:Department|Division|Center|Institute|Clinic|Unit|Section)\s+of\s+([^,\.]+)/i);
						if (deptMatch) {
							const deptName = deptMatch[1].trim().toLowerCase();
							
							// Check if department name contains any keyword from the selected category
							const keywords = categoryKeywords[departmentFilter] || [];
							return keywords.some(keyword => deptName.includes(keyword));
						}
						return false;
					});
				});
			}
			
			// Check if we have results
			if (filteredArticlesData.length === 0) {
				document.getElementById("pubmed-results").innerHTML = "<p style='text-align:center; padding:40px; color:#666;'>No results found. Try a different search term.</p>";
				document.getElementById("pagination-controls").style.display = 'none';
				return;
			}
			
			// Calculate pagination
			const totalPages = Math.ceil(filteredArticlesData.length / resultsPerPage);
			const startIdx = (page - 1) * resultsPerPage;
			const endIdx = Math.min(startIdx + resultsPerPage, filteredArticlesData.length);
			const pageArticles = filteredArticlesData.slice(startIdx, endIdx);
			
			// Show/hide pagination controls
			if (filteredArticlesData.length > resultsPerPage) {
				document.getElementById("pagination-controls").style.display = 'block';
				document.getElementById("pageInfo").textContent = `Page ${page} of ${totalPages} (${filteredArticlesData.length} results)`;
				document.getElementById("prevPage").disabled = page === 1;
				document.getElementById("nextPage").disabled = page === totalPages;
				document.getElementById("prevPage").style.opacity = page === 1 ? '0.5' : '1';
				document.getElementById("nextPage").style.opacity = page === totalPages ? '0.5' : '1';
			} else {
				document.getElementById("pagination-controls").style.display = 'none';
			}
			
			// Get current date for NEW badge logic
			const now = new Date();
			const twoDaysAgo = new Date(now.getTime() - (2 * 24 * 60 * 60 * 1000));
			
			// Build results HTML from CSV data
			let resultsHTML = '';
			
			pageArticles.forEach(article => {
				const pmid = article.pmid;
				const title = article.title;
				const abstract = article.abstract;
				const journal = article.journal;
				const pubdate = article.pubdate;
				const url = article.url;
				const llmSummary = article.llm_summary || '';
				
				// Parse publication date to check if NEW
				const year = article.year;
				const month = article.month;
				const day = article.day;
				
				let articleDate = null;
				const monthNames = ["", "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
				if (year && month && day) {
					const monthNum = monthNames.indexOf(month);
					if (monthNum > 0) {
						articleDate = new Date(year, monthNum - 1, day);
					}
				} else if (year && month) {
					const monthNum = monthNames.indexOf(month);
					if (monthNum > 0) {
						articleDate = new Date(year, monthNum - 1, 1);
					}
				}
				
				// Determine if article is NEW (within last 2 days)
				const isNew = articleDate && articleDate >= twoDaysAgo;
				
				// Parse authors (pipe-separated in CSV)
				const authorsList = article.authors ? article.authors.split('|') : [];
				const rochesterAuthorsList = article.rochester_authors ? article.rochester_authors.split('|') : [];
				
				// Format authors for display
				let authorsHtml = "";
				if (article.authors_display) {
					authorsHtml = article.authors_display;
					// Make Rochester authors clickable
					rochesterAuthorsList.forEach(rochAuthor => {
						if (rochAuthor) {
							const escapedAuthor = rochAuthor.replace(/'/g, "\\'");
							authorsHtml = authorsHtml.replace(
								rochAuthor, 
								`<span class="roch-author" onclick="showAuthorBibliography('${escapedAuthor}')" tabindex="0" role="button" aria-label="View publications by ${escapedAuthor}" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();showAuthorBibliography('${escapedAuthor}');}">${rochAuthor}</span>`
							);
						}
					});
				}
				
				// Parse affiliations (pipe-separated in CSV)
				const affiliationsList = article.affiliations ? article.affiliations.split('|') : [];
				
				// Extract department/division - prioritize first Rochester author's department
				let departmentText = '';
				
				// First, try to get department from first Rochester author
				if (rochesterAuthorsList.length > 0 && affiliationsList.length > 0) {
					const firstRochAuthor = rochesterAuthorsList[0];
					const authorIndex = authorsList.indexOf(firstRochAuthor);
					
					if (authorIndex >= 0 && authorIndex < affiliationsList.length) {
						const affiliation = affiliationsList[authorIndex];
						const deptMatch = affiliation.match(/(?:Department|Division|Center|Institute|Clinic|Unit|Section)\s+of\s+([^,\.]+)/i);
						if (deptMatch) {
							departmentText = deptMatch[1].trim();
						}
					}
				}
				
				// If no department found from first Rochester author, check all affiliations
				if (!departmentText && affiliationsList.length > 0) {
					for (let i = 0; i < affiliationsList.length; i++) {
						const affiliation = affiliationsList[i];
						const deptMatch = affiliation.match(/(?:Department|Division|Center|Institute|Clinic|Unit|Section)\s+of\s+([^,\.]+)/i);
						if (deptMatch) {
							departmentText = deptMatch[1].trim();
							break; // Use the first match found
						}
					}
				}
				
				// Default to "Medicine" if no department found
				if (!departmentText) {
					departmentText = 'Medicine';
				}
				
				const citation = `${journal}. ${pubdate}.`;

				// Build card with flip effect
				const hasSummary = llmSummary && llmSummary.trim() !== '' && llmSummary !== 'No abstract available.';
				
				resultsHTML += `
					<div class="result-item">
						<div class="card-flip-container" role="group" aria-label="${title.substring(0, 100)}...">
							<!-- Front of card -->
							<div class="card-face card-front" onclick="flipCard(this.closest('.card-flip-container'), event);" style="cursor: pointer;">
								${isNew ? '<div class="new-tab">NEW</div>' : ''}
								${departmentText ? `<div class="department-badge">${departmentText}</div>` : ''}
								<br>
								<a href="#" class="result-title" 
								   onclick="event.preventDefault(); event.stopPropagation(); flipCard(this.closest('.card-flip-container'), event);" 
								   onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();flipCard(this.closest('.card-flip-container'), event);}"
								   tabindex="0"
								   role="button"
								   aria-label="Click to view AI summary of: ${title}">${title}</a>
								<div class="result-authors" onclick="event.stopPropagation();">${authorsHtml}</div>
								<div class="result-citation"><em>${citation}</em></div>
								<div style="margin-top: 8px; margin-bottom: 10px;">
									<a href="${url}" target="_blank" onclick="event.stopPropagation();" style="color: #0056a3; text-decoration: none; font-size: 14px; font-weight: 500;">
										View on PubMed ‚Üí
									</a>
								</div>
								<div class="share-buttons" role="group" aria-label="Share on social media" onclick="event.stopPropagation();">
									<a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}" class="facebook" target="_blank" aria-label="Share on Facebook">
										<i class="icon brands fa-facebook-f" aria-hidden="true"></i> 
									</a>
									<a href="https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(title)}" class="twitter" target="_blank" aria-label="Share on Twitter">
										<i class="icon brands fa-twitter" aria-hidden="true"></i> 
									</a>
									<a href="https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(url)}&title=${encodeURIComponent(title)}" class="linkedin" target="_blank" aria-label="Share on LinkedIn">
										<i class="icon brands fa-linkedin" aria-hidden="true"></i> 
									</a>
								</div>
							</div>
							
							<!-- Back of card (AI Summary) -->
							${hasSummary ? `
							<div class="card-face card-back" onclick="flipCard(this.closest('.card-flip-container'), event);" style="cursor: pointer;">
								<div class="card-back-header">
									<h4 style="color: #1565c0; margin: 0; font-size: 16px; font-weight: 700; cursor: pointer;"
									    onclick="event.stopPropagation(); flipCard(this.closest('.card-flip-container'), event);"
									    onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();flipCard(this.closest('.card-flip-container'), event);}"
									    tabindex="0"
									    role="button"
									    aria-label="Click to return to article details">
										AI SUMMARY <span style="font-size: 14px;">‚Ü©</span>
									</h4>
								</div>
								<div class="card-back-content">
									<div class="card-back-summary">${llmSummary}</div>
									<div class="card-back-disclaimer">
										<p style="margin: 0 0 10px 0; font-size: 11px; color: #546e7a; font-style: italic; line-height: 1.4;">
											This summary was generated by AI and may contain inaccuracies. Refer to the full publication for accurate information.
										</p>
										<a href="${url}" target="_blank" onclick="event.stopPropagation();" style="color: #0056a3; text-decoration: none; font-size: 14px; font-weight: 500;">
											View on PubMed ‚Üí
										</a>
									</div>
								</div>
							</div>
							` : ''}
						</div>
					</div>
				`;
			});

			document.getElementById("pubmed-results").innerHTML = `<div class="results">${resultsHTML}</div>`;
			
			// Scroll to top of results after page change
			if (page > 1) {
				document.getElementById("pubmed-results").scrollIntoView({ behavior: 'smooth', block: 'start' });
			}
		}

		// Function to handle multiple department selections from sidebar
		async function fetchPubMedResultsMultiple(searchQuery = '', page = 1, departmentFilters = []) {
			currentSearchQuery = searchQuery;
			currentPage = page;
			
			// Ensure data is loaded
			if (allArticlesData.length === 0) {
				await loadCSVData();
			}
			
			// Start with all articles
			filteredArticlesData = [...allArticlesData];
			
			// Apply multiple department filters if selected
			if (departmentFilters.length > 0) {
				const categoryKeywords = {
					'Surgery': ['surgery', 'surgical', 'cardiovascular surgery', 'cardiac surgery', 'thoracic surgery', 'neurosurgery', 'orthopedic surgery', 'plastic surgery', 'vascular surgery', 'transplant surgery'],
					'Cardiology': ['cardiology', 'cardiovascular', 'cardiac', 'heart'],
					'Neurology': ['neurology', 'neurological', 'neuroscience', 'neuroimaging', 'brain'],
					'Oncology': ['oncology', 'cancer', 'hematology', 'medical oncology', 'leukemia', 'lymphoma'],
					'Radiation Oncology': ['radiation oncology', 'radiation', 'radiotherapy'],
					'Radiology': ['radiology', 'imaging', 'diagnostic radiology', 'interventional radiology'],
					'Pediatrics': ['pediatrics', 'pediatric', 'child', 'children', 'neonatal'],
					'Internal Medicine': ['internal medicine', 'medicine', 'general medicine'],
					'Psychiatry': ['psychiatry', 'psychiatric', 'mental health', 'psychology'],
					'AI/ML/DL & Generative AI': [
						'artificial intelligence', 'machine learning', 'deep learning', 'neural network', 'ai', 'ml', 'dl', 'data science',
						'generative ai', 'large language model', 'llm', 'chatgpt', 'gpt', 'generative', 'gen ai'
					]
				};
				
				filteredArticlesData = filteredArticlesData.filter(article => {
					const affiliationsList = article.affiliations ? article.affiliations.split('|') : [];
					
					// Check if article matches ANY of the selected departments
					return departmentFilters.some(selectedDept => {
						return affiliationsList.some(affiliation => {
							const deptMatch = affiliation.match(/(?:Department|Division|Center|Institute|Clinic|Unit|Section)\s+of\s+([^,\.]+)/i);
							if (deptMatch) {
								const deptName = deptMatch[1].trim().toLowerCase();
								
								const keywords = categoryKeywords[selectedDept] || [];
								return keywords.some(keyword => deptName.includes(keyword));
							}
							return false;
						});
					});
				});
			}
			
			// Display results (reuse same pagination/display logic)
			displayFilteredResults(page);
		}

		// Shared function to display filtered results with pagination
		function displayFilteredResults(page) {
			// Check if we have results
			if (filteredArticlesData.length === 0) {
				document.getElementById("pubmed-results").innerHTML = "<p style='text-align:center; padding:40px; color:#666;'>No results found. Try a different filter.</p>";
				document.getElementById("pagination-controls").style.display = 'none';
				return;
			}
			
			// Calculate pagination
			const totalPages = Math.ceil(filteredArticlesData.length / resultsPerPage);
			const startIdx = (page - 1) * resultsPerPage;
			const endIdx = Math.min(startIdx + resultsPerPage, filteredArticlesData.length);
			const pageArticles = filteredArticlesData.slice(startIdx, endIdx);
			
			// Show/hide pagination controls
			if (filteredArticlesData.length > resultsPerPage) {
				document.getElementById("pagination-controls").style.display = 'block';
				document.getElementById("pageInfo").textContent = `Page ${page} of ${totalPages} (${filteredArticlesData.length} results)`;
				document.getElementById("prevPage").disabled = page === 1;
				document.getElementById("nextPage").disabled = page === totalPages;
				document.getElementById("prevPage").style.opacity = page === 1 ? '0.5' : '1';
				document.getElementById("nextPage").style.opacity = page === totalPages ? '0.5' : '1';
			} else {
				document.getElementById("pagination-controls").style.display = 'none';
			}
			
			// Get current date for NEW badge logic
			const now = new Date();
			const twoDaysAgo = new Date(now.getTime() - (2 * 24 * 60 * 60 * 1000));
			
			// Build results HTML from CSV data
			let resultsHTML = '';
			
			pageArticles.forEach(article => {
				const pmid = article.pmid;
				const title = article.title;
				const abstract = article.abstract;
				const journal = article.journal;
				const pubdate = article.pubdate;
				const url = article.url;
				const llmSummary = article.llm_summary || '';
				
				// Parse publication date to check if NEW
				const year = article.year;
				const month = article.month;
				const day = article.day;
				
				let articleDate = null;
				const monthNames = ["", "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
				if (year && month && day) {
					const monthNum = monthNames.indexOf(month);
					if (monthNum > 0) {
						articleDate = new Date(year, monthNum - 1, day);
					}
				} else if (year && month) {
					const monthNum = monthNames.indexOf(month);
					if (monthNum > 0) {
						articleDate = new Date(year, monthNum - 1, 1);
					}
				}
				
				// Determine if article is NEW (within last 2 days)
				const isNew = articleDate && articleDate >= twoDaysAgo;
				
				// Parse authors (pipe-separated in CSV)
				const authorsList = article.authors ? article.authors.split('|') : [];
				const rochesterAuthorsList = article.rochester_authors ? article.rochester_authors.split('|') : [];
				
				// Format authors for display
				let authorsHtml = "";
				if (article.authors_display) {
					authorsHtml = article.authors_display;
					// Make Rochester authors clickable
					rochesterAuthorsList.forEach(rochAuthor => {
						if (rochAuthor) {
							const escapedAuthor = rochAuthor.replace(/'/g, "\\'");
							authorsHtml = authorsHtml.replace(
								rochAuthor, 
								`<span class="roch-author" onclick="showAuthorBibliography('${escapedAuthor}')" tabindex="0" role="button" aria-label="View publications by ${escapedAuthor}" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();showAuthorBibliography('${escapedAuthor}');}">${rochAuthor}</span>`
							);
						}
					});
				}
				
				// Parse affiliations (pipe-separated in CSV)
				const affiliationsList = article.affiliations ? article.affiliations.split('|') : [];
				
				// Extract department/division - prioritize first Rochester author's department
				let departmentText = '';
				
				// First, try to get department from first Rochester author
				if (rochesterAuthorsList.length > 0 && affiliationsList.length > 0) {
					const firstRochAuthor = rochesterAuthorsList[0];
					const authorIndex = authorsList.indexOf(firstRochAuthor);
					
					if (authorIndex >= 0 && authorIndex < affiliationsList.length) {
						const affiliation = affiliationsList[authorIndex];
						const deptMatch = affiliation.match(/(?:Department|Division|Center|Institute|Clinic|Unit|Section)\s+of\s+([^,\.]+)/i);
						if (deptMatch) {
							departmentText = deptMatch[1].trim();
						}
					}
				}
				
				// If no department found from first Rochester author, check all affiliations
				if (!departmentText && affiliationsList.length > 0) {
					for (let i = 0; i < affiliationsList.length; i++) {
						const affiliation = affiliationsList[i];
						const deptMatch = affiliation.match(/(?:Department|Division|Center|Institute|Clinic|Unit|Section)\s+of\s+([^,\.]+)/i);
						if (deptMatch) {
							departmentText = deptMatch[1].trim();
							break; // Use the first match found
						}
					}
				}
				
				// Default to "Medicine" if no department found
				if (!departmentText) {
					departmentText = 'Medicine';
				}
				
				const citation = `${journal}. ${pubdate}.`;

				// Build card with flip effect
				const hasSummary = llmSummary && llmSummary.trim() !== '' && llmSummary !== 'No abstract available.';
				
				resultsHTML += `
					<div class="result-item">
						<div class="card-flip-container" role="group" aria-label="${title.substring(0, 100)}...">
							<!-- Front of card -->
							<div class="card-face card-front" onclick="flipCard(this.closest('.card-flip-container'), event);" style="cursor: pointer;">
								${isNew ? '<div class="new-tab">NEW</div>' : ''}
								${departmentText ? `<div class="department-badge">${departmentText}</div>` : ''}
								<br>
								<a href="#" class="result-title" 
								   onclick="event.preventDefault(); event.stopPropagation(); flipCard(this.closest('.card-flip-container'), event);" 
								   onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();flipCard(this.closest('.card-flip-container'), event);}"
								   tabindex="0"
								   role="button"
								   aria-label="Click to view AI summary of: ${title}">${title}</a>
								<div class="result-authors" onclick="event.stopPropagation();">${authorsHtml}</div>
								<div class="result-citation"><em>${citation}</em></div>
								<div style="margin-top: 8px; margin-bottom: 10px;">
									<a href="${url}" target="_blank" onclick="event.stopPropagation();" style="color: #0056a3; text-decoration: none; font-size: 14px; font-weight: 500;">
										View on PubMed ‚Üí
									</a>
								</div>
								<div class="share-buttons" role="group" aria-label="Share on social media" onclick="event.stopPropagation();">
									<a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}" class="facebook" target="_blank" aria-label="Share on Facebook">
										<i class="icon brands fa-facebook-f" aria-hidden="true"></i> 
									</a>
									<a href="https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(title)}" class="twitter" target="_blank" aria-label="Share on Twitter">
										<i class="icon brands fa-twitter" aria-hidden="true"></i> 
									</a>
									<a href="https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(url)}&title=${encodeURIComponent(title)}" class="linkedin" target="_blank" aria-label="Share on LinkedIn">
										<i class="icon brands fa-linkedin" aria-hidden="true"></i> 
									</a>
								</div>
							</div>
							
							<!-- Back of card (AI Summary) -->
							${hasSummary ? `
							<div class="card-face card-back" onclick="flipCard(this.closest('.card-flip-container'), event);" style="cursor: pointer;">
								<div class="card-back-header">
									<h4 style="color: #1565c0; margin: 0; font-size: 16px; font-weight: 700; cursor: pointer;"
									    onclick="event.stopPropagation(); flipCard(this.closest('.card-flip-container'), event);"
									    onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();flipCard(this.closest('.card-flip-container'), event);}"
									    tabindex="0"
									    role="button"
									    aria-label="Click to return to article details">
										AI SUMMARY <span style="font-size: 14px;">‚Ü©</span>
									</h4>
								</div>
								<div class="card-back-content">
									<div class="card-back-summary">${llmSummary}</div>
									<div class="card-back-disclaimer">
										<p style="margin: 0 0 10px 0; font-size: 11px; color: #546e7a; font-style: italic; line-height: 1.4;">
											This summary was generated by AI and may contain inaccuracies. Refer to the full publication for accurate information.
										</p>
										<a href="${url}" target="_blank" onclick="event.stopPropagation();" style="color: #0056a3; text-decoration: none; font-size: 14px; font-weight: 500;">
											View on PubMed ‚Üí
										</a>
									</div>
								</div>
							</div>
							` : ''}
						</div>
					</div>
				`;
			});

			document.getElementById("pubmed-results").innerHTML = `<div class="results">${resultsHTML}</div>`;
			
			// Scroll to top of results after page change
			if (page > 1) {
				document.getElementById("pubmed-results").scrollIntoView({ behavior: 'smooth', block: 'start' });
			}
		}

		// Initialize application
		document.addEventListener('DOMContentLoaded', function() {
			// Set up modal event listeners
			const modalBg = document.getElementById('modalBg');
			const modalClose = document.getElementById('modalClose');
            
			modalClose.addEventListener('click', closeModal);
			modalBg.addEventListener('click', function(e) {
				if (e.target === modalBg) closeModal();
			});
			
			// Set up author modal close event listener
			const authorModal = document.getElementById('authorModal');
			authorModal.addEventListener('click', function(e) {
				if (e.target === authorModal) closeAuthorModal();
			});

			// Set up department filter
			let currentDepartmentFilter = '';
			let selectedDepartments = new Set(); // Track multiple selections from sidebar
			
			// Add click event listeners to department filter links (top)
			document.querySelectorAll('.dept-filter-link').forEach(link => {
				link.addEventListener('click', function(e) {
					e.preventDefault();
					
					// Remove active class from all links
					document.querySelectorAll('.dept-filter-link').forEach(l => l.classList.remove('active'));
					
					// Add active class to clicked link
					this.classList.add('active');
					
					// Get department from data attribute
					currentDepartmentFilter = this.getAttribute('data-dept');
					
					// Clear sidebar checkboxes when using top filter
					document.querySelectorAll('.dept-checkbox').forEach(cb => cb.checked = false);
					selectedDepartments.clear();
					
					// Fetch filtered results
					fetchPubMedResults('', 1, currentDepartmentFilter);
				});
			});
			
			// Add change event listeners to sidebar checkboxes
			document.querySelectorAll('.dept-checkbox').forEach(checkbox => {
				checkbox.addEventListener('change', function() {
					if (this.checked) {
						selectedDepartments.add(this.value);
					} else {
						selectedDepartments.delete(this.value);
					}
					
					// Clear top filter active state when using sidebar
					document.querySelectorAll('.dept-filter-link').forEach(l => l.classList.remove('active'));
					currentDepartmentFilter = '';
					
					// Fetch filtered results with multiple departments
					fetchPubMedResultsMultiple('', 1, Array.from(selectedDepartments));
				});
			});
			
			// Clear all filters button
			document.getElementById('clearFilters').addEventListener('click', function() {
				// Uncheck all checkboxes
				document.querySelectorAll('.dept-checkbox').forEach(cb => cb.checked = false);
				selectedDepartments.clear();
				
				// Reset top filter to "All"
				document.querySelectorAll('.dept-filter-link').forEach(l => l.classList.remove('active'));
				document.querySelector('.dept-filter-link[data-dept=""]').classList.add('active');
				currentDepartmentFilter = '';
				
				// Show all results
				fetchPubMedResults('', 1, '');
			});

			// Set up pagination event listeners
			document.getElementById('prevPage').addEventListener('click', function() {
				if (currentPage > 1) {
					// Check if using sidebar filters or top filter
					if (selectedDepartments.size > 0) {
						fetchPubMedResultsMultiple(currentSearchQuery, currentPage - 1, Array.from(selectedDepartments));
					} else {
						fetchPubMedResults(currentSearchQuery, currentPage - 1, currentDepartmentFilter);
					}
				}
			});

			document.getElementById('nextPage').addEventListener('click', function() {
				const totalPages = Math.ceil(filteredArticlesData.length / resultsPerPage);
				if (currentPage < totalPages) {
					// Check if using sidebar filters or top filter
					if (selectedDepartments.size > 0) {
						fetchPubMedResultsMultiple(currentSearchQuery, currentPage + 1, Array.from(selectedDepartments));
					} else {
						fetchPubMedResults(currentSearchQuery, currentPage + 1, currentDepartmentFilter);
					}
				}
			});

			// Load data and display results
			loadStatistics();
			loadCSVData().then(() => {
				fetchPubMedResults('', 1);
			});
		});
		</script>
	</body>
</html>