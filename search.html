<!DOCTYPE HTML>
<!--
	MedCityAI - Advanced Search
-->
<html lang="en">
	<head>
		<title>Search - MedCityAI - Rochester MN Biomedical Research</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="stylesheet" href="assets/css/fontawesome-all.min.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
		<style>
		/* Top Navigation Bar */
		.top-bar {
			background: #ffffff;
			color: #2c3e50;
			padding: 15px 0;
			font-size: 14px;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			z-index: 1001;
			box-shadow: 0 2px 10px rgba(0,0,0,0.1);
			border-bottom: 1px solid #eee;
		}
		.top-bar-content {
			max-width: 1200px;
			margin: 0 auto;
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 0 20px;
		}
		.logo {
			display: flex;
			align-items: center;
		}
		.logo img {
			height: 40px;
			width: auto;
		}
		.nav-links {
			display: flex;
			gap: 30px;
			align-items: center;
		}
		.nav-links a {
			color: #2c3e50;
			text-decoration: none;
			font-weight: 500;
			font-size: 15px;
			transition: color 0.3s ease;
		}
		.nav-links a:hover, .nav-links a.active {
			color: #3498db;
		}
		.cta-button {
			background: linear-gradient(135deg, #3498db, #2980b9);
			color: white;
			padding: 10px 20px;
			border-radius: 25px;
			text-decoration: none;
			font-weight: 600;
			font-size: 14px;
			transition: all 0.3s ease;
		}
		.cta-button:hover {
			transform: translateY(-1px);
			box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
		}

		/* Search Hero Section */
		.hero-section {
			background: linear-gradient(120deg, #2568BE 0%, #1B4C7D 100%);
			min-height: 340px;
			display: flex;
			align-items: center;
			position: relative;
			overflow: hidden;
			margin-top: 70px;
			z-index: 1;
		}
		.hero-bg-blobs {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			z-index: 0;
			pointer-events: none;
			opacity: 1;
			transition: opacity 0.5s;
		}
		.hero-section::before {
			content: '';
			position: absolute;
			top: 0;
			right: 0;
			width: 50%;
			height: 100%;
			background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 600" fill="rgba(52,152,219,0.05)"><circle cx="300" cy="150" r="100"/><circle cx="350" cy="400" r="80"/><path d="M200,100 Q300,200 400,300" stroke="rgba(52,152,219,0.1)" stroke-width="3" fill="none"/></svg>') center/cover;
			z-index: 1;
		}
		.hero-content {
			max-width: 1200px;
			margin: 0 auto;
			padding: 36px 20px;
			display: grid;
			grid-template-columns: 1fr 350px;
			gap: 60px;
			align-items: center;
			position: relative;
			z-index: 2;
		}
		.hero-left {
			display: flex;
			flex-direction: column;
			gap: 20px;
		}
		.hero-right {
			position: relative;
		}
		.chart-container {
			position: relative;
			aspect-ratio: 1;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		.subtitle {
			color: #e0e0e0;
			font-size: 14px;
			font-weight: 600;
			text-transform: uppercase;
			letter-spacing: 1px;
		}
		.hero-left h1 {
			color: #fff;
			text-shadow: 0 4px 18px rgba(0,0,0,0.28);
			font-size: 3em;
			margin: 0;
		}
		.hero-left p {
			color: #e0e0e0;
			font-size: 1.1em;
			margin: 0;
		}
		
		/* Search Bar Styling */
		.search-bar-container {
			position: relative;
			max-width: 600px;
			margin-top: 24px;
		}
		.search-bar {
			width: 100%;
			padding: 16px 20px 16px 50px;
			font-size: 16px;
			border: 2px solid rgba(255, 255, 255, 0.3);
			border-radius: 50px;
			background: rgba(255, 255, 255, 0.95);
			color: #2c3e50;
			box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
			transition: all 0.3s ease;
		}
		.search-bar:focus {
			outline: none;
			border-color: rgba(255, 255, 255, 0.8);
			background: #fff;
			box-shadow: 0 6px 30px rgba(0, 0, 0, 0.2);
		}
		.search-bar::placeholder {
			color: #7f8c8d;
		}
		.search-icon {
			position: absolute;
			left: 20px;
			top: 50%;
			transform: translateY(-50%);
			color: #3498db;
			font-size: 18px;
			pointer-events: none;
		}

		/* Advanced Search Form */
		.search-container {
			background: #fff;
			border-radius: 16px;
			padding: 32px;
			box-shadow: 0 10px 40px rgba(0,0,0,0.15);
		}
		.search-row {
			display: flex;
			gap: 16px;
			margin-bottom: 20px;
			align-items: flex-end;
		}
		.search-field {
			flex: 1;
		}
		.search-field label {
			display: block;
			font-weight: 600;
			color: #2c3e50;
			margin-bottom: 8px;
			font-size: 14px;
		}
		.search-field input, .search-field select {
			width: 100%;
			padding: 12px 16px;
			border: 2px solid #e0e0e0;
			border-radius: 8px;
			font-size: 15px;
			transition: all 0.3s ease;
			box-sizing: border-box;
		}
		.search-field input:focus, .search-field select:focus {
			outline: none;
			border-color: #3498db;
			box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
		}
		.search-field-small {
			flex: 0 0 200px;
		}
		.search-submit {
			background: linear-gradient(135deg, #3498db, #2980b9);
			color: white;
			border: none;
			padding: 14px 40px;
			border-radius: 8px;
			font-size: 16px;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.3s ease;
			display: flex;
			align-items: center;
			gap: 8px;
		}
		.search-submit:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
		}
		.search-submit:active {
			transform: translateY(0);
		}
		.search-filters {
			display: flex;
			gap: 12px;
			flex-wrap: wrap;
			margin-top: 20px;
			padding-top: 20px;
			border-top: 1px solid #e0e0e0;
		}
		.filter-tag {
			background: #e3f2fd;
			color: #1565c0;
			padding: 6px 14px;
			border-radius: 20px;
			font-size: 13px;
			font-weight: 500;
			display: flex;
			align-items: center;
			gap: 6px;
		}
		.filter-tag .remove {
			cursor: pointer;
			font-weight: bold;
		}

		/* Results Section */
		.results-section {
			max-width: 1000px;
			margin: 40px auto;
			padding: 40px 20px;
			background: linear-gradient(135deg, #f0f7ff 0%, #e3f2fd 100%);
			border-radius: 16px;
		}
		.results-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 24px;
			padding-bottom: 16px;
			border-bottom: 1px solid #e0e0e0;
		}
		.results-count {
			font-size: 1.2em;
			color: #2c3e50;
			font-weight: 600;
		}
		.results-count span {
			color: #3498db;
		}
		.results-actions {
			display: flex;
			align-items: center;
			gap: 16px;
		}
		.select-all-container {
			display: flex;
			align-items: center;
			gap: 8px;
		}
		.select-all-container label {
			font-weight: 500;
			color: #2c3e50;
			cursor: pointer;
			user-select: none;
		}
		.select-all-container input[type="checkbox"] {
			width: 18px;
			height: 18px;
			cursor: pointer;
		}
		.export-btn {
			background: linear-gradient(135deg, #27ae60, #229954);
			color: white;
			border: none;
			padding: 10px 20px;
			border-radius: 8px;
			font-size: 14px;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.3s ease;
			display: flex;
			align-items: center;
			gap: 8px;
		}
		.export-btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
		}
		.export-btn:disabled {
			background: #bdc3c7;
			cursor: not-allowed;
			transform: none;
		}

		/* Result Item - Sleek Sequential Design */
		.results-list {
			background: #fff;
			border-radius: 12px;
			overflow: hidden;
			box-shadow: 0 2px 8px rgba(0,0,0,0.08);
		}
		.result-item {
			padding: 24px;
			border-bottom: 1px solid #f0f0f0;
			transition: background 0.2s ease;
			display: flex;
			gap: 18px;
			align-items: flex-start;
			position: relative;
		}
		.result-item:last-child {
			border-bottom: none;
		}
		.result-item:hover {
			background: #f8fbff;
		}
		.result-item.selected {
			background: #e3f2fd;
		}
		.new-badge {
			position: absolute;
			top: 8px;
			left: 8px;
			background: #e74c3c;
			color: #fff;
			font-size: 11px;
			font-weight: bold;
			padding: 4px 10px;
			border-radius: 6px 0 6px 0;
			z-index: 10;
			pointer-events: none;
			box-shadow: 0 2px 4px rgba(231, 76, 60, 0.3);
		}
		.result-number {
			position: absolute;
			top: 12px;
			left: 12px;
			font-size: 14px;
			color: #7f8c8d;
			font-weight: 700;
			background: white;
			padding: 4px 8px;
			border-radius: 4px;
			border: 1px solid #e0e0e0;
		}
		.result-checkbox {
			flex-shrink: 0;
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 8px;
			min-width: 50px;
		}
		.result-checkbox input[type="checkbox"] {
			width: 24px;
			height: 24px;
			cursor: pointer;
			appearance: none;
			-webkit-appearance: none;
			-moz-appearance: none;
			border: 2px solid #3498db;
			border-radius: 4px;
			background: white;
			position: relative;
			transition: all 0.2s ease;
		}
		.result-checkbox input[type="checkbox"]:hover {
			border-color: #2980b9;
			box-shadow: 0 0 8px rgba(52, 152, 219, 0.3);
		}
		.result-checkbox input[type="checkbox"]:checked {
			background: #3498db;
			border-color: #3498db;
		}
		.result-checkbox input[type="checkbox"]:checked::after {
			content: '✓';
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			color: white;
			font-size: 16px;
			font-weight: bold;
		}
		.result-content {
			flex: 1;
			min-width: 0;
			padding-left: 40px;
		}
		.result-title {
			font-size: 1.25em;
			font-weight: 600;
			color: #0056a3;
			text-decoration: none;
			margin-bottom: 10px;
			display: block;
			line-height: 1.5;
			transition: color 0.2s ease;
		}
		.result-title:hover {
			color: #3498db;
		}
		.result-meta {
			display: flex;
			flex-wrap: wrap;
			gap: 20px;
			margin-bottom: 14px;
			font-size: 13px;
			color: #7f8c8d;
		}
		.result-meta-item {
			display: flex;
			align-items: center;
			gap: 6px;
		}
		.result-meta-item i {
			color: #3498db;
			font-size: 12px;
		}
		.result-authors {
			font-size: 14px;
			color: #555;
			margin-bottom: 14px;
			line-height: 1.6;
		}
		.result-authors .roch-author {
			color: #555;
			font-weight: 500;
			text-decoration: none;
			border-bottom: 1px dotted #3498db;
			cursor: pointer;
			transition: all 0.2s ease;
		}
		.result-authors .roch-author:hover {
			color: #2980b9;
			border-bottom-color: #2980b9;
		}
		.result-actions {
			display: flex;
			gap: 10px;
			align-items: center;
			flex-wrap: wrap;
		}
		.btn-link {
			background: transparent;
			color: #3498db;
			text-decoration: none;
			padding: 7px 16px;
			border-radius: 6px;
			font-size: 13px;
			font-weight: 500;
			transition: all 0.2s ease;
			display: inline-flex;
			align-items: center;
			gap: 6px;
			border: 1px solid #e0e0e0;
			cursor: pointer;
		}
		.btn-link:hover {
			background: #3498db;
			color: white;
			border-color: #3498db;
			box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
		}
		.btn-link i {
			font-size: 11px;
		}
		.btn-link.primary {
			background: #3498db;
			color: white;
			border-color: #3498db;
		}
		.btn-link.primary:hover {
			background: #2980b9;
			border-color: #2980b9;
		}

		/* Citation Modal */
		.citation-modal {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(0, 0, 0, 0.6);
			z-index: 2000;
			justify-content: center;
			align-items: center;
			backdrop-filter: blur(4px);
		}
		.citation-modal-content {
			background: white;
			border-radius: 16px;
			padding: 32px;
			max-width: 700px;
			width: 90%;
			max-height: 80vh;
			overflow-y: auto;
			box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
			animation: modalSlideIn 0.3s ease-out;
		}
		@keyframes modalSlideIn {
			from {
				transform: translateY(-50px);
				opacity: 0;
			}
			to {
				transform: translateY(0);
				opacity: 1;
			}
		}
		.citation-modal-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 24px;
			padding-bottom: 16px;
			border-bottom: 2px solid #e0e0e0;
		}
		.citation-modal-header h3 {
			margin: 0;
			color: #2c3e50;
			font-size: 1.5em;
		}
		.citation-close {
			background: none;
			border: none;
			font-size: 28px;
			color: #95a5a6;
			cursor: pointer;
			transition: color 0.2s ease;
			padding: 0;
			width: 32px;
			height: 32px;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		.citation-close:hover {
			color: #2c3e50;
		}
		.citation-tabs {
			display: flex;
			gap: 8px;
			margin-bottom: 20px;
			border-bottom: 2px solid #e0e0e0;
		}
		.citation-tab {
			background: transparent;
			border: none;
			padding: 12px 24px;
			cursor: pointer;
			font-weight: 500;
			color: #7f8c8d;
			transition: all 0.2s ease;
			border-bottom: 3px solid transparent;
			margin-bottom: -2px;
		}
		.citation-tab:hover {
			color: #3498db;
		}
		.citation-tab.active {
			color: #3498db;
			border-bottom-color: #3498db;
		}
		.citation-content {
			background: #f8f9fa;
			border: 1px solid #e0e0e0;
			border-radius: 8px;
			padding: 20px;
			margin-bottom: 16px;
			font-family: 'Courier New', monospace;
			font-size: 14px;
			line-height: 1.8;
			color: #2c3e50;
			min-height: 120px;
			white-space: pre-wrap;
			word-wrap: break-word;
		}
		.citation-actions {
			display: flex;
			gap: 12px;
		}
		.citation-copy-btn {
			background: linear-gradient(135deg, #27ae60, #229954);
			color: white;
			border: none;
			padding: 12px 24px;
			border-radius: 8px;
			font-size: 14px;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.3s ease;
			display: flex;
			align-items: center;
			gap: 8px;
		}
		.citation-copy-btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
		}
		.citation-copy-btn.copied {
			background: #95a5a6;
		}

		/* Author Bibliography Modal */
		.author-modal {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(0, 0, 0, 0.6);
			z-index: 2000;
			justify-content: center;
			align-items: center;
			backdrop-filter: blur(4px);
		}
		.author-modal-content {
			background: white;
			border-radius: 16px;
			padding: 32px;
			max-width: 900px;
			width: 90%;
			max-height: 85vh;
			overflow-y: auto;
			box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
			animation: modalSlideIn 0.3s ease-out;
		}
		.author-modal-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 24px;
			padding-bottom: 16px;
			border-bottom: 2px solid #e0e0e0;
		}
		.author-modal-header h3 {
			margin: 0;
			color: #2c3e50;
			font-size: 1.6em;
		}
		.author-stats {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			padding: 24px;
			border-radius: 12px 12px 0 0;
			box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
		}
		.author-stats h4 {
			margin: 0 0 16px 0;
			font-size: 1.4em;
			font-weight: 600;
		}
		.author-stats-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 16px;
			margin-bottom: 20px;
		}
		.author-stat-item {
			background: rgba(255, 255, 255, 0.15);
			padding: 12px 16px;
			border-radius: 8px;
			backdrop-filter: blur(10px);
		}
		.author-stat-label {
			font-size: 13px;
			opacity: 0.9;
			margin-bottom: 4px;
		}
		.author-stat-value {
			font-size: 1.5em;
			font-weight: 700;
		}
		.author-stats-header {
			font-size: 15px;
			font-weight: 600;
			opacity: 0.95;
			margin-top: 16px;
			padding-top: 16px;
			border-top: 1px solid rgba(255, 255, 255, 0.3);
		}
		.author-modal-close {
			background: none;
			border: none;
			font-size: 28px;
			color: #95a5a6;
			cursor: pointer;
			transition: color 0.2s ease;
			padding: 0;
			width: 32px;
			height: 32px;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		.author-modal-close:hover {
			color: #2c3e50;
		}
		.author-modal-loading {
			text-align: center;
			padding: 40px;
			color: #7f8c8d;
		}
		.author-bibliography {
			list-style: none;
			padding: 0;
			margin: 0;
			background: white;
			border-radius: 0 0 12px 12px;
			box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
		}
		.author-bibliography li {
			padding: 16px 24px;
			border-bottom: 1px solid #e0e0e0;
			font-size: 14px;
			line-height: 1.7;
			color: #2c3e50;
		}
		.author-bibliography li:last-child {
			border-bottom: none;
			border-radius: 0 0 12px 12px;
		}
		.author-bibliography .pub-title {
			font-weight: 600;
			color: #0056a3;
			margin-bottom: 4px;
		}
		.author-bibliography .pub-journal {
			color: #555;
			font-style: italic;
		}
		.author-bibliography .pub-year {
			color: #7f8c8d;
			font-weight: 500;
		}

		/* Pagination */
		.pagination {
			display: flex;
			justify-content: center;
			align-items: center;
			gap: 6px;
			margin: 50px 0 30px;
			padding: 20px;
			background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
			border-radius: 12px;
			box-shadow: 0 2px 8px rgba(0,0,0,0.06);
		}
		.pagination button {
			padding: 10px 16px;
			border: none;
			background: white;
			border-radius: 8px;
			cursor: pointer;
			font-weight: 500;
			color: #2c3e50;
			transition: all 0.3s ease;
			font-size: 14px;
			box-shadow: 0 2px 4px rgba(0,0,0,0.08);
			min-width: 44px;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 6px;
		}
		.pagination button:hover:not(:disabled) {
			background: #3498db;
			color: white;
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
		}
		.pagination button:disabled {
			opacity: 0.3;
			cursor: not-allowed;
			box-shadow: none;
		}
		.pagination button.active {
			background: linear-gradient(135deg, #3498db, #2980b9);
			color: white;
			box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
			font-weight: 600;
		}
		.pagination .page-num {
			min-width: 44px;
			text-align: center;
		}
		.pagination .ellipsis {
			border: none;
			background: transparent;
			cursor: default;
			box-shadow: none;
			color: #95a5a6;
			font-weight: 600;
		}
		.pagination .nav-btn {
			padding: 10px 20px;
			font-weight: 600;
		}
		.pagination .nav-btn i {
			font-size: 12px;
		}

		/* Loading Spinner */
		.loading {
			text-align: center;
			padding: 60px 20px;
		}
		.spinner {
			border: 4px solid #f0f0f0;
			border-top: 4px solid #3498db;
			border-radius: 50%;
			width: 50px;
			height: 50px;
			animation: spin 1s linear infinite;
			margin: 0 auto 20px;
		}
		@keyframes spin {
			0% { transform: rotate(0deg); }
			100% { transform: rotate(360deg); }
		}

		/* Empty State */
		.empty-state {
			text-align: center;
			padding: 80px 20px;
		}
		.empty-state i {
			font-size: 4em;
			color: #bdc3c7;
			margin-bottom: 20px;
		}
		.empty-state h3 {
			color: #7f8c8d;
			font-size: 1.5em;
			margin-bottom: 12px;
		}
		.empty-state p {
			color: #95a5a6;
		}

		/* Responsive */
		@media (max-width: 900px) {
			.hero-content {
				grid-template-columns: 1fr;
				gap: 40px;
				text-align: center;
			}
			.chart-container {
				display: none;
			}
			.hero-left h1 { font-size: 2.4em; }
			.hero-left p { font-size: 1.1em; }
			.nav-links {
				display: none;
			}
		}
		@media (max-width: 768px) {
			.hero-content {
				padding: 40px 15px;
			}
			.hero-left h1 { font-size: 2em; }
			.hero-left p { font-size: 1em; }
			.search-row {
				flex-direction: column;
			}
			.search-field-small {
				flex: 1;
			}
			.results-header {
				flex-direction: column;
				gap: 12px;
				align-items: flex-start;
			}
			.results-actions {
				width: 100%;
				justify-content: space-between;
			}
			.result-item {
				padding: 16px;
			}
			.result-content {
				font-size: 14px;
			}
			.search-hero h1 {
				font-size: 2em;
			}
			.pagination {
				flex-wrap: wrap;
			}
		}
		
		/* ===== ACCESSIBILITY IMPROVEMENTS ===== */
		
		/* Page background */
		body {
			background: linear-gradient(135deg, #f0f7ff 0%, #e3f2fd 100%);
			min-height: 100vh;
		}
		
		/* Skip to main content link */
		.skip-link {
			position: absolute;
			top: -50px;
			left: 10px;
			background: #3498db;
			color: white;
			padding: 10px 20px;
			text-decoration: none;
			z-index: 10001;
			font-weight: 600;
			border-radius: 0 0 8px 8px;
			transition: top 0.3s;
		}
		.skip-link:focus {
			top: 0;
		}
		
		/* Enhanced focus styles for keyboard navigation */
		*:focus {
			outline: 3px solid #3498db;
			outline-offset: 2px;
		}
		
		a:focus {
			outline: 3px solid #3498db;
			outline-offset: 3px;
		}
		
		button:focus {
			outline: 3px solid #3498db;
			outline-offset: 3px;
		}
		
		input:focus, select:focus, textarea:focus {
			outline: 3px solid #3498db;
			outline-offset: 2px;
		}
		
		.nav-links a:focus {
			text-decoration: underline;
		}
		
		.menu-icon {
			cursor: pointer;
			background: none;
			border: none;
			padding: 8px;
		}
		
		.menu-icon:hover,
		.menu-icon:focus {
			background: rgba(52, 152, 219, 0.1);
			border-radius: 4px;
		}
		
		/* Modal accessibility */
		.modal-bg[aria-hidden="true"],
		.author-modal-bg[aria-hidden="true"],
		.citation-modal-bg[aria-hidden="true"] {
			display: none;
		}
		
		.modal-close, .author-modal-close, .citation-modal-close {
			cursor: pointer;
		}
		
		.modal-close:hover, .author-modal-close:hover, .citation-modal-close:hover {
			color: #3498db;
		}
		
		.modal-close:focus, .author-modal-close:focus, .citation-modal-close:focus {
			outline: 3px solid #3498db;
			outline-offset: 2px;
			border-radius: 4px;
		}
		
		/* Ensure sufficient color contrast */
		.result-authors {
			color: #2c3e50;
		}
		
		.result-citation {
			color: #555;
		}
		
		/* Screen reader only text */
		.sr-only {
			position: absolute;
			width: 1px;
			height: 1px;
			padding: 0;
			margin: -1px;
			overflow: hidden;
			clip: rect(0, 0, 0, 0);
			white-space: nowrap;
			border-width: 0;
		}
		</style>
	</head>
	<body class="landing is-preload">
		<!-- Skip to main content link for keyboard users -->
		<a href="#main-content" class="skip-link">Skip to main content</a>
		
		<!-- Page Wrapper -->
		<div id="page-wrapper">
			<!-- Navigation Header -->
			<nav class="top-bar" role="navigation" aria-label="Main navigation">
				<div class="top-bar-content">
					<div class="logo">
						<img src="images/medcityai_logo1.png" alt="MedCityAI Logo" style="height:48px; width:auto;" />
					</div>
					<div class="nav-links" role="menubar">
						<a href="index.html" role="menuitem">New Today</a>
						<a href="search.html" role="menuitem" aria-current="page">Search</a>
						<a href="featured.html" role="menuitem">Featured</a>
						<a href="leaderboard.html" role="menuitem">Leaderboard</a>
						<a href="about.html" role="menuitem">About</a>
						<a href="contact.html" role="menuitem">Contact</a>
					</div>
					<div style="display: flex; align-items: center; gap: 15px;">
						<a href="#subscribe" class="cta-button">Subscribe</a>
						<button class="menu-icon" aria-label="Toggle mobile menu" aria-expanded="false" aria-controls="mobile-menu">
							<span class="sr-only">Menu</span>
							<div aria-hidden="true"></div>
							<div aria-hidden="true"></div>
							<div aria-hidden="true"></div>
						</button>
					</div>
				</div>
			</nav>

			<!-- Hero Section -->
			<section class="hero-section" aria-label="Search banner" style="position:relative; overflow:hidden;">
				<!-- Animated SVG background blobs -->
				<svg class="hero-bg-blobs" width="100%" height="900" viewBox="0 0 1440 900" style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;" aria-hidden="true" role="presentation">
					<defs>
						<linearGradient id="blobGradient1" x1="0" y1="0" x2="1" y2="1">
							<stop offset="0%" stop-color="#3498db" stop-opacity="0.18"/>
							<stop offset="100%" stop-color="#b6c7e0" stop-opacity="0.12"/>
						</linearGradient>
						<linearGradient id="blobGradient2" x1="0" y1="1" x2="1" y2="0">
							<stop offset="0%" stop-color="#e3eaf3" stop-opacity="0.16"/>
							<stop offset="100%" stop-color="#2980b9" stop-opacity="0.10"/>
						</linearGradient>
					</defs>
					<g>
						<circle id="blob1" cx="330" cy="220" r="330" fill="url(#blobGradient1)">
							<animate attributeName="cx" values="330;1110;330" dur="15s" repeatCount="indefinite"/>
							<animate attributeName="cy" values="220;680;220" dur="13.125s" repeatCount="indefinite"/>
						</circle>
						<circle id="blob2" cx="270" cy="180" r="270" fill="url(#blobGradient2)">
							<animate attributeName="cx" values="270;1170;270" dur="16.875s" repeatCount="indefinite"/>
							<animate attributeName="cy" values="180;720;180" dur="11.25s" repeatCount="indefinite"/>
						</circle>
						<circle id="blob3" cx="450" cy="450" r="450" fill="url(#blobGradient1)" opacity="0.7">
							<animate attributeName="cx" values="450;990;450" dur="18.75s" repeatCount="indefinite"/>
							<animate attributeName="cy" values="450;850;450" dur="15s" repeatCount="indefinite"/>
						</circle>
					</g>
				</svg>
				<div class="hero-content">
					<div class="hero-left">
						<div class="subtitle" style="color:#e0e0e0;">Rochester, Minnesota</div>
						<h1 style="color:#fff; text-shadow: 0 4px 18px rgba(0,0,0,0.28);">Search Research Database</h1>
						<p style="color:#e0e0e0;">Search biomedical research publications from Rochester, MN. All information freely sourced from the National Library of Medicine (PubMed).</p>
						<div class="search-bar-container">
							<i class="fas fa-search search-icon"></i>
							<input type="search" id="heroSearchBar" class="search-bar" placeholder="Search by topic or author" aria-label="Search publications">
						</div>
					</div>
					<div class="hero-right">
						<div class="chart-container">
							<img src="images/med_city_publications_web.png" alt="Publication growth chart" style="width: 100%; height: auto; border-radius: 8px;" />
						</div>
					</div>
				</div>
			</section>

			<!-- Results Section -->
			<main id="main-content" role="main">
				<section class="results-section">
					<div id="loadingState" class="loading" style="display: none;" role="status" aria-live="polite">
						<div class="spinner" aria-hidden="true"></div>
						<p style="color: #7f8c8d; font-size: 16px;">Searching PubMed...</p>
					</div>

				<div id="resultsContainer" style="display: none;">
					<div class="results-header">
						<div class="results-count">
							Found <span id="resultCount">0</span> results
						</div>
						<div class="results-actions">
							<div class="select-all-container">
								<input type="checkbox" id="selectAll" />
								<label for="selectAll">Select All</label>
							</div>
							<button id="exportBtn" class="export-btn" onclick="exportToCSV()" disabled>
								<i class="fas fa-download"></i> Export CSV
							</button>
						</div>
					</div>
					
					<div class="results-list" id="resultsContent"></div>
					
					<div id="paginationContainer" class="pagination"></div>
				</div>

				<div id="emptyState" class="empty-state">
					<i class="fas fa-search"></i>
					<h3>Start Your Search</h3>
					<p>Enter your search criteria above to find Rochester, MN research publications</p>
				</div>
			</section>

			<!-- Citation Modal -->
			<div id="citationModal" class="citation-modal citation-modal-bg" role="dialog" aria-modal="true" aria-labelledby="citationModalTitle" aria-hidden="true">
				<div class="citation-modal-content" role="document">
					<div class="citation-modal-header">
						<h3 id="citationModalTitle">Citation Formats</h3>
						<button class="citation-close citation-modal-close" onclick="closeCitationModal()" aria-label="Close citation modal">&times;</button>
					</div>
					
					<div class="citation-tabs" role="tablist">
						<button class="citation-tab active" onclick="switchCitationTab('mla')" role="tab" aria-selected="true" aria-controls="mla-panel">MLA</button>
						<button class="citation-tab" onclick="switchCitationTab('apa')" role="tab" aria-selected="false" aria-controls="apa-panel">APA</button>
						<button class="citation-tab" onclick="switchCitationTab('chicago')" role="tab" aria-selected="false" aria-controls="chicago-panel">Chicago</button>
						<button class="citation-tab" onclick="switchCitationTab('vancouver')" role="tab" aria-selected="false" aria-controls="vancouver-panel">Vancouver</button>
					</div>
					
					<div id="citationText" class="citation-content" role="tabpanel"></div>
					
					<div class="citation-actions">
						<button class="citation-copy-btn" onclick="copyCitation()" aria-label="Copy citation to clipboard">
							<i class="fas fa-copy" aria-hidden="true"></i> Copy Citation
						</button>
					</div>
				</div>
			</div>

			<!-- Author Bibliography Modal -->
			<div id="authorModal" class="author-modal author-modal-bg" role="dialog" aria-modal="true" aria-labelledby="authorModalTitle" aria-hidden="true">
				<div class="author-modal-content" role="document">
					<div class="author-modal-header">
						<h3 id="authorModalTitle">Author Publications</h3>
						<button class="author-modal-close" onclick="closeAuthorModal()" aria-label="Close author publications modal">&times;</button>
					</div>
					<div id="authorStats" class="author-stats" style="display: none;">
						<h4 id="authorFullName"></h4>
						<div class="author-stats-grid">
							<div class="author-stat-item">
								<div class="author-stat-label">Total Publications</div>
								<div class="author-stat-value" id="authorPubCount">0</div>
							</div>
							<div class="author-stat-item">
								<div class="author-stat-label">Primary Department</div>
								<div class="author-stat-value" id="authorDepartment" style="font-size: 1.1em;">—</div>
							</div>
						</div>
						<div class="author-stats-header" id="authorBibHeader">Recent Publications</div>
					</div>
					<div id="authorModalLoading" class="author-modal-loading" style="display: none;" role="status" aria-live="polite">
						<div class="spinner" aria-hidden="true"></div>
						<p>Loading publications...</p>
					</div>
					<ol id="authorBibliography" class="author-bibliography" aria-label="List of author publications"></ol>
				</div>
			</div>

			<!-- Footer -->
			<footer id="footer" style="margin-top: 80px;">
				<ul class="icons">
					<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
					<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
					<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
					<li><a href="#" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
				</ul>
				<ul class="copyright">
					<li>&copy; MedCityAI</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li><li><a href="terms_of_use.html" style="color: #999;">Terms</a> | <a href="privacy_policy.html" style="color: #999;">Privacy</a> | <a href="cookie_policy.html" style="color: #999;">Cookies</a></li>
				</ul>
			</footer>
		</div>

		<!-- Scripts -->
		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/browser.min.js"></script>
		<script src="assets/js/breakpoints.min.js"></script>
		<script src="assets/js/util.js"></script>
		<script src="assets/js/main.js"></script>

		<script>
		// Initialize on page load
		let currentResults = [];
		let currentPage = 1;
		const resultsPerPage = 20;
		let totalResults = 0;
		let selectedArticles = new Set();
		let currentCitationArticle = null;
		let currentCitationStyle = 'mla';

		async function performPubMedSearch(searchQuery) {
			if (searchQuery.length < 2) return;
			
			// Show loading state
			document.getElementById('loadingState').style.display = 'block';
			document.getElementById('resultsContainer').style.display = 'none';
			document.getElementById('emptyState').style.display = 'none';
			
			try {
				// Build PubMed query - always include Rochester location
				const locationFilter = '(Rochester[AD] AND (Minnesota[AD] OR MN[AD]))';
				const fullQuery = `(${searchQuery}) AND ${locationFilter}`;

				// First, get total count
				let countUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&term=${encodeURIComponent(fullQuery)}&retmode=json&retmax=0&sort=pub+date`;
				
				const countResponse = await fetch(countUrl);
				const countData = await countResponse.json();
				const totalCount = parseInt(countData.esearchresult.count);

				let esearchUrl;
				let showNarrowNotice = false;

				// If more than 1000 results, limit to most recent 1000
				if (totalCount > 1000) {
					showNarrowNotice = true;
					esearchUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&term=${encodeURIComponent(fullQuery)}&retmode=json&retmax=1000&sort=pub+date`;
				} else {
					esearchUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&term=${encodeURIComponent(fullQuery)}&retmode=json&retmax=500&sort=pub+date`;
				}

				// Fetch article IDs
				const searchResponse = await fetch(esearchUrl);
				const searchData = await searchResponse.json();
				
				const articleIds = searchData.esearchresult.idlist;

				if (articleIds.length === 0) {
					showNoResults(searchQuery);
					return;
				}

				// Fetch article details in batches (PubMed has limits)
				const batchSize = 200;
				let allArticles = [];
				
				for (let i = 0; i < articleIds.length; i += batchSize) {
					const batchIds = articleIds.slice(i, i + batchSize);
					const efetchUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=pubmed&id=${batchIds.join(',')}&retmode=xml`;
					const fetchResponse = await fetch(efetchUrl);
					const xmlText = await fetchResponse.text();

					// Parse XML
					const parser = new DOMParser();
					const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
					const batchArticles = parseArticles(xmlDoc);
					allArticles = allArticles.concat(batchArticles);
				}

				currentResults = allArticles;
				currentPage = 1;
				
				displayResults();

				// Show narrowed notice if needed
				if (showNarrowNotice) {
					showNarrowedSearchNotice(totalCount, articleIds.length);
				}

			} catch (error) {
				console.error('PubMed search error:', error);
				document.getElementById('loadingState').style.display = 'none';
				document.getElementById('emptyState').style.display = 'block';
				document.getElementById('emptyState').innerHTML = `
					<i class="fas fa-exclamation-triangle" style="color: #e74c3c;"></i>
					<h3>Search Error</h3>
					<p>An error occurred while searching PubMed. Please try again.</p>
				`;
			}
		}

		function showNarrowedSearchNotice(actualTotal, displayed) {
			const resultsContainer = document.getElementById('resultsContainer');
			const existingNotice = document.getElementById('narrowedNotice');
			if (existingNotice) {
				existingNotice.remove();
			}

			const notice = document.createElement('div');
			notice.id = 'narrowedNotice';
			notice.style.cssText = 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 16px 24px; border-radius: 12px; margin-bottom: 24px; box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3); display: flex; align-items: center; gap: 14px; font-size: 15px;';
			notice.innerHTML = `
				<i class="fas fa-info-circle" style="font-size: 1.8em; flex-shrink: 0;"></i>
				<div>
					<strong style="font-size: 16px;">Search Too Broad</strong><br>
					<span style="opacity: 0.95;">Found ${actualTotal.toLocaleString()} total results. Displaying the ${displayed.toLocaleString()} most recent publications. Please narrow your search criteria for more targeted results.</span>
				</div>
			`;
			
			const resultsHeader = document.querySelector('.results-header');
			resultsContainer.insertBefore(notice, resultsHeader.nextSibling);
		}

		function showNoResults(query) {
			document.getElementById('loadingState').style.display = 'none';
			document.getElementById('resultsContainer').style.display = 'none';
			document.getElementById('emptyState').style.display = 'block';
			document.getElementById('emptyState').innerHTML = `
				<i class="fas fa-search"></i>
				<h3>No Results Found</h3>
				<p>No Rochester, MN publications found matching "${query}". Try different keywords.</p>
			`;
		}

		function parseArticles(xmlDoc) {
			const articles = [];
			const articleNodes = xmlDoc.querySelectorAll('PubmedArticle');

			articleNodes.forEach(articleNode => {
				try {
					// PMID
					const pmidNode = articleNode.querySelector('PMID');
					const pmid = pmidNode ? pmidNode.textContent : '';

					// Title
					const titleNode = articleNode.querySelector('ArticleTitle');
					const title = titleNode ? titleNode.textContent : 'No title';

					// Abstract
					const abstractNode = articleNode.querySelector('Abstract');
					let abstract = '';
					if (abstractNode) {
						const abstractTexts = abstractNode.querySelectorAll('AbstractText');
						abstract = Array.from(abstractTexts).map(node => node.textContent).join(' ');
					}

					// Journal
					const journalNode = articleNode.querySelector('Journal Title');
					let journal = journalNode ? journalNode.textContent : '';
					
					// Try abbreviated journal name if full name is long
					if (!journal || journal.split(/\s+/).length > 5) {
						const isoAbbrevNode = articleNode.querySelector('ISOAbbreviation');
						if (isoAbbrevNode && isoAbbrevNode.textContent) {
							journal = isoAbbrevNode.textContent;
						}
					}

					// Publication Date
					const yearNode = articleNode.querySelector('PubDate Year');
					const monthNode = articleNode.querySelector('PubDate Month');
					const dayNode = articleNode.querySelector('PubDate Day');
					
					const year = yearNode ? yearNode.textContent : '';
					const month = monthNode ? monthNode.textContent : '';
					const day = dayNode ? dayNode.textContent : '';
					
					let pubdate = '';
					if (year && month && day) {
						pubdate = `${month} ${day}, ${year}`;
					} else if (year && month) {
						pubdate = `${month} ${year}`;
					} else if (year) {
						pubdate = year;
					}

					// Authors
					const authorNodes = articleNode.querySelectorAll('Author');
					const authors = [];
					const rochesterAuthors = [];

					authorNodes.forEach(authorNode => {
						const lastNameNode = authorNode.querySelector('LastName');
						const foreNameNode = authorNode.querySelector('ForeName');
						
						const lastName = lastNameNode ? lastNameNode.textContent : '';
						const foreName = foreNameNode ? foreNameNode.textContent : '';
						
						let authorName = '';
						if (lastName && foreName) {
							const initials = foreName.split(' ').map(n => n[0]).join('');
							authorName = `${lastName} ${initials}`;
						} else if (lastName) {
							authorName = lastName;
						}

						// Check if Rochester author
						const affiliationNodes = authorNode.querySelectorAll('Affiliation');
						let isRochester = false;
						affiliationNodes.forEach(affNode => {
							const affText = affNode.textContent.toLowerCase();
							if (affText.includes('rochester') && (affText.includes('mn') || affText.includes('minnesota'))) {
								isRochester = true;
							}
						});

						if (authorName) {
							authors.push(authorName);
							if (isRochester) {
								rochesterAuthors.push(authorName);
							}
						}
					});

					// Format authors
					let authorsDisplay = authors.join(', ');
					if (authors.length > 15) {
						authorsDisplay = authors.slice(0, 14).join(', ') + ', et al.';
					}

					articles.push({
						pmid,
						title,
						abstract: abstract || 'No abstract available.',
						journal,
						pubdate,
						year,
						month,
						day,
						authors: authorsDisplay,
						rochesterAuthors,
						url: `https://pubmed.ncbi.nlm.nih.gov/${pmid}/`
					});

				} catch (error) {
					console.error('Error parsing article:', error);
				}
			});

			return articles;
		}

		async function performHeroSearch(query) {
			if (query.length < 2) return;
			
			// Show loading state
			document.getElementById('loadingState').style.display = 'block';
			document.getElementById('resultsContainer').style.display = 'none';
			document.getElementById('emptyState').style.display = 'none';
			
			try {
				const response = await fetch('pubmed_data.csv');
				const csvText = await response.text();
				const lines = csvText.trim().split('\n');
				
				if (lines.length <= 1) {
					showEmptyState();
					return;
				}
				
				const headers = parseCSVLine(lines[0]);
				const results = [];
				
				// Parse and filter results
				for (let i = 1; i < lines.length; i++) {
					if (lines[i].trim()) {
						const values = parseCSVLine(lines[i]);
						const article = {};
						headers.forEach((header, index) => {
							article[header.trim()] = values[index] || '';
						});
						
						// Simple search filter
						const searchText = query.toLowerCase();
						const titleMatch = article.title?.toLowerCase().includes(searchText);
						const abstractMatch = article.abstract?.toLowerCase().includes(searchText);
						const authorMatch = article.authors?.toLowerCase().includes(searchText);
						
						if (titleMatch || abstractMatch || authorMatch) {
							// Parse Rochester authors from the rochester_authors field
							const rochesterAuthorsField = article.rochester_authors || article['rochester_authors'] || '';
							article.rochesterAuthors = rochesterAuthorsField ? rochesterAuthorsField.split('|').map(a => a.trim()) : [];
							
							// Use authors_display if available, otherwise use authors
							if (article.authors_display || article['authors_display']) {
								article.authors = article.authors_display || article['authors_display'];
							}
							
							results.push(article);
						}
					}
				}
				
				currentResults = results;
				totalResults = results.length;
				currentPage = 1;
				
				if (results.length > 0) {
					displayResults();
				} else {
					// Show no results message
					document.getElementById('loadingState').style.display = 'none';
					document.getElementById('resultsContainer').style.display = 'none';
					document.getElementById('emptyState').style.display = 'block';
					document.getElementById('emptyState').innerHTML = `
						<i class="fas fa-search"></i>
						<h3>No Results Found</h3>
						<p>No publications found matching "${query}". Try different keywords.</p>
					`;
				}
				
			} catch (error) {
				console.error('Search error:', error);
				showEmptyState();
			}
		}

		function parseCSVLine(line) {
			const result = [];
			let current = '';
			let inQuotes = false;
			
			for (let i = 0; i < line.length; i++) {
				const char = line[i];
				const nextChar = line[i + 1];
				
				if (char === '"') {
					if (inQuotes && nextChar === '"') {
						current += '"';
						i++;
					} else {
						inQuotes = !inQuotes;
					}
				} else if (char === ',' && !inQuotes) {
					result.push(current);
					current = '';
				} else {
					current += char;
				}
			}
			result.push(current);
			return result;
		}

		function showEmptyState() {
			document.getElementById('loadingState').style.display = 'none';
			document.getElementById('resultsContainer').style.display = 'none';
			document.getElementById('emptyState').style.display = 'block';
			document.getElementById('emptyState').innerHTML = `
				<i class="fas fa-search"></i>
				<h3>Start Your Search</h3>
				<p>Enter your search criteria above to find Rochester, MN research publications</p>
			`;
		}

		// Select All Handler
		document.addEventListener('DOMContentLoaded', function() {
			// Show empty state initially
			showEmptyState();
			
			// Hero Search Bar Handler
			const heroSearchBar = document.getElementById('heroSearchBar');
			if (heroSearchBar) {
				heroSearchBar.addEventListener('keypress', function(e) {
					if (e.key === 'Enter') {
						e.preventDefault();
						const query = e.target.value.trim();
						if (query.length >= 2) {
							performPubMedSearch(query);
						}
					}
				});
			}
			
			// Select All Handler
			const selectAllCheckbox = document.getElementById('selectAll');
			if (selectAllCheckbox) {
				selectAllCheckbox.addEventListener('change', function(e) {
					const checkboxes = document.querySelectorAll('.article-checkbox');
					checkboxes.forEach(cb => {
						cb.checked = e.target.checked;
						const pmid = cb.dataset.pmid;
						if (e.target.checked) {
							selectedArticles.add(pmid);
							cb.closest('.result-item').classList.add('selected');
						} else {
							selectedArticles.delete(pmid);
							cb.closest('.result-item').classList.remove('selected');
						}
					});
					updateExportButton();
				});
			}
		});

		// Update Export Button State
		function updateExportButton() {
			const exportBtn = document.getElementById('exportBtn');
			if (!exportBtn) return;
			
			exportBtn.disabled = selectedArticles.size === 0;
			if (selectedArticles.size > 0) {
				exportBtn.innerHTML = `<i class="fas fa-download"></i> Export CSV (${selectedArticles.size})`;
			} else {
				exportBtn.innerHTML = `<i class="fas fa-download"></i> Export CSV`;
			}
		}

		// Export to CSV
		function exportToCSV() {
			if (selectedArticles.size === 0) return;

			// Get selected articles
			const selectedData = currentResults.filter(article => selectedArticles.has(article.pmid));

			// Build CSV content
			const headers = ['PMID', 'Title', 'Authors', 'Journal', 'Publication Date', 'Abstract', 'URL'];
			let csvContent = headers.join(',') + '\n';

			selectedData.forEach(article => {
				const row = [
					article.pmid,
					`"${(article.title || '').replace(/"/g, '""')}"`,
					`"${(article.authors || '').replace(/"/g, '""')}"`,
					`"${(article.journal || '').replace(/"/g, '""')}"`,
					article.pubdate || '',
					`"${(article.abstract || '').replace(/"/g, '""')}"`,
					article.url || ''
				];
				csvContent += row.join(',') + '\n';
			});

			// Create download
			const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
			const link = document.createElement('a');
			const url = URL.createObjectURL(blob);
			link.setAttribute('href', url);
			link.setAttribute('download', `pubmed_search_results_${new Date().toISOString().split('T')[0]}.csv`);
			link.style.visibility = 'hidden';
			document.body.appendChild(link);
			link.click();
			document.body.removeChild(link);
		}

		function displayResults() {
			document.getElementById('loadingState').style.display = 'none';
			document.getElementById('resultsContainer').style.display = 'block';
			document.getElementById('emptyState').style.display = 'none';

			// Update result count
			document.getElementById('resultCount').textContent = currentResults.length.toLocaleString();

			// Calculate pagination
			const totalPages = Math.ceil(currentResults.length / resultsPerPage);
			const startIdx = (currentPage - 1) * resultsPerPage;
			const endIdx = Math.min(startIdx + resultsPerPage, currentResults.length);
			const pageResults = currentResults.slice(startIdx, endIdx);

			// Get current date for NEW badge logic (last month)
			const now = new Date();
			const oneMonthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());

			// Display results
			let resultsHTML = '';
			pageResults.forEach((article, index) => {
				// Parse article date
				let articleDate = null;
				const monthNames = ["", "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
				if (article.year && article.month && article.day) {
					const monthNum = monthNames.indexOf(article.month);
					if (monthNum > 0) {
						articleDate = new Date(article.year, monthNum - 1, article.day);
					}
				} else if (article.year && article.month) {
					const monthNum = monthNames.indexOf(article.month);
					if (monthNum > 0) {
						articleDate = new Date(article.year, monthNum - 1, 1);
					}
				}
				
				// Determine if article is NEW (within last month)
				const isNew = articleDate && articleDate >= oneMonthAgo;

				// Make Rochester authors clickable links
				let authorsHTML = article.authors;
				if (article.rochesterAuthors && article.rochesterAuthors.length > 0) {
					article.rochesterAuthors.forEach(rochAuthor => {
						const escapedAuthor = rochAuthor.replace(/'/g, "\\'");
						const regex = new RegExp(rochAuthor.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
						authorsHTML = authorsHTML.replace(regex, 
							`<span class="roch-author" onclick="showAuthorBibliography('${escapedAuthor}')" tabindex="0" role="button">${rochAuthor}</span>`
						);
					});
				}

				const isSelected = selectedArticles.has(article.pmid);
				const resultNumber = startIdx + index + 1;

				resultsHTML += `
					<div class="result-item ${isSelected ? 'selected' : ''}">
						${isNew ? '<div class="new-badge">NEW</div>' : ''}
						<div class="result-number">#${resultNumber}</div>
						<div class="result-checkbox">
							<input type="checkbox" class="article-checkbox" data-pmid="${article.pmid}" 
								${isSelected ? 'checked' : ''} 
								onchange="toggleArticleSelection('${article.pmid}', this)">
						</div>
						<div class="result-content">
							<a href="${article.url}" target="_blank" class="result-title">${article.title}</a>
							
							<div class="result-meta">
								<div class="result-meta-item">
									<i class="fas fa-calendar"></i>
									${article.pubdate}
								</div>
								<div class="result-meta-item">
									<i class="fas fa-book"></i>
									${article.journal}
								</div>
								<div class="result-meta-item">
									<i class="fas fa-hashtag"></i>
									${article.pmid}
								</div>
							</div>

							<div class="result-authors">
								${authorsHTML}
							</div>

							<div class="result-actions">
								<a href="${article.url}" target="_blank" class="btn-link primary">
									<i class="fas fa-external-link-alt"></i> View on PubMed
								</a>
								<button class="btn-link" onclick='showCitationModal(${JSON.stringify(article).replace(/'/g, "&apos;")})'>
									<i class="fas fa-quote-right"></i> Cite
								</button>
							</div>
						</div>
					</div>
				`;
			});

			document.getElementById('resultsContent').innerHTML = resultsHTML;

			// Update select all checkbox state
			updateSelectAllCheckbox();

			// Display pagination
			displayPagination(totalPages);

			// Scroll to results
			document.getElementById('resultsContainer').scrollIntoView({ behavior: 'smooth', block: 'start' });
		}

		// Toggle individual article selection
		function toggleArticleSelection(pmid, checkbox) {
			const resultItem = checkbox.closest('.result-item');
			if (checkbox.checked) {
				selectedArticles.add(pmid);
				resultItem.classList.add('selected');
			} else {
				selectedArticles.delete(pmid);
				resultItem.classList.remove('selected');
			}
			updateSelectAllCheckbox();
			updateExportButton();
		}

		// Update select all checkbox state
		function updateSelectAllCheckbox() {
			const checkboxes = document.querySelectorAll('.article-checkbox');
			const selectAllCheckbox = document.getElementById('selectAll');
			if (!selectAllCheckbox) return;
			
			const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
			
			selectAllCheckbox.checked = checkboxes.length > 0 && checkedCount === checkboxes.length;
			selectAllCheckbox.indeterminate = checkedCount > 0 && checkedCount < checkboxes.length;
		}

		function displayPagination(totalPages) {
			if (totalPages <= 1) {
				document.getElementById('paginationContainer').style.display = 'none';
				return;
			}

			document.getElementById('paginationContainer').style.display = 'flex';
			
			let paginationHTML = '';

			// Previous button
			paginationHTML += `<button class="nav-btn" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
				<i class="fas fa-chevron-left"></i> Previous
			</button>`;

			// Page numbers with smart ellipsis
			const maxVisible = 7;
			let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
			let endPage = Math.min(totalPages, startPage + maxVisible - 1);
			
			if (endPage - startPage < maxVisible - 1) {
				startPage = Math.max(1, endPage - maxVisible + 1);
			}

			// First page
			if (startPage > 1) {
				paginationHTML += `<button class="page-num ${1 === currentPage ? 'active' : ''}" onclick="changePage(1)">1</button>`;
				if (startPage > 2) {
					paginationHTML += `<button class="ellipsis" disabled>...</button>`;
				}
			}

			// Page numbers
			for (let i = startPage; i <= endPage; i++) {
				paginationHTML += `<button class="page-num ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
			}

			// Last page
			if (endPage < totalPages) {
				if (endPage < totalPages - 1) {
					paginationHTML += `<button class="ellipsis" disabled>...</button>`;
				}
				paginationHTML += `<button class="page-num ${totalPages === currentPage ? 'active' : ''}" onclick="changePage(${totalPages})">${totalPages}</button>`;
			}

			// Next button
			paginationHTML += `<button class="nav-btn" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
				Next <i class="fas fa-chevron-right"></i>
			</button>`;

			document.getElementById('paginationContainer').innerHTML = paginationHTML;
		}

		function changePage(page) {
			const totalPages = Math.ceil(currentResults.length / resultsPerPage);
			if (page < 1 || page > totalPages) return;
			
			currentPage = page;
			displayResults();
		}

		function showEmptyResults() {
			document.getElementById('loadingState').style.display = 'none';
			document.getElementById('resultsContainer').style.display = 'none';
			document.getElementById('emptyState').style.display = 'block';
			document.getElementById('emptyState').innerHTML = `
				<i class="fas fa-search"></i>
				<h3>No Results Found</h3>
				<p>Try adjusting your search criteria or expanding the time range</p>
			`;
		}

		// Citation Modal Functions
		function showCitationModal(article) {
			currentCitationArticle = article;
			currentCitationStyle = 'mla';
			
			// Reset tabs
			document.querySelectorAll('.citation-tab').forEach(tab => tab.classList.remove('active'));
			document.querySelector('.citation-tab').classList.add('active');
			
			// Generate citation
			generateCitation();
			
			// Show modal
			document.getElementById('citationModal').style.display = 'flex';
		}

		function closeCitationModal() {
			const modal = document.getElementById('citationModal');
			modal.style.display = 'none';
			modal.setAttribute('aria-hidden', 'true');
			currentCitationArticle = null;
			
			// Return focus to triggering element
			if (window.lastFocusedElement) {
				window.lastFocusedElement.focus();
			}
		}
		
		function closeAuthorModal() {
			const modal = document.getElementById('authorModal');
			modal.style.display = 'none';
			modal.setAttribute('aria-hidden', 'true');
			
			// Return focus to triggering element
			if (window.lastFocusedElement) {
				window.lastFocusedElement.focus();
			}
		}
		
		// Keyboard accessibility for modals
		document.addEventListener('keydown', function(e) {
			if (e.key === 'Escape') {
				const citationModal = document.getElementById('citationModal');
				const authorModal = document.getElementById('authorModal');
				
				if (citationModal.style.display === 'flex') {
					closeCitationModal();
				} else if (authorModal.style.display === 'flex') {
					closeAuthorModal();
				}
			}
		});
		
		// Store focus before opening modal
		function openCitationModal(article) {
			window.lastFocusedElement = document.activeElement;
			showCitationModal(article);
			const modal = document.getElementById('citationModal');
			modal.setAttribute('aria-hidden', 'false');
		}
		
		function openAuthorBibliography(authorName) {
			window.lastFocusedElement = document.activeElement;
			const modal = document.getElementById('authorModal');
			modal.setAttribute('aria-hidden', 'false');
			// Call existing function
			showAuthorBibliography(authorName);
		}

		function switchCitationTab(style) {
			currentCitationStyle = style;
			
			// Update active tab
			document.querySelectorAll('.citation-tab').forEach(tab => tab.classList.remove('active'));
			event.target.classList.add('active');
			
			// Generate new citation
			generateCitation();
		}

		function generateCitation() {
			if (!currentCitationArticle) return;
			
			const article = currentCitationArticle;
			let citation = '';
			
			// Parse authors
			const authors = article.authors.split(', ').filter(a => a && !a.includes('et al'));
			const firstAuthor = authors[0] || 'Unknown Author';
			const year = article.year || 'n.d.';
			
			switch(currentCitationStyle) {
				case 'mla':
					// MLA Format: Last, First. "Title." Journal, vol. #, no. #, Year, pp. #-#.
					citation = `${firstAuthor}`;
					if (authors.length > 1) {
						citation += `, et al`;
					}
					citation += `. "${article.title}" ${article.journal}, ${year}. PubMed, ${article.url}.`;
					break;
					
				case 'apa':
					// APA Format: Author, A. A. (Year). Title. Journal Name, volume(issue), pages.
					citation = `${firstAuthor}`;
					if (authors.length > 1) {
						citation += `, et al.`;
					}
					citation += ` (${year}). ${article.title} ${article.journal}. ${article.url}`;
					break;
					
				case 'chicago':
					// Chicago Format: Author. "Title." Journal Volume, no. Issue (Year): Pages.
					citation = `${firstAuthor}`;
					if (authors.length > 1) {
						citation += ` et al.`;
					}
					citation += ` "${article.title}" ${article.journal} (${year}). ${article.url}.`;
					break;
					
				case 'vancouver':
					// Vancouver Format: Author AA. Title. Journal. Year;volume(issue):pages.
					const vancouverAuthor = firstAuthor.split(' ').reverse().join(' ');
					citation = `${vancouverAuthor}`;
					if (authors.length > 1) {
						citation += `, et al`;
					}
					citation += `. ${article.title} ${article.journal}. ${year}. PMID: ${article.pmid}. Available from: ${article.url}`;
					break;
			}
			
			document.getElementById('citationText').textContent = citation;
		}

		function copyCitation() {
			const citationText = document.getElementById('citationText').textContent;
			const copyBtn = document.querySelector('.citation-copy-btn');
			
			navigator.clipboard.writeText(citationText).then(() => {
				// Show success feedback
				copyBtn.classList.add('copied');
				copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
				
				setTimeout(() => {
					copyBtn.classList.remove('copied');
					copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copy Citation';
				}, 2000);
			});
		}

		// Author Bibliography Modal Functions
		async function showAuthorBibliography(authorName) {
			const modal = document.getElementById('authorModal');
			const title = document.getElementById('authorModalTitle');
			const loading = document.getElementById('authorModalLoading');
			const bibliography = document.getElementById('authorBibliography');
			const statsDiv = document.getElementById('authorStats');
			
			// Show modal and loading state
			modal.style.display = 'flex';
			title.textContent = `Publications by ${authorName}`;
			loading.style.display = 'block';
			bibliography.innerHTML = '';
			statsDiv.style.display = 'none';
			
			try {
				// Build query for this author + Rochester affiliation
				const query = `(${authorName}[Author]) AND (Rochester[AD] AND (Minnesota[AD] OR MN[AD]))`;
				
				// First, get total count
				const countUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&term=${encodeURIComponent(query)}&retmode=json&retmax=0`;
				const countResponse = await fetch(countUrl);
				const countData = await countResponse.json();
				const totalCount = parseInt(countData.esearchresult.count);
				
				if (totalCount === 0) {
					bibliography.innerHTML = '<li style="color: #7f8c8d; text-align: center; padding: 40px;">No publications found for this author.</li>';
					loading.style.display = 'none';
					return;
				}
				
				// Search PubMed for most recent 100
				const searchUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&term=${encodeURIComponent(query)}&retmax=100&retmode=json&sort=pub+date`;
				const searchResponse = await fetch(searchUrl);
				const searchData = await searchResponse.json();
				
				const articleIds = searchData.esearchresult.idlist;
				
				// Fetch article details
				const fetchUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=pubmed&id=${articleIds.join(',')}&retmode=xml`;
				const fetchResponse = await fetch(fetchUrl);
				const xmlText = await fetchResponse.text();
				
				// Parse XML
				const parser = new DOMParser();
				const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
				const articleNodes = xmlDoc.querySelectorAll('PubmedArticle');
				
				// Extract full name and departments
				let fullName = authorName;
				const departments = {};
				const articles = [];
				
				articleNodes.forEach(articleNode => {
					try {
						// Find the author and get full name
						const authorNodes = articleNode.querySelectorAll('Author');
						authorNodes.forEach(authorNode => {
							const lastNameNode = authorNode.querySelector('LastName');
							const foreNameNode = authorNode.querySelector('ForeName');
							const lastName = lastNameNode ? lastNameNode.textContent : '';
							const foreName = foreNameNode ? foreNameNode.textContent : '';
							
							// Check if this matches our author
							if (lastName && foreName && authorName.includes(lastName)) {
								fullName = `${foreName} ${lastName}`;
								
								// Extract department from affiliation
								const affiliationNodes = authorNode.querySelectorAll('Affiliation');
								affiliationNodes.forEach(affNode => {
									const affText = affNode.textContent;
									if (affText.toLowerCase().includes('rochester')) {
										// Try to extract department name
										const deptMatch = affText.match(/Department of ([^,;.]+)/i);
										if (deptMatch) {
											const dept = deptMatch[1].trim();
											departments[dept] = (departments[dept] || 0) + 1;
										}
									}
								});
							}
						});
						
						// Parse article details
						const pmidNode = articleNode.querySelector('PMID');
						const pmid = pmidNode ? pmidNode.textContent : '';
						
						const titleNode = articleNode.querySelector('ArticleTitle');
						const title = titleNode ? titleNode.textContent : 'No title';
						
						const journalNode = articleNode.querySelector('Journal Title');
						let journal = journalNode ? journalNode.textContent : '';
						if (!journal || journal.split(/\s+/).length > 5) {
							const isoAbbrevNode = articleNode.querySelector('ISOAbbreviation');
							if (isoAbbrevNode) journal = isoAbbrevNode.textContent;
						}
						
						const yearNode = articleNode.querySelector('PubDate Year');
						const year = yearNode ? yearNode.textContent : '';
						
						const monthNode = articleNode.querySelector('PubDate Month');
						const month = monthNode ? monthNode.textContent : '';
						
						let pubdate = '';
						if (year && month) {
							pubdate = `${month} ${year}`;
						} else if (year) {
							pubdate = year;
						}
						
						const authorNodesAll = articleNode.querySelectorAll('Author');
						const authorsArray = [];
						authorNodesAll.forEach(an => {
							const ln = an.querySelector('LastName');
							const fn = an.querySelector('ForeName');
							if (ln && fn) {
								const initials = fn.textContent.split(' ').map(n => n[0]).join('');
								authorsArray.push(`${ln.textContent} ${initials}`);
							}
						});
						let authorsDisplay = authorsArray.join(', ');
						if (authorsArray.length > 15) {
							authorsDisplay = authorsArray.slice(0, 14).join(', ') + ', et al.';
						}
						
						articles.push({
							pmid,
							title,
							journal,
							year,
							pubdate,
							authors: authorsDisplay,
							url: `https://pubmed.ncbi.nlm.nih.gov/${pmid}/`
						});
						
					} catch (error) {
						console.error('Error parsing article:', error);
					}
				});
				
				// Sort by year (most recent first)
				articles.sort((a, b) => {
					const yearA = parseInt(a.year) || 0;
					const yearB = parseInt(b.year) || 0;
					return yearB - yearA;
				});
				
				// Find most common department
				let primaryDepartment = '—';
				let maxCount = 0;
				for (const [dept, count] of Object.entries(departments)) {
					if (count > maxCount) {
						maxCount = count;
						primaryDepartment = dept;
					}
				}
				
				// Display stats with actual total count
				document.getElementById('authorFullName').textContent = fullName;
				document.getElementById('authorPubCount').textContent = totalCount;
				document.getElementById('authorDepartment').textContent = primaryDepartment;
				
				// Update bibliography header
				const bibHeader = document.getElementById('authorBibHeader');
				if (articles.length < totalCount) {
					bibHeader.textContent = `Recent Publications (showing ${articles.length} of ${totalCount})`;
				} else {
					bibHeader.textContent = `All Publications (${totalCount})`;
				}
				
				statsDiv.style.display = 'block';
				
				// Display bibliography with numbering
				let bibliographyHTML = '';
				articles.forEach((article, index) => {
					const citation = generateMLACitation(article);
					bibliographyHTML += `<li><strong style="color: #3498db; margin-right: 8px;">${index + 1}.</strong>${citation}</li>`;
				});
				
				bibliography.innerHTML = bibliographyHTML;
				loading.style.display = 'none';
				
			} catch (error) {
				console.error('Error fetching author bibliography:', error);
				bibliography.innerHTML = '<li style="color: #e74c3c; text-align: center; padding: 40px;">Error loading publications. Please try again.</li>';
				loading.style.display = 'none';
			}
		}
		
		function generateMLACitation(article) {
			// Format: Authors. "Title." Journal, Month Year.
			const dateStr = article.pubdate || article.year || 'n.d.';
			return `${article.authors}. "${article.title}" <span class="pub-journal">${article.journal}</span>, <span class="pub-year">${dateStr}</span>. <a href="${article.url}" target="_blank" style="color: #3498db;">PubMed</a>`;
		}
		
		function closeAuthorModal() {
			document.getElementById('authorModal').style.display = 'none';
		}

		// Close modal when clicking outside
		document.getElementById('citationModal').addEventListener('click', function(e) {
			if (e.target === this) {
				closeCitationModal();
			}
		});
		
		document.getElementById('authorModal').addEventListener('click', function(e) {
			if (e.target === this) {
				closeAuthorModal();
			}
		});
		</script>
	</body>
</html>
