<!DOCTYPE HTML>
<!--
	MedCityAI - Research Leaderboard
-->
<html lang="en">
	<head>
		<title>Research Leaderboard - MedCityAI</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
		<style>
			/* Hero Section - Compact version */
			.hero-section {
				background: linear-gradient(120deg, #2568BE 0%, #1B4C7D 100%);
				min-height: 200px;
				display: flex;
				align-items: center;
				position: relative;
				overflow: hidden;
				margin-top: 70px;
				z-index: 1;
			}
			
			.hero-bg-blobs {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				z-index: 0;
				pointer-events: none;
				opacity: 1;
				transition: opacity 0.5s;
			}
			
			.hero-content {
				max-width: 1200px;
				margin: 0 auto;
				padding: 20px;
				position: relative;
				z-index: 2;
				text-align: center;
			}
			
			.hero-content h1 {
				color: #fff;
				font-size: 2.5em;
				margin-bottom: 8px;
				text-shadow: 0 4px 18px rgba(0,0,0,0.28);
			}
			
			.hero-content .subtitle {
				color: #e0e0e0;
				font-size: 1em;
				margin-bottom: 8px;
			}
			
			.hero-content .stats {
				color: #e0e0e0;
				font-size: 0.95em;
				margin-top: 10px;
			}
			
			.trophy-icons {
				font-size: 3em;
				margin: 20px 0;
			}
			
			.trophy-icons i {
				margin: 0 15px;
				animation: float 3s ease-in-out infinite;
			}
			
			.trophy-icons i:nth-child(1) {
				color: #FFD700;
				animation-delay: 0s;
			}
			
			.trophy-icons i:nth-child(2) {
				color: #C0C0C0;
				animation-delay: 0.5s;
			}
			
			.trophy-icons i:nth-child(3) {
				color: #CD7F32;
				animation-delay: 1s;
			}
			
			@keyframes float {
				0%, 100% { transform: translateY(0px); }
				50% { transform: translateY(-20px); }
			}
			
			/* Leaderboard Container */
			.leaderboard-container {
				max-width: 1200px;
				margin: 20px auto;
				padding: 0 20px;
			}
			
			/* Tab Navigation */
			.tab-navigation {
				display: flex;
				gap: 0;
				background: white;
				border-radius: 12px 12px 0 0;
				box-shadow: 0 2px 10px rgba(0,0,0,0.05);
				margin-bottom: 0;
				overflow: hidden;
			}
			
			.tab-button {
				flex: 1;
				padding: 18px 20px;
				background: #f8f9fa;
				border: none;
				border-bottom: 3px solid transparent;
				cursor: pointer;
				font-size: 1.1em;
				font-weight: 600;
				color: #666;
				transition: all 0.3s ease;
				text-align: center;
			}
			
			.tab-button:hover {
				background: #e9ecef;
				color: #2568BE;
			}
			
			.tab-button.active {
				background: white;
				color: #2568BE;
				border-bottom-color: #2568BE;
			}
			
			.tab-content {
				display: none;
				background: white;
				border-radius: 0 0 12px 12px;
				padding: 30px;
				box-shadow: 0 5px 20px rgba(0,0,0,0.08);
			}
			
			.tab-content.active {
				display: block;
			}
			
			/* Stats Bar */
			.stats-bar {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
				gap: 15px;
				margin-bottom: 30px;
				padding: 20px;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				border-radius: 12px;
				color: white;
			}
			
			.stat-item {
				text-align: center;
			}
			
			.stat-value {
				font-size: 2em;
				font-weight: bold;
				display: block;
				margin-bottom: 5px;
			}
			
			.stat-label {
				font-size: 0.9em;
				opacity: 0.9;
			}
			
			/* Data Tables */
			.data-table {
				width: 100%;
				border-collapse: collapse;
				margin: 20px 0;
			}
			
			.data-table thead {
				background: #f8f9fa;
				border-bottom: 2px solid #2568BE;
			}
			
			.data-table th {
				padding: 12px 15px;
				text-align: left;
				font-weight: 600;
				color: #2568BE;
				font-size: 0.95em;
			}
			
			.data-table th.center {
				text-align: center;
			}
			
			.data-table tbody tr {
				border-bottom: 1px solid #e9ecef;
				transition: background 0.2s ease;
			}
			
			.data-table tbody tr:hover {
				background: #f8f9fa;
			}
			
			.data-table td {
				padding: 10px 15px;
				color: #333;
			}
			
			.rank-col {
				width: 60px;
				text-align: center;
				font-weight: bold;
				font-size: 1.1em;
			}
			
			.rank-col.top-3 {
				font-size: 1.3em;
			}
			
			.count-col {
				width: 100px;
				text-align: center;
				font-weight: bold;
				color: #667eea;
				font-size: 1.05em;
			}
			
			.name-col {
				font-weight: 600;
			}
			
			.name-col.clickable {
				color: #2568BE;
				cursor: pointer;
				transition: color 0.2s;
			}
			
			.name-col.clickable:hover {
				color: #667eea;
				text-decoration: underline;
			}
			
			/* Search/Filter Box */
			.filter-box {
				margin-bottom: 20px;
				display: flex;
				gap: 15px;
				align-items: center;
			}
			
			.filter-box input {
				flex: 1;
				padding: 10px 15px;
				border: 2px solid #e9ecef;
				border-radius: 8px;
				font-size: 1em;
				transition: border-color 0.3s;
			}
			
			.filter-box input:focus {
				outline: none;
				border-color: #2568BE;
			}
			
			.toggle-view {
				display: flex;
				gap: 10px;
			}
			
			.toggle-btn {
				padding: 8px 16px;
				background: #f8f9fa;
				border: 2px solid #e9ecef;
				border-radius: 6px;
				cursor: pointer;
				font-size: 0.9em;
				font-weight: 600;
				color: #666;
				transition: all 0.3s;
			}
			
			.toggle-btn.active {
				background: #2568BE;
				color: white;
				border-color: #2568BE;
			}
			
			/* Compact visualization */
			.compact-chart {
				margin: 20px 0;
			}
			
			.chart-row {
				display: flex;
				align-items: center;
				gap: 15px;
				margin: 8px 0;
			}
			
			.chart-label {
				min-width: 150px;
				font-weight: 600;
				color: #333;
				font-size: 0.95em;
			}
			
			.chart-bar {
				flex: 1;
				height: 24px;
				background: #e9ecef;
				border-radius: 12px;
				position: relative;
				overflow: hidden;
			}
			
			.chart-fill {
				height: 100%;
				background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
				border-radius: 12px;
				display: flex;
				align-items: center;
				justify-content: flex-end;
				padding-right: 8px;
				color: white;
				font-size: 0.85em;
				font-weight: bold;
				transition: width 0.8s ease;
			}
			
			.chart-value {
				min-width: 80px;
				text-align: right;
				font-weight: bold;
				color: #667eea;
			}
			
			/* Section Styles - Remove old styles */
			.section-title {
				font-size: 1.8em;
				color: #2568BE;
				margin-bottom: 20px;
				font-weight: bold;
			}
			
			/* Responsive */
			@media screen and (max-width: 968px) {
				.hero-content h1 {
					font-size: 1.8em;
				}
				
				.tab-button {
					font-size: 0.9em;
					padding: 12px 10px;
				}
				
				.stats-bar {
					grid-template-columns: 1fr;
					gap: 10px;
				}
				
				.stat-value {
					font-size: 1.5em;
				}
				
				.data-table {
					font-size: 0.9em;
				}
				
				.data-table th,
				.data-table td {
					padding: 8px 10px;
				}
				
				.filter-box {
					flex-direction: column;
				}
				
				.toggle-view {
					width: 100%;
					justify-content: center;
				}
			}
			
			/* Top Navigation Bar - matching index.html */
			.top-bar {
				background: #ffffff;
				color: #2c3e50;
				padding: 15px 0;
				font-size: 14px;
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				z-index: 1001;
				box-shadow: 0 2px 10px rgba(0,0,0,0.1);
				border-bottom: 1px solid #eee;
			}
			.top-bar-content {
				max-width: 1200px;
				margin: 0 auto;
				display: flex;
				justify-content: space-between;
				align-items: center;
				padding: 0 20px;
			}
			.logo {
				display: flex;
				align-items: center;
			}
			.logo img {
				height: 40px;
				width: auto;
			}
			.nav-links {
				display: flex;
				gap: 30px;
				align-items: center;
			}
			.nav-links a {
				color: #2c3e50;
				text-decoration: none;
				font-weight: 500;
				font-size: 15px;
				transition: color 0.3s ease;
			}
			.nav-links a:hover {
				color: #3498db;
			}
			.nav-links a[aria-current="page"] {
				color: #3498db;
			}
			.cta-button {
				background: linear-gradient(135deg, #3498db, #2980b9);
				color: white;
				padding: 10px 20px;
				border-radius: 25px;
				text-decoration: none;
				font-weight: 600;
				font-size: 14px;
				transition: all 0.3s ease;
			}
			.cta-button:hover {
				transform: translateY(-1px);
				box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
			}
			.menu-icon {
				display: none;
				flex-direction: column;
				cursor: pointer;
			}
			.menu-icon div {
				width: 25px;
				height: 3px;
				background: #2c3e50;
				margin: 3px 0;
				transition: 0.3s;
			}
		</style>
	</head>
	<body class="landing is-preload">

		<!-- Page Wrapper -->
		<div id="page-wrapper">
			<!-- Modern Medical Navigation Header -->
			<nav class="top-bar" role="navigation" aria-label="Main navigation">
				<div class="top-bar-content">
					<div class="logo">
						<img src="images/medcityai_logo1.png" alt="MedCityAI Logo" style="height:48px; width:auto;" />
					</div>
					<div class="nav-links" role="menubar">
						<a href="index.html" role="menuitem">New Today</a>
						<a href="search.html" role="menuitem">Search</a>
						<a href="featured.html" role="menuitem">Featured</a>
						<a href="leaderboard.html" role="menuitem" aria-current="page">Leaderboard</a>
						<a href="about.html" role="menuitem">About</a>
						<a href="contact.html" role="menuitem">Contact</a>
					</div>
					<div style="display: flex; align-items: center; gap: 15px;">
						<a href="#subscribe" class="cta-button">Subscribe</a>
						<button class="menu-icon" aria-label="Toggle mobile menu" aria-expanded="false" aria-controls="mobile-menu">
							<span class="sr-only">Menu</span>
							<div aria-hidden="true"></div>
							<div aria-hidden="true"></div>
							<div aria-hidden="true"></div>
						</button>
					</div>
				</div>
			</nav>

			<!-- Hero Section -->
			<section class="hero-section" aria-label="Hero banner">
				<svg class="hero-bg-blobs" width="100%" height="200" viewBox="0 0 1440 200" aria-hidden="true" role="presentation">
					<defs>
						<linearGradient id="blobGradient1" x1="0" y1="0" x2="1" y2="1">
							<stop offset="0%" stop-color="#3498db" stop-opacity="0.18"/>
							<stop offset="100%" stop-color="#b6c7e0" stop-opacity="0.12"/>
						</linearGradient>
						<linearGradient id="blobGradient2" x1="0" y1="1" x2="1" y2="0">
							<stop offset="0%" stop-color="#e3eaf3" stop-opacity="0.16"/>
							<stop offset="100%" stop-color="#2980b9" stop-opacity="0.10"/>
						</linearGradient>
					</defs>
					<g>
						<circle id="blob1" cx="200" cy="100" r="150" fill="url(#blobGradient1)">
							<animate attributeName="cx" values="200;1240;200" dur="15s" repeatCount="indefinite"/>
						</circle>
						<circle id="blob2" cx="1200" cy="80" r="120" fill="url(#blobGradient2)">
							<animate attributeName="cx" values="1200;200;1200" dur="16s" repeatCount="indefinite"/>
						</circle>
					</g>
				</svg>
				<div class="hero-content">
					<h1>2025 Leaderboard</h1>
					<p class="subtitle">Rochester's Research Leaders - Updated Monthly</p>
					<div class="stats">
						<strong>65,676</strong> authors | <strong>11,097</strong> publications
					</div>
				</div>
			</section>

			<!-- Tabbed Leaderboard -->
			<div class="leaderboard-container">
				
				<!-- Tab Navigation -->
				<div class="tab-navigation">
					<button class="tab-button active" onclick="switchTab('authors')">By Authors</button>
					<button class="tab-button" onclick="switchTab('departments')">By Departments</button>
					<button class="tab-button" onclick="switchTab('geography')">By Geography</button>
				</div>

				<!-- Authors Tab -->
				<div id="authors-tab" class="tab-content active">
					
					<div class="filter-box">
						<input type="text" id="authorSearch" placeholder="ðŸ” Search authors..." onkeyup="filterTable('authorSearch', 'prolificTable')">
						<div class="toggle-view">
							<button class="toggle-btn active" onclick="toggleAuthorView('prolific')">Most Prolific</button>
							<button class="toggle-btn" onclick="toggleAuthorView('first')">First Authors</button>
						</div>
					</div>

					<!-- Most Prolific Authors Table -->
					<div id="prolific-view">
						<h2 class="section-title">Most Prolific Authors of 2025</h2>
						<table class="data-table" id="prolificTable">
							<thead>
								<tr>
									<th class="center">Rank</th>
									<th>Author Name</th>
									<th class="center">Publications</th>
								</tr>
							</thead>
							<tbody>
								<!-- Will be populated by JavaScript -->
							</tbody>
						</table>
					</div>

					<!-- First Authors Table -->
					<div id="first-view" style="display: none;">
						<h2 class="section-title">Most First-Authored Papers of 2025</h2>
						<table class="data-table" id="firstTable">
							<thead>
								<tr>
									<th class="center">Rank</th>
									<th>Author Name</th>
									<th class="center">Publications</th>
								</tr>
							</thead>
							<tbody>
								<!-- Will be populated by JavaScript -->
							</tbody>
						</table>
					</div>
				</div>

				<!-- Departments Tab -->
				<div id="departments-tab" class="tab-content">

					<h2 class="section-title">Most Publications by Specialty</h2>
					<table class="data-table" id="departmentsTable">
						<thead>
							<tr>
								<th class="center">Rank</th>
								<th>Department</th>
								<th class="center">Publications</th>
							</tr>
						</thead>
						<tbody>
							<!-- Will be populated by JavaScript -->
						</tbody>
					</table>

					<h2 class="section-title" style="margin-top: 40px;">Multidisciplinary Collaboration</h2>
					<p style="color: #666; margin-bottom: 20px;">Publications by number of departments involved</p>
					<div class="compact-chart" id="collaborationChart">
						<!-- Will be populated by JavaScript -->
					</div>
				</div>

				<!-- Geography Tab -->
				<div id="geography-tab" class="tab-content">
					
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-top: 20px;">
						
						<!-- US States -->
						<div>
							<div class="filter-box">
								<input type="text" id="stateSearch" placeholder="ðŸ” Search states..." onkeyup="filterTable('stateSearch', 'statesTable')">
							</div>
							<h2 class="section-title">Top US States</h2>
							<p style="color: #666; margin-bottom: 15px; font-size: 0.9em;">Non-Minnesota collaborations</p>
							<table class="data-table" id="statesTable">
								<thead>
									<tr>
										<th class="center">Rank</th>
										<th>State</th>
										<th class="center">Collaborations</th>
									</tr>
								</thead>
								<tbody>
									<!-- Will be populated by JavaScript -->
								</tbody>
							</table>
						</div>

						<!-- Countries -->
						<div>
							<div class="filter-box">
								<input type="text" id="countrySearch" placeholder="ðŸ” Search countries..." onkeyup="filterTable('countrySearch', 'countriesTable')">
							</div>
							<h2 class="section-title">Top Countries</h2>
							<p style="color: #666; margin-bottom: 15px; font-size: 0.9em;">International collaborations</p>
							<table class="data-table" id="countriesTable">
								<thead>
									<tr>
										<th class="center">Rank</th>
										<th>Country</th>
										<th class="center">Collaborations</th>
									</tr>
								</thead>
								<tbody>
									<!-- Will be populated by JavaScript -->
								</tbody>
							</table>
						</div>
					</div>
				</div>

			</div>

			<div id="authorModal" class="author-modal author-modal-bg" role="dialog" aria-modal="true" aria-labelledby="authorModalTitle" aria-hidden="true">
				<div class="author-modal-content" role="document">
					<div class="author-modal-header">
						<h3 id="authorModalTitle">Author Publications</h3>
						<button class="author-modal-close" id="authorModalCloseBtn" aria-label="Close author publications modal">&times;</button>
					</div>
					<div id="authorStats" class="author-stats" style="display: none;">
					<h4 id="authorFullName" style="font-size: 1.5em; margin-bottom: 20px; color: #2c3e50;"></h4>
						<div class="author-stats-grid">
							<div class="author-stat-item">
								<div class="author-stat-label">Total Publications</div>
								<div class="author-stat-value" id="authorPubCount">0</div>
							</div>
							<div class="author-stat-item">
								<div class="author-stat-label">Primary Department</div>
								<div class="author-stat-value" id="authorDepartment" style="font-size: 1.1em;">â€”</div>
							</div>
						</div>
						<div class="author-stats-header" id="authorBibHeader" style="margin-top: 24px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.2); font-size: 1.1em;">Recent Publications</div>
					</div>
					<div id="authorModalLoading" class="author-modal-loading" style="display: none;" role="status" aria-live="polite">
						<div class="spinner" aria-hidden="true"></div>
						<p>Loading publications...</p>
					</div>
					<ol id="authorBibliography" class="author-bibliography" aria-label="List of author publications"></ol>
				</div>
			</div>

			<!-- Footer -->
			<footer id="footer">
				<div class="inner">
					<section>
						<h2>Get in touch</h2>
						<form method="post" action="#">
							<div class="fields">
								<div class="field half">
									<input type="text" name="name" id="name" placeholder="Name" />
								</div>
								<div class="field half">
									<input type="email" name="email" id="email" placeholder="Email" />
								</div>
								<div class="field">
									<textarea name="message" id="message" placeholder="Message"></textarea>
								</div>
							</div>
							<ul class="actions">
								<li><input type="submit" value="Send" class="primary" /></li>
							</ul>
						</form>
					</section>
					<section>
						<h2>Follow</h2>
						<ul class="icons">
							<li><a href="#" class="icon brands style2 fa-twitter"><span class="label">Twitter</span></a></li>
							<li><a href="#" class="icon brands style2 fa-facebook-f"><span class="label">Facebook</span></a></li>
							<li><a href="#" class="icon brands style2 fa-instagram"><span class="label">Instagram</span></a></li>
							<li><a href="#" class="icon brands style2 fa-github"><span class="label">GitHub</span></a></li>
							<li><a href="#" class="icon solid style2 fa-phone"><span class="label">Phone</span></a></li>
							<li><a href="#" class="icon solid style2 fa-envelope"><span class="label">Email</span></a></li>
						</ul>
					</section>
					<ul class="copyright">
						<li>&copy; MedCityAI. All rights reserved</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
					</ul>
				</div>
			</footer>

		</div>

	<!-- Scripts -->
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/browser.min.js"></script>
	<script src="assets/js/breakpoints.min.js"></script>
	<script src="assets/js/util.js"></script>
	<script src="assets/js/main.js"></script>

	<script>
	// Tab switching
	function switchTab(tabName) {
		// Hide all tabs
		document.querySelectorAll('.tab-content').forEach(tab => {
			tab.classList.remove('active');
		});
		
		// Remove active class from all buttons
		document.querySelectorAll('.tab-button').forEach(btn => {
			btn.classList.remove('active');
		});
		
		// Show selected tab
		document.getElementById(tabName + '-tab').classList.add('active');
		event.target.classList.add('active');
	}
	
	// Toggle author view
	function toggleAuthorView(view) {
		const prolificView = document.getElementById('prolific-view');
		const firstView = document.getElementById('first-view');
		const toggleBtns = document.querySelectorAll('.toggle-btn');
		
		if (view === 'prolific') {
			prolificView.style.display = 'block';
			firstView.style.display = 'none';
			toggleBtns[0].classList.add('active');
			toggleBtns[1].classList.remove('active');
		} else {
			prolificView.style.display = 'none';
			firstView.style.display = 'block';
			toggleBtns[0].classList.remove('active');
			toggleBtns[1].classList.add('active');
		}
	}
	
	// Filter table rows
	function filterTable(inputId, tableId) {
		const input = document.getElementById(inputId);
		const filter = input.value.toUpperCase();
		const table = document.getElementById(tableId);
		const tr = table.getElementsByTagName('tr');
		
		for (let i = 1; i < tr.length; i++) {
			const td = tr[i].getElementsByTagName('td');
			let found = false;
			
			for (let j = 0; j < td.length; j++) {
				if (td[j]) {
					const txtValue = td[j].textContent || td[j].innerText;
					if (txtValue.toUpperCase().indexOf(filter) > -1) {
						found = true;
						break;
					}
				}
			}
			
			tr[i].style.display = found ? '' : 'none';
		}
	}
	
	// Load and parse leaderboard data from CSV
	async function loadLeaderboardData() {
		try {
			const response = await fetch('./database/leaderboard/leaderboard_analytics.csv');
			const text = await response.text();
			const lines = text.split('\n');
			
			const data = {
				totalPapers: 0,
				uniqueAuthors: 0,
				prolificAuthors: [],
				firstAuthors: [],
				departments: [],
				collaboration: [],
				states: [],
				countries: []
			};
			
			let currentSection = '';
			
			for (let i = 0; i < lines.length; i++) {
				const line = lines[i].trim();
				
				// Parse header info
				if (line.startsWith('Total Papers Analyzed:')) {
					data.totalPapers = parseInt(line.split(':')[1].trim());
				} else if (line.startsWith('Unique Authors:')) {
					data.uniqueAuthors = parseInt(line.split(':')[1].trim());
				}
				
				// Detect sections
				if (line.includes('TOP 10 MOST PROLIFIC AUTHORS')) {
					currentSection = 'prolific';
					i++; // Skip header row
				} else if (line.includes('TOP 10 FIRST AUTHORS')) {
					currentSection = 'first';
					i++; // Skip header row
				} else if (line.includes('TOP 10 DEPARTMENTS')) {
					currentSection = 'departments';
					i++; // Skip header row
				} else if (line.includes('MULTIDISCIPLINARY COLLABORATION')) {
					currentSection = 'collaboration';
					i++; // Skip header row
				} else if (line.includes('TOP 10 NON-MINNESOTA US STATES')) {
					currentSection = 'states';
					i++; // Skip header row
				} else if (line.includes('TOP 10 NON-USA COUNTRIES')) {
					currentSection = 'countries';
					i++; // Skip header row
				} else if (line && currentSection && !line.startsWith('Rank') && !line.startsWith('Number')) {
					// Parse data rows
					const parts = line.split(',');
					if (parts.length >= 2) {
						const rank = parts[0];
						
						if (currentSection === 'prolific' && parts.length >= 3) {
							const author = parts[1].replace(/"/g, '').trim();
							const count = parseInt(parts[2]);
							data.prolificAuthors.push({ rank, author, count });
						} else if (currentSection === 'first' && parts.length >= 3) {
							const author = parts[1].replace(/"/g, '').trim();
							const count = parseInt(parts[2]);
							data.firstAuthors.push({ rank, author, count });
						} else if (currentSection === 'departments' && parts.length >= 3) {
							const department = parts[1].replace(/"/g, '').trim();
							const count = parseInt(parts[2]);
							data.departments.push({ rank, department, count });
						} else if (currentSection === 'collaboration') {
							const deptCount = parts[0].trim();
							const pubCount = parseInt(parts[1]);
							data.collaboration.push({ deptCount, pubCount });
						} else if (currentSection === 'states' && parts.length >= 3) {
							const state = parts[1].replace(/"/g, '').trim();
							const count = parseInt(parts[2]);
							data.states.push({ rank, state, count });
						} else if (currentSection === 'countries' && parts.length >= 3) {
							const country = parts[1].replace(/"/g, '').trim();
							const count = parseInt(parts[2]);
							data.countries.push({ rank, country, count });
						}
					}
				}
			}
			
			return data;
		} catch (error) {
			console.error('Error loading leaderboard data:', error);
			return null;
		}
	}
	
	function getMedalEmoji(rank) {
		return rank;
	}
	
	function formatNumber(num) {
		return num.toLocaleString();
	}
	
	function renderLeaderboardLists(data) {
		// Update hero stats
		const heroStats = document.querySelector('.hero-content .stats');
		if (heroStats && data.uniqueAuthors && data.totalPapers) {
			heroStats.innerHTML = `<strong>${formatNumber(data.uniqueAuthors)}</strong> authors | <strong>${formatNumber(data.totalPapers)}</strong> publications`;
		}
		
		// Render Most Prolific Authors Table (expand to top 20)
		const prolificTableBody = document.querySelector('#prolificTable tbody');
		if (prolificTableBody && data.prolificAuthors.length > 0) {
			prolificTableBody.innerHTML = data.prolificAuthors.slice(0, 20).map((item, index) => {
				const rank = parseInt(item.rank);
				const medal = rank === 1 ? 'ðŸ¥‡' : rank === 2 ? 'ðŸ¥ˆ' : rank === 3 ? 'ðŸ¥‰' : rank;
				const rankClass = rank <= 3 ? 'top-3' : '';
				return `
					<tr>
						<td class="rank-col ${rankClass}">${medal}</td>
						<td class="name-col clickable" onclick="handleAuthorClick('${item.author}')">${item.author}</td>
						<td class="count-col">${item.count}</td>
					</tr>
				`;
			}).join('');
		}
		
		// Render First Authors Table (expand to top 20)
		const firstTableBody = document.querySelector('#firstTable tbody');
		if (firstTableBody && data.firstAuthors.length > 0) {
			firstTableBody.innerHTML = data.firstAuthors.slice(0, 20).map((item, index) => {
				const rank = parseInt(item.rank);
				const medal = rank === 1 ? 'ðŸ¥‡' : rank === 2 ? 'ðŸ¥ˆ' : rank === 3 ? 'ðŸ¥‰' : rank;
				const rankClass = rank <= 3 ? 'top-3' : '';
				return `
					<tr>
						<td class="rank-col ${rankClass}">${medal}</td>
						<td class="name-col clickable" onclick="handleAuthorClick('${item.author}')">${item.author}</td>
						<td class="count-col">${item.count}</td>
					</tr>
				`;
			}).join('');
		}
		
		// Render Departments Table (expand to top 20)
		const departmentsTableBody = document.querySelector('#departmentsTable tbody');
		if (departmentsTableBody && data.departments.length > 0) {
			departmentsTableBody.innerHTML = data.departments.slice(0, 20).map((item, index) => {
				const rank = parseInt(item.rank);
				const medal = rank === 1 ? 'ðŸ¥‡' : rank === 2 ? 'ðŸ¥ˆ' : rank === 3 ? 'ðŸ¥‰' : rank;
				const rankClass = rank <= 3 ? 'top-3' : '';
				return `
					<tr>
						<td class="rank-col ${rankClass}">${medal}</td>
						<td class="name-col">${item.department}</td>
						<td class="count-col">${formatNumber(item.count)}</td>
					</tr>
				`;
			}).join('');
		}
		
		// Render Collaboration Chart
		if (data.collaboration.length > 0) {
			const maxPubs = Math.max(...data.collaboration.map(c => c.pubCount));
			const chartContainer = document.getElementById('collaborationChart');
			if (chartContainer) {
				chartContainer.innerHTML = data.collaboration.map(item => {
					const percentage = (item.pubCount / maxPubs * 100).toFixed(1);
					return `
						<div class="chart-row">
							<div class="chart-label">${item.deptCount}</div>
							<div class="chart-bar">
								<div class="chart-fill" style="width: ${percentage}%;"></div>
							</div>
							<div class="chart-value">${formatNumber(item.pubCount)}</div>
						</div>
					`;
				}).join('');
			}
		}
		
		// Render States Table
		const statesTableBody = document.querySelector('#statesTable tbody');
		if (statesTableBody && data.states.length > 0) {
			statesTableBody.innerHTML = data.states.map((item, index) => {
				const rank = parseInt(item.rank);
				const medal = rank === 1 ? 'ðŸ¥‡' : rank === 2 ? 'ðŸ¥ˆ' : rank === 3 ? 'ðŸ¥‰' : rank;
				const rankClass = rank <= 3 ? 'top-3' : '';
				return `
					<tr>
						<td class="rank-col ${rankClass}">${medal}</td>
						<td class="name-col">${item.state}</td>
						<td class="count-col">${formatNumber(item.count)}</td>
					</tr>
				`;
			}).join('');
		}
		
		// Render Countries Table
		const countriesTableBody = document.querySelector('#countriesTable tbody');
		if (countriesTableBody && data.countries.length > 0) {
			countriesTableBody.innerHTML = data.countries.map((item, index) => {
				const rank = parseInt(item.rank);
				const medal = rank === 1 ? 'ðŸ¥‡' : rank === 2 ? 'ðŸ¥ˆ' : rank === 3 ? 'ðŸ¥‰' : rank;
				const rankClass = rank <= 3 ? 'top-3' : '';
				const displayName = item.country === 'UK' ? 'United Kingdom' : item.country;
				return `
					<tr>
						<td class="rank-col ${rankClass}">${medal}</td>
						<td class="name-col">${displayName}</td>
						<td class="count-col">${formatNumber(item.count)}</td>
					</tr>
				`;
			}).join('');
		}
	}
	
	function handleAuthorClick(authorName) {
		// Convert "Last, First" to "First Last" for PubMed search
		const nameParts = authorName.split(',').map(p => p.trim());
		const searchName = nameParts.length === 2 ? `${nameParts[1]} ${nameParts[0]}` : authorName;
		if (searchName) {
			showAuthorBibliography(searchName);
		}
	}
	
	function attachAuthorClickHandlers() {
		// No longer needed - handled inline in table generation
	}
	
	// Author bibliography modal functions
	async function showAuthorBibliography(authorName) {
		const modal = document.getElementById('authorModal');
		const title = document.getElementById('authorModalTitle');
		const loading = document.getElementById('authorModalLoading');
		const bibliography = document.getElementById('authorBibliography');
		const statsDiv = document.getElementById('authorStats');
		
		// Show modal and loading state
		modal.style.display = 'flex';
		title.textContent = '';
		loading.style.display = 'block';
		bibliography.innerHTML = '';
		statsDiv.style.display = 'none';
		
		try {
			// Build query for this author (all publications)
			const query = `${authorName}[Author]`;
			
			// First, get total count
			const countUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&term=${encodeURIComponent(query)}&retmode=json&retmax=0`;
			const countResponse = await fetch(countUrl);
			const countData = await countResponse.json();
			const totalCount = parseInt(countData.esearchresult.count);
			
			if (totalCount === 0) {
				title.textContent = authorName;
				bibliography.innerHTML = '<li style="color: #7f8c8d; text-align: center; padding: 40px;">No publications found for this author.</li>';
				loading.style.display = 'none';
				return;
			}
			
			// Search PubMed for most recent 100
			const searchUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&term=${encodeURIComponent(query)}&retmax=100&retmode=json&sort=pub+date`;
			const searchResponse = await fetch(searchUrl);
			const searchData = await searchResponse.json();
			
			const articleIds = searchData.esearchresult.idlist;
			
			// Fetch article details
			const fetchUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=pubmed&id=${articleIds.join(',')}&retmode=xml`;
			const fetchResponse = await fetch(fetchUrl);
			const xmlText = await fetchResponse.text();
			
			// Parse XML
			const parser = new DOMParser();
			const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
			const articleNodes = xmlDoc.querySelectorAll('PubmedArticle');
			
			// Extract full name and departments
			let fullName = authorName;
			const departments = {};
			const articles = [];
			
			articleNodes.forEach(articleNode => {
				try {
					// Find the author and get full name
					const authorNodes = articleNode.querySelectorAll('Author');
					authorNodes.forEach(authorNode => {
						const lastNameNode = authorNode.querySelector('LastName');
						const foreNameNode = authorNode.querySelector('ForeName');
						const lastName = lastNameNode ? lastNameNode.textContent : '';
						const foreName = foreNameNode ? foreNameNode.textContent : '';
						
						// Check if this matches our author
						if (lastName && foreName && authorName.includes(lastName)) {
							fullName = `${foreName} ${lastName}`;
							
							// Extract department from affiliation
							const affiliationNodes = authorNode.querySelectorAll('Affiliation');
							affiliationNodes.forEach(affNode => {
								const affText = affNode.textContent;
								if (affText.toLowerCase().includes('rochester')) {
									// Try to extract department name
									const deptMatch = affText.match(/Department of ([^,;.]+)/i);
									if (deptMatch) {
										const dept = deptMatch[1].trim();
										departments[dept] = (departments[dept] || 0) + 1;
									}
								}
							});
						}
					});
					
					// Parse article details
					const pmidNode = articleNode.querySelector('PMID');
					const pmid = pmidNode ? pmidNode.textContent : '';
					
					const titleNode = articleNode.querySelector('ArticleTitle');
					const title = titleNode ? titleNode.textContent : 'No title';
					
					const journalNode = articleNode.querySelector('Journal Title');
					let journal = journalNode ? journalNode.textContent : '';
					if (!journal || journal.split(/\s+/).length > 5) {
						const isoAbbrevNode = articleNode.querySelector('ISOAbbreviation');
						if (isoAbbrevNode) journal = isoAbbrevNode.textContent;
					}
					
					const yearNode = articleNode.querySelector('PubDate Year');
					const year = yearNode ? yearNode.textContent : '';
					
					const monthNode = articleNode.querySelector('PubDate Month');
					const month = monthNode ? monthNode.textContent : '';
					
					let pubdate = '';
					if (year && month) {
						pubdate = `${month} ${year}`;
					} else if (year) {
						pubdate = year;
					}
					
					const authorNodesAll = articleNode.querySelectorAll('Author');
					const authorsArray = [];
					authorNodesAll.forEach(an => {
						const ln = an.querySelector('LastName');
						const fn = an.querySelector('ForeName');
						if (ln && fn) {
							const initials = fn.textContent.split(' ').map(n => n[0]).join('');
							authorsArray.push(`${ln.textContent} ${initials}`);
						}
					});
					let authorsDisplay = authorsArray.join(', ');
					if (authorsArray.length > 15) {
						authorsDisplay = authorsArray.slice(0, 14).join(', ') + ', et al.';
					}
					
					articles.push({
						pmid,
						title,
						journal,
						year,
						pubdate,
						authors: authorsDisplay,
						url: `https://pubmed.ncbi.nlm.nih.gov/${pmid}/`
					});
					
				} catch (error) {
					console.error('Error parsing article:', error);
				}
			});
			
			// Sort by year (most recent first)
			articles.sort((a, b) => {
				const yearA = parseInt(a.year) || 0;
				const yearB = parseInt(b.year) || 0;
				return yearB - yearA;
			});
			
			// Find most common department
			let primaryDepartment = 'â€”';
			let maxCount = 0;
			for (const [dept, count] of Object.entries(departments)) {
				if (count > maxCount) {
					maxCount = count;
					primaryDepartment = dept;
				}
			}
			
			// Display stats with actual total count
			title.textContent = fullName;
			document.getElementById('authorPubCount').textContent = totalCount.toLocaleString();
			document.getElementById('authorDepartment').textContent = primaryDepartment;
			
			// Update bibliography header
			const bibHeader = document.getElementById('authorBibHeader');
			if (articles.length < totalCount) {
				bibHeader.textContent = `Recent Publications (showing ${articles.length} of ${totalCount})`;
			} else {
				bibHeader.textContent = `Recent Publications`;
			}
			
			statsDiv.style.display = 'block';
			
			// Display bibliography with numbering
			let bibliographyHTML = '';
			articles.forEach((article, index) => {
				const citation = generateMLACitation(article);
				bibliographyHTML += `<li><strong style="color: #3498db; margin-right: 8px;">${index + 1}.</strong>${citation}</li>`;
			});
			
			bibliography.innerHTML = bibliographyHTML;
			loading.style.display = 'none';
			
		} catch (error) {
			console.error('Error fetching author bibliography:', error);
			bibliography.innerHTML = '<li style="color: #e74c3c; text-align: center; padding: 40px;">Error loading publications. Please try again.</li>';
			loading.style.display = 'none';
		}
	}
	
	function generateMLACitation(article) {
		// Format: Authors. "Title." Journal, Month Year.
		const dateStr = article.pubdate || article.year || 'n.d.';
		return `${article.authors}. "${article.title}" <span class="pub-journal">${article.journal}</span>, <span class="pub-year">${dateStr}</span>. <a href="${article.url}" target="_blank" style="color: #3498db;">PubMed</a>`;
	}
	
	function closeAuthorModal() {
		document.getElementById('authorModal').style.display = 'none';
	}

	// Set up event listeners after DOM is loaded
	document.addEventListener('DOMContentLoaded', async function() {
		// Load and render leaderboard data from CSV
		const data = await loadLeaderboardData();
		if (data) {
			renderLeaderboardLists(data);
		}
		
		// Close button for author modal
		const authorModalCloseBtn = document.getElementById('authorModalCloseBtn');
		if (authorModalCloseBtn) {
			authorModalCloseBtn.addEventListener('click', closeAuthorModal);
		}

		// Close modal when clicking outside
		const authorModal = document.getElementById('authorModal');
		authorModal.addEventListener('click', function(e) {
			if (e.target === authorModal) closeAuthorModal();
		});
	});
	</script>

</body>
</html>
