<!DOCTYPE HTML>
<!--
	MedCityAI - Research Leaderboard
-->
<html lang="en">
	<head>
		<title>Research Leaderboard - MedCityAI</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="stylesheet" href="assets/css/navigation.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
		<style>
			/* Body background */
			body {
				background: linear-gradient(135deg, #f5f7fa 0%, #e8ecef 100%);
				min-height: 100vh;
			}
			
		/* Hero Section - Compact version */
		.hero-section {
			background-image: linear-gradient(rgba(37, 104, 190, 0.8), rgba(27, 76, 125, 0.8)), url("images/banner.jpg");
			background-attachment: fixed;
			background-position: center center;
			background-repeat: no-repeat;
			background-size: cover;
			min-height: 300px;
			display: flex;
			align-items: center;
			position: relative;
			overflow: hidden;
			z-index: 1;
		}			.hero-bg-blobs {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				z-index: 0;
				pointer-events: none;
				opacity: 1;
				transition: opacity 0.5s;
			}
			
			.hero-content {
				max-width: 1200px;
				margin: 0 auto;
				padding: 20px;
				position: relative;
				z-index: 2;
				text-align: center;
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
			}
			
			.hero-content h1 {
				color: #fff;
				font-size: 3em;
				font-weight: 800;
				margin-bottom: 8px;
				text-shadow: 0 4px 18px rgba(0,0,0,0.28);
			}
			
		.hero-content .subtitle {
			color: #e0e0e0;
			font-size: 1.1em;
			line-height: 1.7;
			margin-bottom: 8px;
		}			.hero-content .stats {
				color: #e0e0e0;
				font-size: 0.95em;
				margin-top: 10px;
			}
			
			.trophy-icons {
				font-size: 3em;
				margin: 20px 0;
			}
			
			.trophy-icons i {
				margin: 0 15px;
				animation: float 3s ease-in-out infinite;
			}
			
			.trophy-icons i:nth-child(1) {
				color: #FFD700;
				animation-delay: 0s;
			}
			
			.trophy-icons i:nth-child(2) {
				color: #C0C0C0;
				animation-delay: 0.5s;
			}
			
			.trophy-icons i:nth-child(3) {
				color: #CD7F32;
				animation-delay: 1s;
			}
			
			@keyframes float {
				0%, 100% { transform: translateY(0px); }
				50% { transform: translateY(-20px); }
			}
			
			/* Leaderboard Container */
			.leaderboard-container {
				max-width: 1200px;
				margin: -40px auto 80px;
				padding: 0 20px;
				position: relative;
				z-index: 10;
			}
			
			/* Tab Navigation */
			.tab-navigation {
				display: flex;
				gap: 0;
				background: white;
				border-radius: 12px 12px 0 0;
				box-shadow: 0 2px 10px rgba(0,0,0,0.05);
				margin-bottom: 0;
				overflow: hidden;
			}
			
			.tab-button {
				flex: 1;
				padding: 18px 20px;
				background: #e8edf2;
				border: 2px solid #d0d7de;
				border-bottom: 3px solid #d0d7de;
				cursor: pointer;
				font-size: 1.1em;
				font-weight: 600;
				color: #666;
				transition: all 0.3s ease;
				text-align: center;
				display: flex;
				align-items: center;
				justify-content: center;
				min-height: 60px;
			}
			
			.tab-button:hover {
				background: #d8e3ed;
				color: #2568BE;
				transform: translateY(-1px);
				box-shadow: 0 2px 8px rgba(0,0,0,0.1);
				border-color: #2568BE;
			}
			
			.tab-button.active {
				background: white;
				color: #2568BE;
				border: 2px solid #2568BE;
				border-bottom: 3px solid #2568BE;
				box-shadow: 0 -2px 8px rgba(0,0,0,0.05);
			}
			
			.tab-content {
				display: none;
				background: white;
				border-radius: 0 0 12px 12px;
				padding: 30px;
				box-shadow: 0 5px 20px rgba(0,0,0,0.08);
			}
			
			.tab-content.active {
				display: block;
			}
			
			/* Stats Bar */
			.stats-bar {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
				gap: 15px;
				margin-bottom: 30px;
				padding: 20px;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				border-radius: 12px;
				color: white;
			}
			
			.stat-item {
				text-align: center;
			}
			
			.stat-value {
				font-size: 2em;
				font-weight: bold;
				display: block;
				margin-bottom: 5px;
			}
			
			.stat-label {
				font-size: 0.9em;
				opacity: 0.9;
			}
			
			/* Data Tables */
			.data-table {
				width: 100%;
				border-collapse: collapse;
				margin: 20px 0;
			}
			
			.data-table thead {
				background: #f8f9fa;
				border-bottom: 2px solid #2568BE;
			}
			
			.data-table th {
				padding: 12px 15px;
				text-align: left;
				font-weight: 600;
				color: #2568BE;
				font-size: 0.95em;
			}
			
			.data-table tbody tr {
				border-bottom: 1px solid #e9ecef;
				transition: background 0.2s ease;
			}
			
			.data-table tbody tr:hover {
				background: #f8f9fa;
			}
			
			.data-table td {
				padding: 10px 15px;
				color: #333;
			}
			
			.rank-col {
				width: 60px;
				font-weight: bold;
				font-size: 1.1em;
			}
			
			.rank-col.top-3 {
				font-size: 1.3em;
			}
			
			.count-col {
				width: 100px;
				font-weight: bold;
				color: #667eea;
				font-size: 1.05em;
			}
			
			.name-col {
				font-weight: 600;
			}
			
			/* Compact visualization */
			.compact-chart {
				margin: 20px 0;
			}
			
			.chart-row {
				display: flex;
				align-items: center;
				gap: 15px;
				margin: 8px 0;
			}
			
			.chart-label {
				min-width: 150px;
				font-weight: 600;
				color: #333;
				font-size: 0.95em;
			}
			
			.chart-bar {
				flex: 1;
				height: 24px;
				background: #e9ecef;
				border-radius: 12px;
				position: relative;
				overflow: hidden;
			}
			
			.chart-fill {
				height: 100%;
				background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
				border-radius: 12px;
				display: flex;
				align-items: center;
				justify-content: flex-end;
				padding-right: 8px;
				color: white;
				font-size: 0.85em;
				font-weight: bold;
				transition: width 0.8s ease;
			}
			
			.chart-value {
				min-width: 80px;
				text-align: right;
				font-weight: bold;
				color: #667eea;
			}
			
			/* Section Styles - Remove old styles */
			.section-title {
				font-size: 1.8em;
				color: #2568BE;
				margin-bottom: 20px;
				font-weight: bold;
			}
			
			/* Responsive */
			@media screen and (max-width: 968px) {
				.hero-content h1 {
					font-size: 1.8em;
				}
				
				/* Hide tab navigation on mobile */
				.tab-navigation {
					display: none;
				}
				
				/* Show all tab content stacked on mobile */
				.tab-content {
					display: block !important;
					margin-bottom: 30px;
					border-radius: 12px;
				}
				
				/* Add section headers for mobile */
				#authors-tab::before {
					content: "By Author";
					display: block;
					font-size: 1.5em;
					font-weight: bold;
					color: #2568BE;
					margin-bottom: 20px;
					text-align: center;
					padding: 15px;
					background: #f8f9fa;
					border-radius: 8px;
				}
				
				#departments-tab::before {
					content: "By Department";
					display: block;
					font-size: 1.5em;
					font-weight: bold;
					color: #2568BE;
					margin-bottom: 20px;
					text-align: center;
					padding: 15px;
					background: #f8f9fa;
					border-radius: 8px;
				}
				
				#geography-tab::before {
					content: "By Geography";
					display: block;
					font-size: 1.5em;
					font-weight: bold;
					color: #2568BE;
					margin-bottom: 20px;
					text-align: center;
					padding: 15px;
					background: #f8f9fa;
					border-radius: 8px;
				}
				
				/* Convert two-column grids to single column on mobile */
				#authors-tab > div,
				#geography-tab > div {
					grid-template-columns: 1fr !important;
					gap: 30px !important;
				}
				
				.stats-bar {
					grid-template-columns: 1fr;
					gap: 10px;
				}
				
				.stat-value {
					font-size: 1.5em;
				}
				
				.data-table {
					font-size: 0.9em;
				}
				
				.data-table th,
				.data-table td {
					padding: 8px 10px;
				}
			}
			
			/* Top Navigation Bar - matching index.html */
			.top-bar {
				background: #ffffff;
				color: #2c3e50;
				padding: 15px 0;
				font-size: 14px;
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				z-index: 1001;
				box-shadow: 0 2px 10px rgba(0,0,0,0.1);
				border-bottom: 1px solid #eee;
			}
			.top-bar-content {
				max-width: 1200px;
				margin: 0 auto;
				display: flex;
				justify-content: space-between;
				align-items: center;
				padding: 0 20px;
			}
			.logo {
				display: flex;
				align-items: center;
			}
			.logo img {
				height: 40px;
				width: auto;
			}
			.nav-links {
				display: flex;
				gap: 30px;
				align-items: center;
			}
			.nav-links a {
				color: #2c3e50;
				text-decoration: none;
				font-weight: 500;
				font-size: 15px;
				transition: color 0.3s ease;
			}
			.nav-links a:hover {
				color: #3498db;
			}
			.nav-links a[aria-current="page"] {
				color: #3498db;
			}
			.cta-button {
				background: linear-gradient(135deg, #3498db, #2980b9);
				color: white;
				padding: 10px 20px;
				border-radius: 25px;
				text-decoration: none;
				font-weight: 600;
				font-size: 14px;
				transition: all 0.3s ease;
			}
			.cta-button:hover {
				transform: translateY(-1px);
				box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
			}
			.menu-icon {
				display: none;
				flex-direction: column;
				cursor: pointer;
			}
			.menu-icon div {
				width: 25px;
				height: 3px;
				background: #2c3e50;
				margin: 3px 0;
				transition: 0.3s;
			}
		</style>
	</head>
	<body class="landing is-preload">

		<!-- Page Wrapper -->
		<div id="page-wrapper">
			<!-- Modern Medical Navigation Header -->
			<div id="navigation-placeholder" data-page="leaderboard"></div>

			<!-- Hero Section -->
			<section class="hero-section" aria-label="Hero banner">
				<svg class="hero-bg-blobs" width="100%" height="200" viewBox="0 0 1440 200" aria-hidden="true" role="presentation">
					<defs>
						<linearGradient id="blobGradient1" x1="0" y1="0" x2="1" y2="1">
							<stop offset="0%" stop-color="#3498db" stop-opacity="0.18"/>
							<stop offset="100%" stop-color="#b6c7e0" stop-opacity="0.12"/>
						</linearGradient>
						<linearGradient id="blobGradient2" x1="0" y1="1" x2="1" y2="0">
							<stop offset="0%" stop-color="#e3eaf3" stop-opacity="0.16"/>
							<stop offset="100%" stop-color="#2980b9" stop-opacity="0.10"/>
						</linearGradient>
					</defs>
					<g>
						<circle id="blob1" cx="200" cy="100" r="150" fill="url(#blobGradient1)">
							<animate attributeName="cx" values="200;1240;200" dur="15s" repeatCount="indefinite"/>
						</circle>
						<circle id="blob2" cx="1200" cy="80" r="120" fill="url(#blobGradient2)">
							<animate attributeName="cx" values="1200;200;1200" dur="16s" repeatCount="indefinite"/>
						</circle>
					</g>
				</svg>
			<div class="hero-content">
				<h1>2025 Year in Review</h1>
			<p class="subtitle" style="font-size: 1.3em; margin-top: 15px; font-weight: 600;">
				Total Publications: 10,787 (new record)
			</p>
			</div>
			</section>
			
			<!-- Tabbed Leaderboard -->
			<div class="leaderboard-container">
				
				<!-- Tab Navigation -->
				<div class="tab-navigation">
				<button class="tab-button active" onclick="switchTab('articles')">By Article</button>
				<button class="tab-button" onclick="switchTab('authors')">By Author</button>
				<button class="tab-button" onclick="switchTab('departments')">By Department</button>
				<button class="tab-button" onclick="switchTab('geography')">By Geography</button>
				</div>

		<!-- Articles Tab -->
		<div id="articles-tab" class="tab-content active">
			<div style="max-width: 1400px; margin-left: auto; margin-right: auto;">
				<h3 style="color: #2568BE; font-size: 1.3em; margin-bottom: 5px; font-weight: 600;">Most Liked Articles This Year</h3>
				<p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">Top publications ranked by user engagement</p>
				<table class="data-table" id="articlesTable">
					<thead>
						<tr>
							<th style="width: 80px;">Rank</th>
							<th>Article Title</th>
							<th style="width: 250px;">Journal</th>
							<th style="width: 100px;">Likes</th>
						</tr>
					</thead>
					<tbody>
						<!-- Will be populated by JavaScript -->
					</tbody>
				</table>
			</div>
		</div>

		<!-- Authors Tab -->
		<div id="authors-tab" class="tab-content">
		<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-top: 20px; max-width: 1400px; margin-left: auto; margin-right: auto;">
				<div>
					<h3 style="color: #2568BE; font-size: 1.3em; margin-bottom: 5px; font-weight: 600;">Overall Count</h3>
					<p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">Researchers with the highest total publication count in 2025</p>
					<table class="data-table" id="prolificTable">
						<thead>
						<tr>
							<th>Rank</th>
							<th>Author Name</th>
							<th>Publications</th>
						</tr>
						</thead>
						<tbody>
							<!-- Will be populated by JavaScript -->
						</tbody>
					</table>
				</div>

				<!-- First Authors -->
				<div>
					<h3 style="color: #2568BE; font-size: 1.3em; margin-bottom: 5px; font-weight: 600;">First Author Count</h3>
					<p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">Researchers who led the most studies as primary/first author</p>
					<table class="data-table" id="firstTable">
						<thead>
							<tr>
								<th >Rank</th>
								<th>Author Name</th>
								<th >Publications</th>
							</tr>
						</thead>
						<tbody>
							<!-- Will be populated by JavaScript -->
						</tbody>
					</table>
				</div>
			</div>
		</div>

	<!-- Departments Tab -->
	<div id="departments-tab" class="tab-content">
		<div style="max-width: 1400px; margin-left: auto; margin-right: auto;">
			<h3 style="color: #2568BE; font-size: 1.3em; margin-bottom: 5px; font-weight: 600;">Top Departments by Publication Volume</h3>
			<p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">Medical specialties and departments ranked by research output</p>
			<table class="data-table" id="departmentsTable">
				<thead>
					<tr>
						<th>Rank</th>
						<th>Department</th>
						<th>Publications</th>
							</tr>
						</thead>
						<tbody>
							<!-- Will be populated by JavaScript -->
						</tbody>
					</table>

					<h3 style="color: #2568BE; font-size: 1.3em; margin-bottom: 5px; font-weight: 600; margin-top: 40px;">Cross-Departmental Collaboration</h3>
					<p style="color: #666; font-size: 0.9em; margin-bottom: 20px;">Distribution of publications by number of collaborating departments</p>
					<div class="compact-chart" id="collaborationChart">
						<!-- Will be populated by JavaScript -->
					</div>
					</div>
				</div>

				<!-- Geography Tab -->
				<div id="geography-tab" class="tab-content">
					
					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-top: 20px; max-width: 1400px; margin-left: auto; margin-right: auto;">
						
						<!-- US States -->
						<div>
							<h3 style="color: #2568BE; font-size: 1.3em; margin-bottom: 5px; font-weight: 600;">ACROSS THE U.S.</h3>
							<p style="color: #666; margin-bottom: 15px; font-size: 0.9em;">Most frequent state collaborations (excluding Minnesota)</p>
							<table class="data-table" id="statesTable">
								<thead>
								<tr>
									<th >Rank</th>
									<th>State</th>
									<th >Publications</th>
								</tr>
								</thead>
								<tbody>
									<!-- Will be populated by JavaScript -->
								</tbody>
							</table>
						</div>

						<!-- Countries -->
						<div>
							<h3 style="color: #2568BE; font-size: 1.3em; margin-bottom: 5px; font-weight: 600;">Global Network</h3>
							<p style="color: #666; margin-bottom: 15px; font-size: 0.9em;">Most frequent international collaborations (excluding U.S.)</p>
							<table class="data-table" id="countriesTable">
								<thead>
								<tr>
									<th >Rank</th>
									<th>Country</th>
									<th >Publications</th>
								</tr>
								</thead>
								<tbody>
									<!-- Will be populated by JavaScript -->
								</tbody>
							</table>
						</div>
					</div>
				</div>

			</div>

		<!-- Footer -->
		<footer id="footer">
			<ul class="icons">
				<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
				<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
				<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
				<li><a href="#" class="icon brands fa-dribbble"><span class="label">Dribbble</span></a></li>
				<li><a href="#" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
			</ul>
			<ul class="copyright">
				<li>&copy; MedCityAI</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li><li><a href="terms_of_use.html" style="color: #999;">Terms</a> | <a href="privacy_policy.html" style="color: #999;">Privacy</a> | <a href="cookie_policy.html" style="color: #999;">Cookies</a></li>
			</ul>
		</footer>		</div>

	<!-- Scripts -->
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/browser.min.js"></script>
	<script src="assets/js/breakpoints.min.js"></script>
	<script src="assets/js/util.js"></script>
	<script src="assets/js/main.js"></script>

	<script>
	// Tab switching
	function switchTab(tabName) {
		// Hide all tabs
		document.querySelectorAll('.tab-content').forEach(tab => {
			tab.classList.remove('active');
		});
		
		// Remove active class from all buttons
		document.querySelectorAll('.tab-button').forEach(btn => {
			btn.classList.remove('active');
		});
		
		// Show selected tab
		document.getElementById(tabName + '-tab').classList.add('active');
		event.target.classList.add('active');
	}
	
	// Load featured articles from weekly JSON
	async function loadFeaturedArticles() {
		try {
			const response = await fetch('featured_weekly.json?t=' + new Date().getTime());
			
			if (!response.ok) {
				throw new Error('Featured articles not available');
			}
			
			const data = await response.json();
			
			if (!data.articles || data.articles.length === 0) {
				document.getElementById('articlesTable').querySelector('tbody').innerHTML = `
					<tr><td colspan="4" style="text-align: center; padding: 40px; color: #999;">
						<i class="fas fa-info-circle" style="font-size: 2em; margin-bottom: 10px; display: block;"></i>
						No featured articles available yet. Check back after the weekly update runs.
					</td></tr>
				`;
				return;
			}
			
			// Take top 10 articles
			const articles = data.articles.slice(0, 10);
			
			// Populate table
			const tbody = document.getElementById('articlesTable').querySelector('tbody');
			let html = '';
			
			articles.forEach((article, index) => {
				const rank = index + 1;
				const title = article.title || 'Untitled';
				const journal = article.journal || 'Unknown Journal';
				const likes = article.likes || 0;
				const url = article.url || '#';
				
				// Truncate title if too long
				const maxTitleLength = 120;
				const displayTitle = title.length > maxTitleLength 
					? title.substring(0, maxTitleLength) + '...' 
					: title;
				
				html += `
					<tr>
						<td class="rank-col ${rank <= 3 ? 'top-3' : ''}">${rank}</td>
						<td class="name-col">
							<a href="${url}" target="_blank" rel="noopener noreferrer" 
							   style="color: #2568BE; text-decoration: none; font-weight: 500;"
							   title="${title.replace(/"/g, '&quot;')}">
								${displayTitle}
							</a>
						</td>
						<td style="color: #666; font-size: 0.9em;">${journal}</td>
						<td class="count-col">${likes}</td>
					</tr>
				`;
			});
			
			tbody.innerHTML = html;
			
		} catch (error) {
			console.error('Error loading featured articles:', error);
			document.getElementById('articlesTable').querySelector('tbody').innerHTML = `
				<tr><td colspan="4" style="text-align: center; padding: 40px; color: #999;">
					<i class="fas fa-exclamation-triangle" style="font-size: 2em; margin-bottom: 10px; display: block;"></i>
					Unable to load featured articles. Please try again later.
				</td></tr>
			`;
		}
	}
	
	// Load and parse leaderboard data from CSV
	async function loadLeaderboardData() {
		try {
			const response = await fetch('./database/leaderboard/leaderboard_analytics.csv');
			const text = await response.text();
			const lines = text.split('\n');
			
			const data = {
				totalPapers: 0,
				uniqueAuthors: 0,
				prolificAuthors: [],
				firstAuthors: [],
				departments: [],
				collaboration: [],
				states: [],
				countries: []
			};
			
			let currentSection = '';
			
			for (let i = 0; i < lines.length; i++) {
				const line = lines[i].trim();
				
				// Parse header info
				if (line.startsWith('Total Papers Analyzed:')) {
					data.totalPapers = parseInt(line.split(':')[1].trim());
				} else if (line.startsWith('Unique Authors:')) {
					data.uniqueAuthors = parseInt(line.split(':')[1].trim());
				}
				
				// Detect sections
				if (line.includes('TOP 10 MOST PROLIFIC AUTHORS')) {
					currentSection = 'prolific';
					i++; // Skip header row
				} else if (line.includes('TOP 10 FIRST AUTHORS')) {
					currentSection = 'first';
					i++; // Skip header row
				} else if (line.includes('TOP 10 DEPARTMENTS')) {
					currentSection = 'departments';
					i++; // Skip header row
				} else if (line.includes('MULTIDISCIPLINARY COLLABORATION')) {
					currentSection = 'collaboration';
					i++; // Skip header row
				} else if (line.includes('TOP 10 NON-MINNESOTA US STATES')) {
					currentSection = 'states';
					i++; // Skip header row
				} else if (line.includes('TOP 10 NON-USA COUNTRIES')) {
					currentSection = 'countries';
					i++; // Skip header row
				} else if (line && currentSection && !line.startsWith('Rank') && !line.startsWith('Number')) {
					// Parse CSV row properly handling quoted fields
					const parseCSVLine = (line) => {
						const result = [];
						let current = '';
						let inQuotes = false;
						
						for (let i = 0; i < line.length; i++) {
							const char = line[i];
							if (char === '"') {
								inQuotes = !inQuotes;
							} else if (char === ',' && !inQuotes) {
								result.push(current.trim());
								current = '';
							} else {
								current += char;
							}
						}
						result.push(current.trim());
						return result;
					};
					
					const parts = parseCSVLine(line);
					if (parts.length >= 2) {
						const rank = parts[0];
						
						if (currentSection === 'prolific' && parts.length >= 3) {
							const author = parts[1].replace(/"/g, '').trim();
							const count = parseInt(parts[2]);
							data.prolificAuthors.push({ rank, author, count });
						} else if (currentSection === 'first' && parts.length >= 3) {
							const author = parts[1].replace(/"/g, '').trim();
							const count = parseInt(parts[2]);
							data.firstAuthors.push({ rank, author, count });
						} else if (currentSection === 'departments' && parts.length >= 3) {
							const department = parts[1].replace(/"/g, '').trim();
							const count = parseInt(parts[2]);
							data.departments.push({ rank, department, count });
						} else if (currentSection === 'collaboration') {
							const deptCount = parts[0].trim();
							const pubCount = parseInt(parts[1]);
							data.collaboration.push({ deptCount, pubCount });
						} else if (currentSection === 'states' && parts.length >= 3) {
							const state = parts[1].replace(/"/g, '').trim();
							const count = parseInt(parts[2]);
							data.states.push({ rank, state, count });
						} else if (currentSection === 'countries' && parts.length >= 3) {
							const country = parts[1].replace(/"/g, '').trim();
							const count = parseInt(parts[2]);
							data.countries.push({ rank, country, count });
						}
					}
				}
			}
			
			return data;
		} catch (error) {
			console.error('Error loading leaderboard data:', error);
			return null;
		}
	}
	
	function getMedalEmoji(rank) {
		return rank;
	}
	
	function formatNumber(num) {
		return num.toLocaleString();
	}
	
	function renderLeaderboardLists(data) {
		// Update hero stats
		const heroStats = document.querySelector('.hero-content .stats');
		if (heroStats && data.uniqueAuthors && data.totalPapers) {
			heroStats.innerHTML = `<strong>${formatNumber(data.uniqueAuthors)}</strong> authors | <strong>${formatNumber(data.totalPapers)}</strong> publications`;
		}
		
		// Helper function to convert "Last, First" to "First Last"
		function formatName(fullName) {
			const parts = fullName.split(',').map(p => p.trim());
			if (parts.length === 2) {
				return `${parts[1]} ${parts[0]}`;
			}
			return fullName;
		}
		
		// Helper function to assign medals based on publication count (handles ties)
		function getMedalByCount(count, sortedCounts) {
			// Find the position of this count in the sorted unique counts
			const position = sortedCounts.indexOf(count);
			if (position === 0) return 'ðŸ¥‡';
			if (position === 1) return 'ðŸ¥ˆ';
			if (position === 2) return 'ðŸ¥‰';
			return position + 1; // Return numeric rank
		}
		
		// Render Most Prolific Authors Table (top 10 only)
		const prolificTableBody = document.querySelector('#prolificTable tbody');
		if (prolificTableBody && data.prolificAuthors.length > 0) {
			prolificTableBody.innerHTML = data.prolificAuthors.slice(0, 10).map((item, index) => {
				const rank = index + 1;
				const rankClass = rank <= 3 ? 'top-3' : '';
				const displayName = formatName(item.author);
				return `
					<tr>
						<td class="rank-col ${rankClass}">${rank}</td>
						<td class="name-col">${displayName}</td>
						<td class="count-col">${item.count}</td>
					</tr>
				`;
			}).join('');
		}
		
		// Render First Authors Table (top 10 only)
		const firstTableBody = document.querySelector('#firstTable tbody');
		if (firstTableBody && data.firstAuthors.length > 0) {
			firstTableBody.innerHTML = data.firstAuthors.slice(0, 10).map((item, index) => {
				const rank = index + 1;
				const rankClass = rank <= 3 ? 'top-3' : '';
				const displayName = formatName(item.author);
				return `
					<tr>
						<td class="rank-col ${rankClass}">${rank}</td>
						<td class="name-col">${displayName}</td>
						<td class="count-col">${item.count}</td>
					</tr>
				`;
			}).join('');
		}
		
		// Render Departments Table
		const departmentsTableBody = document.querySelector('#departmentsTable tbody');
		if (departmentsTableBody && data.departments.length > 0) {
			departmentsTableBody.innerHTML = data.departments.slice(0, 20).map((item, index) => {
				const rank = parseInt(item.rank);
				return `
					<tr>
						<td class="rank-col">${rank}</td>
						<td class="name-col">${item.department}</td>
						<td class="count-col">${formatNumber(item.count)}</td>
					</tr>
				`;
			}).join('');
		}
		
		// Render Collaboration Chart
		if (data.collaboration.length > 0) {
			// Filter out single department entries only
			const filteredCollaboration = data.collaboration.filter(item => {
				const deptNum = parseInt(item.deptCount.replace(/[^\d]/g, ''));
				return deptNum >= 2;
			});
			
			const maxPubs = Math.max(...filteredCollaboration.map(c => c.pubCount));
			const chartContainer = document.getElementById('collaborationChart');
			if (chartContainer) {
				chartContainer.innerHTML = filteredCollaboration.map(item => {
					const percentage = (item.pubCount / maxPubs * 100).toFixed(1);
					// Replace "5 or more departments" with "5+ departments"
					const displayLabel = item.deptCount.replace('5 or more departments', '5+ departments');
					return `
						<div class="chart-row">
							<div class="chart-label">${displayLabel}</div>
							<div class="chart-bar">
								<div class="chart-fill" style="width: ${percentage}%;"></div>
							</div>
							<div class="chart-value">${formatNumber(item.pubCount)}</div>
						</div>
					`;
				}).join('');
			}
		}
		
		// Render States Table
		const statesTableBody = document.querySelector('#statesTable tbody');
		if (statesTableBody && data.states.length > 0) {
			statesTableBody.innerHTML = data.states.map((item, index) => {
				const rank = parseInt(item.rank);
				return `
					<tr>
						<td class="rank-col">${rank}</td>
						<td class="name-col">${item.state}</td>
						<td class="count-col">${formatNumber(item.count)}</td>
					</tr>
				`;
			}).join('');
		}
		
		// Render Countries Table
		const countriesTableBody = document.querySelector('#countriesTable tbody');
		if (countriesTableBody && data.countries.length > 0) {
			countriesTableBody.innerHTML = data.countries.map((item, index) => {
				const rank = parseInt(item.rank);
				const displayName = item.country === 'UK' ? 'United Kingdom' : item.country;
				return `
					<tr>
						<td class="rank-col">${rank}</td>
						<td class="name-col">${displayName}</td>
						<td class="count-col">${formatNumber(item.count)}</td>
					</tr>
				`;
			}).join('');
		}
	}

	// Set up event listeners after DOM is loaded
	document.addEventListener('DOMContentLoaded', async function() {
		// Load featured articles
		await loadFeaturedArticles();
		
		// Load and render leaderboard data from CSV
		const data = await loadLeaderboardData();
		if (data) {
			renderLeaderboardLists(data);
		}
	});
	</script>
	<script src="assets/js/navigation.js"></script>

</body>
</html>
