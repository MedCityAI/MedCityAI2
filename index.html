<!DOCTYPE HTML>
<!--
	MedCityAI - Real-time research analytics
-->
<html lang="en">
	<head>
		<title>MedCityAI - Rochester MN Biomedical Research</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
		<style>
		/* Modal for abstracts */
		.modal-bg {
			display: none;
			position: fixed;
			top: 0; left: 0; width: 100vw; height: 100vh;
			background: rgba(0,0,0,0.5);
			z-index: 3000;
			justify-content: center;
			align-items: center;
		}
		.modal-content {
			background: #fff;
			border-radius: 10px;
			max-width: 600px;
			width: 90vw;
			max-height: 80vh;
			overflow-y: auto;
			padding: 32px 24px 24px 24px;
			box-shadow: 0 4px 24px rgba(0,0,0,0.18);
			position: relative;
		}
		.modal-close {
			position: absolute;
			top: 12px;
			right: 18px;
			font-size: 22px;
			color: #333;
			cursor: pointer;
			font-weight: bold;
		}
		.modal-abstract {
			margin-top: 18px;
			font-size: 15px;
			color: #222;
			line-height: 1.6;
		}
		.modal-abstract h4 {
			color: #0056a3;
			margin-top: 15px;
			margin-bottom: 10px;
			font-size: 16px;
		}
		.modal-abstract strong {
			color: #333;
		}

		/* Research results grid */
		.results {
			max-width: 1200px;
			margin: 10px auto;
			padding: 0;
			column-count: 3;
			column-gap: 20px;
		}
		.result-item {
			background: transparent;
			border-radius: 10px;
			margin: 0 0 20px;
			display: inline-block;
			width: 100%;
			box-sizing: border-box;
			position: relative;
			perspective: 1000px;
			min-height: 200px;
		}
		
	.card-flip-container {
		position: relative;
		width: 100%;
		min-height: 100%;
		transition: transform 0.6s;
		transform-style: preserve-3d;
	}
	
	.card-flip-container.flipped {
		transform: rotateY(180deg);
	}
	
	.card-face {
		width: 100%;
		backface-visibility: hidden;
		-webkit-backface-visibility: hidden;
		border-radius: 10px;
		padding: 20px;
		box-shadow: 0 4px 12px rgba(0,0,0,0.15);
		background: #fff;
		box-sizing: border-box;
	}
	
	.card-front {
		position: relative;
		z-index: 2;
		cursor: pointer;
		overflow: hidden;
	}
	
	.card-back {
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		transform: rotateY(180deg);
		background: linear-gradient(135deg, #f0f7ff 0%, #e3f2fd 100%);
		border: 2px solid #2196f3;
		display: flex;
		flex-direction: column;
		overflow: hidden;
		z-index: 3;
	}
	
	.card-back::before {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: linear-gradient(135deg, #f0f7ff 0%, #e3f2fd 100%);
		z-index: -1;
	}
	
	.card-back-header {
		display: flex;
		align-items: center;
		margin-bottom: 12px;
		padding-bottom: 12px;
		border-bottom: 2px solid #2196f3;
		flex-shrink: 0;
		cursor: pointer;
	}
		
	.card-back-content {
		flex: 1;
		display: flex;
		flex-direction: column;
		overflow-y: auto;
		overflow-x: hidden;
		padding-right: 5px;
		position: relative;
		-webkit-overflow-scrolling: touch;
		touch-action: pan-y;
		cursor: default;
	}
	
	.card-back-content::after {
		content: '';
		position: sticky;
		bottom: 0;
		left: 0;
		right: 0;
		height: 30px;
		background: linear-gradient(to bottom, transparent, rgba(227, 242, 253, 0.9));
		pointer-events: none;
		z-index: 1;
	}
	
	.card-back-content::-webkit-scrollbar {
		width: 6px;
	}
	
	.card-back-content::-webkit-scrollbar-track {
		background: rgba(33, 150, 243, 0.1);
		border-radius: 3px;
	}
	
	.card-back-content::-webkit-scrollbar-thumb {
		background: #2196f3;
		border-radius: 3px;
	}
	
	.card-back-content::-webkit-scrollbar-thumb:hover {
		background: #1976d2;
	}
	
	.card-back-summary {
		flex: 1;
		line-height: 1.7;
		color: #1a237e;
		font-size: 15px;
		margin-bottom: 12px;
		touch-action: pan-y;
	}		.card-back-disclaimer {
			padding-top: 12px;
			border-top: 1px solid #bbdefb;
			margin-top: auto;
			flex-shrink: 0;
		}
		
	.flip-instruction {
		text-align: center;
		font-size: 12px;
		color: #999;
		margin-top: 8px;
		font-style: italic;
		flex-shrink: 0;
		cursor: pointer;
	}		.new-tab {
			position: absolute;
			top: 0;
			left: 0;
			background: #e74c3c;
			color: #fff;
			font-size: 12px;
			font-weight: bold;
			padding: 4px 12px;
			border-radius: 8px 0 8px 0;
			z-index: 10;
			pointer-events: none; /* Prevent blocking clicks */
		}
		
		.department-badge {
			position: absolute;
			top: 8px;
			right: 8px;
			background: transparent;
			color: #2c3e50;
			font-size: 11px;
			font-weight: 500;
			font-style: italic;
			padding: 4px 10px;
			border-radius: 4px;
			z-index: 10;
			max-width: 200px;
			text-align: right;
			line-height: 1.3;
			pointer-events: none; /* Prevent blocking clicks */
		}
		
		/* Department filter links */
		.dept-filter-link {
			display: inline-block;
			cursor: pointer;
		}
		.dept-filter-link:hover {
			color: #fff !important;
			background: rgba(255, 255, 255, 0.1);
			border-radius: 4px;
		}
		.dept-filter-link.active {
			color: #fff !important;
			background: rgba(255, 255, 255, 0.2);
			border-radius: 4px;
			font-weight: 600;
		}
		
		/* Filter bar below header */
		.filter-bar {
			background: #f5f5f5;
			border-bottom: 2px solid #e0e0e0;
			padding: 20px 0 20px 0;
			box-shadow: 0 2px 8px rgba(0,0,0,0.1);
		}
		
		.filter-bar-content {
			max-width: 1200px;
			margin: 0 auto;
			padding: 0;
		}
		
		.filter-bar-content #pubmed-results {
			background: #f5f5f5;
			padding: 20px 0;
			margin-top: 0;
			border-radius: 0;
			box-shadow: none;
		}
		
		/* Add side padding only on mobile */
		@media (max-width: 768px) {
			.filter-bar-content {
				padding: 0 20px;
			}
			.filter-bar-content #pubmed-results {
				padding: 20px 20px;
			}
		}
		
		.filter-bar-title {
			color: #2c3e50;
			font-size: 14px;
			font-weight: 600;
			margin-bottom: 12px;
		}
		
		.filter-bar-links {
			display: flex;
			flex-wrap: wrap;
			gap: 8px;
			align-items: center;
		}
		
		.filter-bar .dept-filter-link {
			color: #555;
			text-decoration: none;
			font-size: 14px;
			padding: 6px 12px;
			transition: all 0.2s;
			border-radius: 4px;
		}
		
		.filter-bar .dept-filter-link:hover {
			background: #f5f5f5;
			color: #2c3e50;
		}
		
		.filter-bar .dept-filter-link.active {
			color: #fff !important;
			background: #3498db;
		}
		
		.filter-bar-links span {
			color: #ccc;
		}
		
		/* Main content layout */
		#main-content {
			width: 100%;
			padding: 0;
		}
		
		.result-title {
			display: block;
			font-size: 18px;
			font-weight: 600;
			color: #0056a3;
			text-decoration: none;
			margin-bottom: 8px;
		}
		.result-title:hover { 
			text-decoration: underline; 
		}
		.result-authors { 
			color: #333; 
			font-size: 14px; 
			margin-bottom: 6px; 
		}
		
		/* Clickable Rochester authors */
		.result-authors .roch-author {
			color: #555; /* dark gray */
			font-weight: 500; /* less bold */
			text-decoration: none;
			border-bottom: 1px dashed #bbb; /* subtle underline */
			cursor: pointer;
			transition: color 0.2s ease, background-color 0.2s ease, border-color 0.2s ease;
			padding: 1px 2px;
			border-radius: 3px;
		}
		.result-authors .roch-author:hover {
			color: #222; /* darker on hover */
			background-color: #f0f0f0;
			border-bottom-color: #999;
		}
		
		.result-citation { 
			color: #666; 
			font-size: 13px; 
			margin-bottom: 10px; 
		}

		/* Share buttons */
		.share-buttons { 
			margin-top: 10px;
			display: flex;
			align-items: center;
			justify-content: space-between;
			gap: 10px;
		}
		.share-buttons a {
			display: inline-block;
			font-size: 20px;
			color: #5e5e5e;
			padding: 6px 10px;
			border-radius: 6px;
			text-decoration: none;
			transition: opacity 0.3s ease;
		}
		.share-buttons a:hover { 
			opacity: 0.85; 
		}
		.like-button {
			display: inline-flex;
			align-items: center;
			justify-content: center;
			font-size: 20px;
			color: #999;
			padding: 0px 10px;
			margin-left: auto;
			background: transparent;
			border: none;
			cursor: pointer;
			transition: all 0.3s ease;
			outline: none;
			flex-direction: row-reverse;
		}
		.like-count {
			font-size: 14px;
			color: #3a3a3a;
			margin-right: 5px;
			font-weight: 700;
			letter-spacing: -0.25px;
		}
		.like-button:hover {
			color: #e74c3c;
			transform: scale(1);
			background: transparent;
			outline: none;
		}
		.like-button:focus {
			outline: none;
		}
		.like-button.liked {
			color: #e74c3c;
			outline: none;
		}
		.like-button.liked i {
			font-weight: 900;
			outline: none;
		}
		.like-button.liked i::before {
			content: "\f004" !important;
			font-family: "Font Awesome 5 Free" !important;
			font-weight: 900 !important;
			outline: none;
		}

		/* Top Navigation Bar */
		.top-bar {
			background: #ffffff;
			color: #2c3e50;
			padding: 15px 0;
			font-size: 14px;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			z-index: 1001;
			box-shadow: 0 2px 10px rgba(0,0,0,0.1);
			border-bottom: 1px solid #eee;
		}
		.top-bar-content {
			max-width: 1200px;
			margin: 0 auto;
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 0 20px;
		}
		.logo {
			display: flex;
			align-items: center;
		}
		.logo img {
			height: 40px;
			width: auto;
		}
		.nav-links {
			display: flex;
			gap: 30px;
			align-items: center;
		}
		.nav-links a {
			color: #2c3e50;
			text-decoration: none;
			font-weight: 500;
			font-size: 15px;
			transition: color 0.3s ease;
		}
		.nav-links a:hover {
			color: #3498db;
		}
		.cta-button {
			background: linear-gradient(135deg, #3498db, #2980b9);
			color: white;
			padding: 10px 20px;
			border-radius: 25px;
			text-decoration: none;
			font-weight: 600;
			font-size: 14px;
			transition: all 0.3s ease;
		}
		.cta-button:hover {
			transform: translateY(-1px);
			box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
		}
		.menu-icon {
			display: none;
			flex-direction: column;
			cursor: pointer;
		}
		.menu-icon div {
			width: 25px;
			height: 3px;
			background: #2c3e50;
			margin: 3px 0;
			transition: 0.3s;
		}

		/* Hero section */
		   .hero-section {
			   background: linear-gradient(120deg, #2568BE 0%, #1B4C7D 100%);
			   min-height: 340px;
			   display: flex;
			   align-items: center;
			   position: relative;
			   overflow: hidden;
			   margin-top: 70px;
			   z-index: 1;
		   }
		   .hero-bg-blobs {
			   position: absolute;
			   top: 0;
			   left: 0;
			   width: 100%;
			   height: 100%;
			   z-index: 0;
			   pointer-events: none;
			   opacity: 1;
			   transition: opacity 0.5s;
		   }

		/* Extend the backdrop into the results grid section */
		#one.wrapper.style1.special {
			background: linear-gradient(135deg, #e3eaf3 0%, #b6c7e0 100%);
			z-index: 0;
		}
		.hero-section::before {
			content: '';
			position: absolute;
			top: 0;
			right: 0;
			width: 50%;
			height: 100%;
			background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 600" fill="rgba(52,152,219,0.05)"><circle cx="300" cy="150" r="100"/><circle cx="350" cy="400" r="80"/><path d="M200,100 Q300,200 400,300" stroke="rgba(52,152,219,0.1)" stroke-width="3" fill="none"/></svg>') center/cover;
			z-index: 1;
		}
		.hero-content {
			max-width: 1200px;
			margin: 0 auto;
			   padding: 36px 20px;
			display: grid;
			grid-template-columns: 1fr 350px;
			gap: 60px;
			align-items: center;
			position: relative;
			z-index: 2;
		}
		.hero-right {
			position: relative;
		}

		/* Featured Carousel Styles */
		.featured-carousel {
			position: relative;
			width: 100%;
			max-width: 380px;
			aspect-ratio: 1;
		}
		.carousel-container {
			position: relative;
			width: 100%;
			height: 100%;
			overflow: hidden;
			border-radius: 16px;
		}
		.carousel-slide {
			position: absolute;
			width: 100%;
			height: 100%;
			opacity: 0;
			transition: opacity 0.6s ease-in-out;
			pointer-events: none;
		}
		.carousel-slide.active {
			opacity: 1;
			pointer-events: auto;
		}
		.featured-card {
			background: #fff;
			border-radius: 16px;
			padding: 24px;
			height: 100%;
			box-shadow: 0 12px 40px rgba(0,0,0,0.25), 0 4px 12px rgba(0,0,0,0.15);
			display: flex;
			flex-direction: column;
			gap: 14px;
			position: relative;
			overflow: hidden;
		}
		.featured-badge {
			position: absolute;
			top: 0;
			left: 0;
			background: #e74c3c;
			color: #fff;
			font-size: 12px;
			font-weight: bold;
			padding: 4px 12px;
			border-radius: 8px 0 8px 0;
			z-index: 10;
		}
		.featured-star {
			position: absolute;
			top: 12px;
			right: 12px;
			color: #e74c3c;
			font-size: 18px;
			z-index: 10;
		}
		.featured-card .result-title {
			display: block;
			font-size: 16px;
			font-weight: 600;
			color: #0056a3;
			text-decoration: none;
			margin-top: 24px;
			margin-bottom: 10px;
			line-height: 1.4;
		}
		.featured-card .result-title:hover {
			text-decoration: underline;
		}
		.featured-card .result-authors {
			color: #555;
			font-size: 13px;
			margin-bottom: 8px;
			line-height: 1.5;
		}
		.featured-card .result-citation {
			color: #777;
			font-size: 12px;
			margin-bottom: 12px;
		}
		.featured-card .result-abstract {
			color: #666;
			font-size: 13px;
			line-height: 1.6;
			flex: 1;
			overflow: hidden;
			display: -webkit-box;
			-webkit-line-clamp: 6;
			line-clamp: 6;
			-webkit-box-orient: vertical;
		}
		.carousel-dots {
			display: flex;
			justify-content: center;
			gap: 10px;
			margin-top: 16px;
		}
		.carousel-dots .dot {
			width: 10px;
			height: 10px;
			border-radius: 50%;
			background: rgba(255,255,255,0.4);
			cursor: pointer;
			transition: all 0.3s ease;
		}
		.carousel-dots .dot.active {
			background: #fff;
			width: 28px;
			border-radius: 5px;
		}
		.carousel-dots .dot:hover {
			background: rgba(255,255,255,0.7);
		}

		.hero-left h1 {
			font-size: 3em;
			font-weight: 800;
			color: #2c3e50;
			margin-bottom: 24px;
			line-height: 1.1;
		}
		.hero-left .subtitle {
			font-size: 1.2em;
			color: #7f8c8d;
			margin-bottom: 16px;
			font-weight: 500;
		}
		.hero-left p {
			font-size: 1.1em;
			color: #34495e;
			margin-bottom: 36px;
			line-height: 1.7;
		}
		.button-row {
			display: flex;
			gap: 16px;
			flex-wrap: wrap;
		}
		.btn {
			padding: 14px 28px;
			border-radius: 50px;
			font-weight: 600;
			text-decoration: none;
			transition: all 0.3s ease;
			border: none;
			cursor: pointer;
			font-size: 15px;
		}
		.btn-primary {
			background: linear-gradient(135deg, #3498db, #2980b9);
			color: white;
			box-shadow: 0 4px 16px rgba(52, 152, 219, 0.3);
		}
		.btn-primary:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
		}
		.btn-secondary {
			background: rgba(255, 255, 255, 0.1);
			color: white;
			border: 2px solid rgba(255, 255, 255, 0.3);
		}
		.btn-secondary:hover {
			background: rgba(255, 255, 255, 0.2);
			border-color: rgba(255, 255, 255, 0.5);
		}

		/* Hero Buttons */
		.hero-buttons {
			display: flex;
			gap: 16px;
			flex-wrap: wrap;
			margin-top: 32px;
		}
		.hero-btn {
			display: inline-flex;
			align-items: center;
			gap: 10px;
			padding: 14px 28px;
			border-radius: 50px;
			font-weight: 600;
			font-size: 15px;
			border: none;
			cursor: pointer;
			transition: all 0.3s ease;
			box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
		}
		.hero-btn i {
			font-size: 16px;
		}
		.hero-btn-primary {
			background: linear-gradient(135deg, #3498db, #2980b9);
			color: white;
		}
		.hero-btn-primary:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
		}
		.hero-btn-secondary {
			background: rgba(255, 255, 255, 0.95);
			color: #2c3e50;
			border: 2px solid rgba(52, 152, 219, 0.3);
		}
		.hero-btn-secondary:hover {
			background: white;
			border-color: #3498db;
			transform: translateY(-2px);
			box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
		}

		/* Responsive design */
		@media (max-width: 900px) {
			.results { 
				column-count: 2;
				padding: 0 20px;
			}
			.hero-content {
				grid-template-columns: 1fr;
				gap: 40px;
				text-align: center;
			}
			.featured-carousel {
				display: none;
			}
			.hero-left h1 { font-size: 2.4em; }
			.hero-left p { font-size: 1.1em; }
			.nav-links {
				display: none;
			}
			.menu-icon {
				display: flex;
			}
		}
		@media (max-width: 600px) {
			.results { 
				column-count: 1;
				padding: 0 20px;
			}
			.hero-content {
				padding: 40px 15px;
			}
			.hero-left h1 { font-size: 2em; }
			.hero-left p { font-size: 1em; }
			.button-row {
				justify-content: center;
			}
			.btn {
				padding: 12px 24px;
				font-size: 14px;
			}
			
			/* Hide scrollbar on mobile for cleaner look */
			.card-back-content::-webkit-scrollbar {
				display: none;
			}
			.card-back-content {
				-ms-overflow-style: none;
				scrollbar-width: none;
			}
		}
		
		/* Loading spinner */
		.spinner {
			border: 3px solid #f3f3f3;
			border-top: 3px solid #3498db;
			border-radius: 50%;
			width: 40px;
			height: 40px;
			animation: spin 1s linear infinite;
			margin: 0 auto 20px;
		}
		@keyframes spin {
			0% { transform: rotate(0deg); }
			100% { transform: rotate(360deg); }
		}
		
		/* ===== ACCESSIBILITY IMPROVEMENTS ===== */
		
		/* Skip to main content link */
		.skip-link {
			position: absolute;
			top: -50px;
			left: 10px;
			background: #3498db;
			color: white;
			padding: 10px 20px;
			text-decoration: none;
			z-index: 10001;
			font-weight: 600;
			border-radius: 0 0 8px 8px;
			transition: top 0.3s;
		}
		.skip-link:focus {
			top: 0;
		}
		
		/* Enhanced focus styles for keyboard navigation */
		*:focus {
			outline: 3px solid #3498db;
			outline-offset: 2px;
		}
		
		a:focus {
			outline: 3px solid #3498db;
			outline-offset: 3px;
		}
		
		button:focus {
			outline: 3px solid #3498db;
			outline-offset: 3px;
		}
		
		.nav-links a:focus {
			text-decoration: underline;
		}
		
		.menu-icon {
			cursor: pointer;
			background: none;
			border: none;
			padding: 8px;
		}
		
		.menu-icon:hover,
		.menu-icon:focus {
			background: rgba(52, 152, 219, 0.1);
			border-radius: 4px;
		}
		
		/* Modal accessibility */
		.modal-bg[aria-hidden="true"] {
			display: none;
		}
		
		.modal-content {
			position: relative;
		}
		
		.modal-close {
			cursor: pointer;
			background: none;
			border: none;
			font-size: 28px;
			line-height: 1;
		}
		
		.modal-close:hover {
			color: #3498db;
		}
		
		.modal-close:focus {
			outline: 3px solid #3498db;
			outline-offset: 2px;
			border-radius: 4px;
		}
		
		/* Ensure sufficient color contrast */
		.result-authors {
			color: #2c3e50; /* Improved from #333 */
		}
		
		.result-citation {
			color: #555; /* Improved from #666 */
		}
		
		/* Screen reader only text */
		.sr-only {
			position: absolute;
			width: 1px;
			height: 1px;
			padding: 0;
			margin: -1px;
			overflow: hidden;
			clip: rect(0, 0, 0, 0);
			white-space: nowrap;
			border-width: 0;
		}

		/* Welcome Modal */
		.welcome-modal {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.7);
			z-index: 10000;
			justify-content: center;
			align-items: center;
		}
		.welcome-modal.active {
			display: flex;
		}
		.welcome-content {
			background: white;
			padding: 50px;
			border-radius: 16px;
			max-width: 1000px;
			width: 95%;
			max-height: 90vh;
			overflow-y: auto;
			box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
			position: relative;
		}
		.modal-close-btn {
			position: absolute;
			top: 20px;
			right: 20px;
			background: none;
			border: none;
			font-size: 36px;
			color: #999;
			cursor: pointer;
			line-height: 1;
			padding: 0;
			width: 40px;
			height: 40px;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: color 0.2s;
		}
		.modal-close-btn:hover {
			color: #333;
		}
		.welcome-content h2 {
			color: #2c3e50;
			margin-bottom: 10px;
			font-size: 32px;
			text-align: center;
		}
		.welcome-content .subheader {
			color: #666;
			margin-bottom: 35px;
			font-size: 17px;
			text-align: center;
		}
		.topics-grid {
			display: flex;
			flex-wrap: wrap;
			gap: 8px;
			margin-bottom: 40px;
			padding: 10px;
			justify-content: center;
			align-items: flex-start;
		}
		.topic-button {
			padding: 12px 18px;
			background: linear-gradient(135deg, #f8f9fa, #e9ecef);
			border: 2px solid #dee2e6;
			border-radius: 25px;
			cursor: pointer;
			transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
			text-align: center;
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
			font-size: 14px;
			font-weight: 500;
			color: #2c3e50;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
			white-space: nowrap;
			flex-shrink: 0;
			user-select: none;
			-webkit-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			text-transform: none;
			display: inline-flex;
			align-items: center;
			justify-content: center;
			line-height: 1;
			min-height: 40px;
		}
		.topic-button:hover {
			box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
		}
		.topic-button:active {
			transform: scale(0.98);
		}
		.topic-button.selected {
			background: linear-gradient(135deg, #3498db, #2980b9);
			border-color: #2980b9;
			color: white;
			box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
		}
		.selected-keywords-section {
			margin-top: 30px;
			padding: 20px;
			background: #f8f9fa;
			border-radius: 8px;
			border: 1px solid #dee2e6;
		}
		.selected-keywords-section h4 {
			margin: 0 0 15px 0;
			color: #2c3e50;
			font-size: 16px;
			font-weight: 600;
		}
		.selected-keywords-list {
			display: flex;
			flex-wrap: wrap;
			gap: 8px;
		}
		.selected-keyword-tag {
			display: inline-flex;
			align-items: center;
			gap: 8px;
			padding: 8px 12px;
			background: linear-gradient(135deg, #3498db, #2980b9);
			color: white;
			border-radius: 20px;
			font-size: 13px;
			font-weight: 500;
			box-shadow: 0 2px 4px rgba(52, 152, 219, 0.3);
		}
		.selected-keyword-tag .remove-btn {
			cursor: pointer;
			background: rgba(255, 255, 255, 0.2);
			border: none;
			color: white;
			width: 18px;
			height: 18px;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 14px;
			line-height: 1;
			padding: 0;
			transition: background 0.2s;
		}
		.selected-keyword-tag .remove-btn:hover {
			background: rgba(255, 255, 255, 0.3);
		}
		.custom-keyword-section {
			display: flex;
			gap: 6px;
			align-items: center;
		}
		.custom-keyword-input {
			width: 180px;
			padding: 10px 14px;
			border: 2px solid #dee2e6;
			border-radius: 20px;
			font-size: 13px;
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
			outline: none;
			transition: border-color 0.2s;
		}
		.custom-keyword-input:focus {
			border-color: #3498db;
		}
		.add-keyword-button {
			padding: 10px 18px;
			background: none;
			color: #2c3e50;
			border: 2px solid #dee2e6;
			border-radius: 20px;
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
			font-size: 13px;
			font-weight: 500;
			cursor: pointer;
			transition: all 0.2s;
			white-space: nowrap;
		}
		.add-keyword-button:hover {
			box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
		}
		.add-keyword-button:active {
			transform: scale(0.98);
		}
		.selected-keywords-text {
			margin-top: 15px;
			text-align: center;
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
			font-size: 13px;
			font-style: italic;
			color: #999;
			line-height: 1.6;
		}
		.selected-keywords-text .clear-all {
			cursor: pointer;
			color: #666;
			text-decoration: underline;
			margin-left: 5px;
		}
		.selected-keywords-text .clear-all:hover {
			color: #333;
		}
		.privacy-disclaimer {
			font-size: 12px;
			color: #666;
			text-align: center;
			margin: 20px 0 10px 0;
			padding: 12px 20px;
			background: #f8f9fa;
			border-radius: 8px;
			border-left: 3px solid #4CAF50;
			line-height: 1.5;
		}
		.welcome-actions {
			display: flex;
			justify-content: center;
			gap: 15px;
		}
		.welcome-button {
			padding: 12px 30px;
			border-radius: 25px;
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
			font-weight: 500;
			cursor: pointer;
			transition: all 0.3s ease;
			font-size: 14px;
		}
		.welcome-button.primary {
			background: linear-gradient(135deg, #3498db, #2980b9);
			color: white;
			border: none;
		}
		.welcome-button.primary:hover {
			transform: translateY(-1px);
			box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
		}
		.welcome-button.secondary {
			background: transparent;
			color: #666;
			border: 2px solid #ddd;
		}
		.welcome-button.secondary:hover {
			background: #f8f9fa;
		}

		/* Author Modal Styles */
		.author-modal {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(0, 0, 0, 0.6);
			z-index: 2000;
			justify-content: center;
			align-items: center;
			backdrop-filter: blur(4px);
		}
		.author-modal-content {
			background: white;
			border-radius: 16px;
			padding: 32px;
			max-width: 900px;
			width: 90%;
			max-height: 85vh;
			overflow-y: auto;
			box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
			animation: modalSlideIn 0.3s ease-out;
		}
		.author-modal-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 24px;
			padding-bottom: 16px;
			border-bottom: 2px solid #e0e0e0;
		}
		.author-modal-header h3 {
			margin: 0;
			color: #2c3e50;
			font-size: 1.6em;
		}
		.author-stats {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			padding: 24px;
			border-radius: 12px 12px 0 0;
			box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
		}
		.author-stats h4 {
			margin: 0 0 16px 0;
			font-size: 1.4em;
			font-weight: 600;
		}
		#authorFullName {
			display: none;
		}
		.author-stats-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 16px;
			margin-bottom: 20px;
		}
		.author-stat-item {
			background: rgba(255, 255, 255, 0.15);
			padding: 12px 16px;
			border-radius: 8px;
			backdrop-filter: blur(10px);
		}
		.author-stat-label {
			font-size: 13px;
			opacity: 0.9;
			margin-bottom: 4px;
		}
		.author-stat-value {
			font-size: 1.5em;
			font-weight: 700;
		}
		.author-stats-header {
			font-size: 15px;
			font-weight: 600;
			opacity: 0.95;
			margin-top: 16px;
			padding-top: 16px;
			border-top: 1px solid rgba(255, 255, 255, 0.3);
		}
		.author-modal-close {
			background: none;
			border: none;
			font-size: 28px;
			color: #95a5a6;
			cursor: pointer;
			transition: color 0.2s ease;
			padding: 0;
			width: 32px;
			height: 32px;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		.author-modal-close:hover {
			color: #2c3e50;
		}
		.author-modal-loading {
			text-align: center;
			padding: 40px;
			color: #7f8c8d;
		}
		.author-bibliography {
			list-style: none;
			padding: 0;
			margin: 0;
			background: white;
			border-radius: 0 0 12px 12px;
			box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
		}
		.author-bibliography li {
			padding: 16px 24px;
			border-bottom: 1px solid #e0e0e0;
			font-size: 14px;
			line-height: 1.7;
			color: #2c3e50;
		}
		.author-bibliography li:last-child {
			border-bottom: none;
			border-radius: 0 0 12px 12px;
		}
		.author-bibliography .pub-title {
			font-weight: 600;
			color: #0056a3;
			margin-bottom: 4px;
		}
		.author-bibliography .pub-journal {
			color: #555;
			font-style: italic;
		}
		.author-bibliography .pub-year {
			color: #7f8c8d;
			font-weight: 500;
		}
		</style>
	</head>
	<body class="landing is-preload">
		<!-- Skip to main content link for keyboard users -->
		<a href="#main-content" class="skip-link">Skip to main content</a>
		
		<!-- Page Wrapper -->
		<div id="page-wrapper">
			<!-- Modern Medical Navigation Header -->
			<nav class="top-bar" role="navigation" aria-label="Main navigation">
				<div class="top-bar-content">
					<div class="logo">
						<img src="images/medcityai_logo1.png" alt="MedCityAI Logo" style="height:48px; width:auto;" />
					</div>
					<div class="nav-links" role="menubar">
						<a href="index.html" role="menuitem" aria-current="page">New Today</a>
						<a href="search.html" role="menuitem">Search</a>
						<a href="featured.html" role="menuitem">Featured</a>
						<a href="leaderboard.html" role="menuitem">Leaderboard</a>
						<a href="about.html" role="menuitem">About</a>
						<a href="contact.html" role="menuitem">Contact</a>
						<a href="#" role="menuitem" onclick="openKeywordsModal(); return false;">
							Keywords
						</a>
					</div>
					<div style="display: flex; align-items: center; gap: 15px;">
						<a href="#subscribe" class="cta-button">Subscribe</a>
						<button class="menu-icon" aria-label="Toggle mobile menu" aria-expanded="false" aria-controls="mobile-menu">
							<span class="sr-only">Menu</span>
							<div aria-hidden="true"></div>
							<div aria-hidden="true"></div>
							<div aria-hidden="true"></div>
						</button>
					</div>
				</div>
			</nav>

			<!-- Hero Section -->
			<section class="hero-section" aria-label="Hero banner" style="position:relative; overflow:hidden;">
				<!-- Animated SVG background blobs -->
				   <svg class="hero-bg-blobs" width="100%" height="900" viewBox="0 0 1440 900" style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;" aria-hidden="true" role="presentation">
					   <defs>
						   <linearGradient id="blobGradient1" x1="0" y1="0" x2="1" y2="1">
							   <stop offset="0%" stop-color="#3498db" stop-opacity="0.18"/>
							   <stop offset="100%" stop-color="#b6c7e0" stop-opacity="0.12"/>
						   </linearGradient>
						   <linearGradient id="blobGradient2" x1="0" y1="1" x2="1" y2="0">
							   <stop offset="0%" stop-color="#e3eaf3" stop-opacity="0.16"/>
							   <stop offset="100%" stop-color="#2980b9" stop-opacity="0.10"/>
						   </linearGradient>
					   </defs>
					   <g>
						   <circle id="blob1" cx="330" cy="220" r="330" fill="url(#blobGradient1)">
							   <animate attributeName="cx" values="330;1110;330" dur="15s" repeatCount="indefinite"/>
							   <animate attributeName="cy" values="220;680;220" dur="13.125s" repeatCount="indefinite"/>
						   </circle>
						   <circle id="blob2" cx="270" cy="180" r="270" fill="url(#blobGradient2)">
							   <animate attributeName="cx" values="270;1170;270" dur="16.875s" repeatCount="indefinite"/>
							   <animate attributeName="cy" values="180;720;180" dur="11.25s" repeatCount="indefinite"/>
						   </circle>
						   <circle id="blob3" cx="450" cy="450" r="450" fill="url(#blobGradient1)" opacity="0.7">
							   <animate attributeName="cx" values="450;990;450" dur="18.75s" repeatCount="indefinite"/>
							   <animate attributeName="cy" values="450;850;450" dur="15s" repeatCount="indefinite"/>
						   </circle>
					   </g>
				   </svg>
				<div class="hero-content">
					<div class="hero-left">
						<div class="subtitle" style="color:#e0e0e0;">Rochester, Minnesota</div>
						<h1 style="color:#fff; text-shadow: 0 4px 18px rgba(0,0,0,0.28);">What's New in Med City?</h1>
						<p style="color:#e0e0e0;">MedCityAI is a real-time feed of biomedical research from Rochester, MN. All information freely sourced from the National Library of Medicine (PubMed).</p>
						<div class="hero-buttons">
							<button class="hero-btn hero-btn-primary" id="newTodayBtn">
								<i class="fas fa-arrow-down"></i>
								New Today
							</button>
							<button class="hero-btn hero-btn-primary" id="featuredBtn">
								<i class="fas fa-star"></i>
								Featured
							</button>
							<button class="hero-btn hero-btn-primary" id="searchDatabaseBtn">
								<i class="fas fa-search"></i>
								Search
							</button>
						</div>
					</div>
					<div class="hero-right">
						<div class="featured-carousel">
							<div class="carousel-container">
								<div class="carousel-slide" id="featuredSlide1"></div>
								<div class="carousel-slide" id="featuredSlide2"></div>
								<div class="carousel-slide" id="featuredSlide3"></div>
							</div>
							<div class="carousel-dots">
								<span class="dot active" data-slide="0"></span>
								<span class="dot" data-slide="1"></span>
								<span class="dot" data-slide="2"></span>
							</div>
						</div>
					</div>
				</div>
			</section>

			<!-- Results Section -->
			<main id="main-content" role="main">
				<div class="filter-bar">
					<div class="filter-bar-content">
						<!-- Results Grid -->
						<div id="pubmed-results" role="region" aria-live="polite" aria-atomic="false" aria-label="Publication results"></div>
						
						<!-- Pagination Controls -->
						<nav id="pagination-controls" style="display:none; text-align:center; margin: 30px 0; padding: 20px;" role="navigation" aria-label="Pagination">
							<button id="prevPage" aria-label="Go to previous page" style="padding:12px 24px; margin:0 10px; border-radius:25px; border:1px solid #3498db; background:white; color:#3498db; cursor:pointer; font-weight:600;">‚Üê Previous</button>
							<span id="pageInfo" role="status" aria-live="polite" style="margin:0 20px; font-size:16px; color:#2c3e50; font-weight:500;">Page 1</span>
							<button id="nextPage" aria-label="Go to next page" style="padding:12px 24px; margin:0 10px; border-radius:25px; border:1px solid #3498db; background:white; color:#3498db; cursor:pointer; font-weight:600;">Next ‚Üí</button>
						</nav>
					</div>
				</div>

						<!-- Modal for abstracts -->
						<div id="modalBg" class="modal-bg" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-hidden="true">
							<div class="modal-content" role="document">
								<button class="modal-close" id="modalClose" aria-label="Close modal">&times;</button>
								<h3 id="modalTitle"></h3>
								<div class="modal-abstract" id="modalAbstract"></div>
							</div>
						</div>
						
						<!-- Author Bibliography Modal -->
						<div id="authorModal" class="author-modal author-modal-bg" role="dialog" aria-modal="true" aria-labelledby="authorModalTitle" aria-hidden="true">
							<div class="author-modal-content" role="document">
								<div class="author-modal-header">
									<h3 id="authorModalTitle">Author Publications</h3>
									<button class="author-modal-close" id="authorModalCloseBtn" aria-label="Close author publications modal">&times;</button>
								</div>
								<div id="authorStats" class="author-stats" style="display: none;">
									<h4 id="authorFullName" style="font-size: 1.5em; margin-bottom: 20px; color: #2c3e50;"></h4>
									<div class="author-stats-grid">
										<div class="author-stat-item">
											<div class="author-stat-label">Total Publications</div>
											<div class="author-stat-value" id="authorPubCount">0</div>
										</div>
										<div class="author-stat-item">
											<div class="author-stat-label">Primary Department</div>
											<div class="author-stat-value" id="authorDepartment" style="font-size: 1.1em;">‚Äî</div>
										</div>
									</div>
									<div class="author-stats-header" id="authorBibHeader" style="margin-top: 24px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.2); font-size: 1.1em;">Recent Publications</div>
								</div>
								<div id="authorModalLoading" class="author-modal-loading" style="display: none;" role="status" aria-live="polite">
									<div class="spinner" aria-hidden="true"></div>
									<p>Loading publications...</p>
								</div>
								<ol id="authorBibliography" class="author-bibliography" aria-label="List of author publications"></ol>
							</div>
						</div>
				</div>
			</main>

		<!-- Footer -->
			<footer id="footer">
				<ul class="icons">
					<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
					<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
					<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
					<li><a href="#" class="icon brands fa-dribbble"><span class="label">Dribbble</span></a></li>
					<li><a href="#" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
				</ul>
				<ul class="copyright">
					<li>&copy; MedCityAI</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li><li><a href="terms_of_use.html" style="color: #999;">Terms</a> | <a href="privacy_policy.html" style="color: #999;">Privacy</a> | <a href="cookie_policy.html" style="color: #999;">Cookies</a></li>
				</ul>
			</footer>
		</div>

		<!-- Welcome Modal -->
		<div class="welcome-modal" id="welcomeModal" onclick="closeModalOnOutsideClick(event)">
			<div class="welcome-content">
				<button class="modal-close-btn" onclick="closeKeywordsModal()" aria-label="Close">&times;</button>
				<h2>Welcome to MedCityAI!</h2>
				<p class="subheader">Select topics of interest to you. Your preferences are saved in your browser using local storage. This data never leaves your device.</p>
				<div class="topics-grid" id="topicsGrid">
					<button class="topic-button" onclick="toggleTopic(this, 'Generative AI')">Generative AI</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Radiology')">Radiology</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Surgery')">Surgery</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Internal Medicine')">Internal Medicine</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Cardiology')">Cardiology</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Oncology')">Oncology</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Neurology')">Neurology</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Pediatrics')">Pediatrics</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Psychiatry')">Psychiatry</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Dermatology')">Dermatology</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Orthopedics')">Orthopedics</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Anesthesiology')">Anesthesiology</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Pathology')">Pathology</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Emergency Medicine')">Emergency Medicine</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Ophthalmology')">Ophthalmology</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Urology')">Urology</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Gastroenterology')">Gastroenterology</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Endocrinology')">Endocrinology</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Nephrology')">Nephrology</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Pulmonology')">Pulmonology</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Rheumatology')">Rheumatology</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Hematology')">Hematology</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Immunology')">Immunology</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Geriatrics')">Geriatrics</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Vascular Surgery')">Vascular Surgery</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Neurosurgery')">Neurosurgery</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Obstetrics & Gynecology')">Obstetrics & Gynecology</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Pain Medicine')">Pain Medicine</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Sports Medicine')">Sports Medicine</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Nuclear Medicine')">Nuclear Medicine</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Informatics')">Informatics</button>
					<button class="topic-button" onclick="toggleTopic(this, 'Genomics')">Genomics</button>
				</div>
				
				<div class="welcome-actions">
					<div class="custom-keyword-section">
						<input type="text" id="customKeywordInput" placeholder="Add custom keyword..." class="custom-keyword-input" onkeypress="if(event.key==='Enter') addCustomKeyword()">
						<button class="add-keyword-button" onclick="addCustomKeyword()">Add</button>
					</div>
					<button class="welcome-button primary" onclick="closeKeywordsModal()">Continue</button>
				</div>
				
				<!-- Selected Keywords Display -->
				<div class="selected-keywords-text" id="selectedKeywordsText"></div>
			</div>
		</div>

		<!-- Scripts -->
		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/jquery.scrollex.min.js"></script>
		<script src="assets/js/jquery.scrolly.min.js"></script>
		<script src="assets/js/browser.min.js"></script>
		<script src="assets/js/breakpoints.min.js"></script>
		<script src="assets/js/util.js"></script>
		<script src="assets/js/main.js"></script>

		<script>
		// Application state
		let VarTot = 0, VarDay = 0, VarWeek = 0, VarMonth = 0;
		let currentPage = 1;
		let currentSearchQuery = '';
		const resultsPerPage = 50;
		let selectedTopics = [];

		// Welcome Modal Functions
		function checkFirstVisit() {
			const hasKeywords = localStorage.getItem('medcity_keywords');
			if (!hasKeywords) {
				document.getElementById('welcomeModal').classList.add('active');
			}
		}

		function skipWelcome() {
			localStorage.setItem('medcity_keywords', JSON.stringify([]));
			document.getElementById('welcomeModal').classList.remove('active');
		}

		function saveTopics() {
			if (selectedTopics.length === 0) {
				alert('Please select at least one topic to continue');
				return;
			}
			localStorage.setItem('medcity_keywords', JSON.stringify(selectedTopics));
			document.getElementById('welcomeModal').classList.remove('active');
			console.log('Saved topics:', selectedTopics);
		}

		// Modal functions
		function showAbstractModal(link) {
			const modalBg = document.getElementById('modalBg');
			const modalTitle = document.getElementById('modalTitle');
			const modalAbstract = document.getElementById('modalAbstract');
			
			const title = link.getAttribute('data-title');
			const abstract = link.getAttribute('data-abstract');
			const pmid = link.getAttribute('data-pmid');
			const authors = link.getAttribute('data-authors');
			const affiliations = link.getAttribute('data-affiliations');
			const llmSummary = link.getAttribute('data-llm-summary');

			// Title in black at top
			modalTitle.innerHTML = `<span style='color:#111;font-weight:800;font-size:1.3em;'>${title}</span>`;

			// Authors and affiliations
			let authorList = '';
			if (authors) {
				authorList += `<div style='margin:10px 0 18px 0;font-size:1em;color:#222;'><strong>Authors:</strong> ${authors.replace(/;/g, '; ')}</div>`;
			}
			if (affiliations) {
				authorList += `<div style='margin-bottom:18px;font-size:0.95em;color:#444;'><strong>Affiliations:</strong> ${affiliations.replace(/;/g, '; ')}</div>`;
			}

			// Start with authors
			let content = authorList;
			
			// Show AI-Generated Summary if available, otherwise show original abstract
			if (llmSummary && llmSummary.trim() !== '' && llmSummary !== 'No abstract available.') {
				content += `<div style="background: linear-gradient(135deg, #f0f7ff 0%, #e3f2fd 100%); padding: 20px; border-radius: 12px; margin-bottom: 24px; border-left: 4px solid #2196f3; box-shadow: 0 2px 8px rgba(33, 150, 243, 0.1);">`;
				content += `<div style="display: flex; align-items: center; margin-bottom: 12px;">`;
				content += `<span style="font-size: 24px; margin-right: 10px;">ü§ñ</span>`;
				content += `<h4 style="color: #1565c0; margin: 0; font-size: 16px; font-weight: 700;">AI-GENERATED PLAIN LANGUAGE SUMMARY</h4>`;
				content += `</div>`;
				content += `<p style="margin: 0 0 12px 0; line-height: 1.7; color: #1a237e; font-size: 15px;">${llmSummary}</p>`;
				content += `<div style="padding-top: 12px; border-top: 1px solid #bbdefb; margin-top: 12px;">`;
				content += `<p style="margin: 0; font-size: 12px; color: #546e7a; font-style: italic; line-height: 1.5;">`;
				content += `<strong>‚ö†Ô∏è Disclaimer:</strong> This summary was generated by artificial intelligence and may contain inaccuracies or oversimplifications. `;
				content += `Please refer to the full publication for complete and accurate information. `;
				content += `This AI summary is provided for informational purposes only and should not be used for clinical decision-making.`;
				content += `</p>`;
				content += `</div>`;
				content += `</div>`;
			} else {
				// Fallback to original abstract if no LLM summary
				content += `<h4 style="color: #0056a3; border-bottom: 2px solid #0056a3; padding-bottom: 8px; margin-bottom: 12px;">Abstract</h4>`;
				content += `<p style="line-height: 1.6;">${abstract}</p>`;
			}

			modalAbstract.innerHTML = content;
			modalBg.style.display = 'flex';

			// Prevent scroll to top
			if (window.scrollY) {
				setTimeout(() => window.scrollTo({top: window.scrollY}), 0);
			}
		}

		function closeModal() {
			const modalBg = document.getElementById('modalBg');
			modalBg.style.display = 'none';
			modalBg.setAttribute('aria-hidden', 'true');
			
			// Return focus to the element that opened the modal
			if (window.lastFocusedElement) {
				window.lastFocusedElement.focus();
			}
		}
		


		// Statistics loading (Note: currently not displayed in UI, but kept for potential future use)
		async function loadStatistics() {
			try {
				const response = await fetch('./database/summary_stats.txt');
				if (!response.ok) throw new Error('Statistics file not found');
				
				const statsText = await response.text();
				statsText.split('\n').forEach(line => {
					const [key, value] = line.split('=');
					if (key && value) {
						const trimmedKey = key.trim();
						const numValue = parseInt(value.trim());
						
						switch(trimmedKey) {
							case 'VarTot': VarTot = numValue; break;
							case 'VarDay': VarDay = numValue; break;
							case 'VarWeek': VarWeek = numValue; break;
							case 'VarMonth': VarMonth = numValue; break;
						}
					}
				});
			} catch (err) {
				console.error('Error loading statistics:', err);
			}
		}

		// Global variables for CSV data
		let allArticlesData = [];
		let filteredArticlesData = [];
		let currentlyFlippedCard = null;

	// Welcome Modal Functions
	function checkFirstVisit() {
		const hasKeywords = localStorage.getItem('medcity_keywords');
		if (!hasKeywords) {
			document.getElementById('welcomeModal').classList.add('active');
		}
	}

	function closeKeywordsModal() {
		document.getElementById('welcomeModal').classList.remove('active');
		// Save current selections to localStorage
		localStorage.setItem('medcity_keywords', JSON.stringify(selectedTopics));
		console.log('Modal closed, saved topics:', selectedTopics);
	}

	function closeModalOnOutsideClick(event) {
		// Close modal if clicking on the background (not the content)
		if (event.target.id === 'welcomeModal') {
			closeKeywordsModal();
		}
	}

	function skipWelcome() {
		localStorage.setItem('medcity_keywords', JSON.stringify([]));
		document.getElementById('welcomeModal').classList.remove('active');
	}

	function saveTopics() {
		if (selectedTopics.length === 0) {
			alert('Please select at least one topic to continue');
			return;
		}
		localStorage.setItem('medcity_keywords', JSON.stringify(selectedTopics));
		document.getElementById('welcomeModal').classList.remove('active');
		console.log('Saved topics:', selectedTopics);
	}

	function openKeywordsModal() {
		// Load existing topics from localStorage
		const existingTopics = JSON.parse(localStorage.getItem('medcity_keywords') || '[]');
		selectedTopics = [...existingTopics];
		
		// Update UI to show selected topics
		document.querySelectorAll('.topic-button').forEach(button => {
			const buttonText = button.textContent.trim();
			if (selectedTopics.includes(buttonText)) {
				button.classList.add('selected');
			} else {
				button.classList.remove('selected');
			}
		});
		
		// Update selected keywords display
		updateSelectedKeywordsDisplay();
		
		document.getElementById('welcomeModal').classList.add('active');
	}

	// Toggle topic button and update localStorage immediately
	function toggleTopic(button, topic) {
		console.log('Toggle topic clicked:', topic);
		
		// Toggle button visual state
		if (button.classList.contains('selected')) {
			button.classList.remove('selected');
			// Remove from array
			selectedTopics = selectedTopics.filter(t => t !== topic);
			console.log('Removed:', topic);
		} else {
			button.classList.add('selected');
			// Add to array if not already there
			if (!selectedTopics.includes(topic)) {
				selectedTopics.push(topic);
			}
			console.log('Added:', topic);
		}
		
		// Immediately save to localStorage
		localStorage.setItem('medcity_keywords', JSON.stringify(selectedTopics));
		console.log('Updated medcity_keywords in localStorage:', selectedTopics);
		
		// Update the selected keywords display
		updateSelectedKeywordsDisplay();
	}

	// Update the selected keywords display section
	function updateSelectedKeywordsDisplay() {
		const textDiv = document.getElementById('selectedKeywordsText');
		
		if (selectedTopics.length === 0) {
			textDiv.innerHTML = '';
			return;
		}
		
		const keywordsList = selectedTopics.join(', ');
		textDiv.innerHTML = `Selected Keywords: ${keywordsList} <span class="clear-all" onclick="clearAllKeywords()">(clear all)</span>`;
	}

	// Clear all keywords
	function clearAllKeywords() {
		selectedTopics = [];
		localStorage.setItem('medcity_keywords', JSON.stringify(selectedTopics));
		
		// Deselect all buttons
		document.querySelectorAll('.topic-button').forEach(button => {
			button.classList.remove('selected');
		});
		
		updateSelectedKeywordsDisplay();
		console.log('Cleared all keywords');
	}

	// Remove a keyword from selected topics
	function removeKeyword(topic) {
		selectedTopics = selectedTopics.filter(t => t !== topic);
		localStorage.setItem('medcity_keywords', JSON.stringify(selectedTopics));
		
		// Update button state
		document.querySelectorAll('.topic-button').forEach(button => {
			if (button.textContent.trim() === topic) {
				button.classList.remove('selected');
			}
		});
		
		updateSelectedKeywordsDisplay();
		console.log('Removed keyword:', topic);
	}

	// Add custom keyword
	function addCustomKeyword() {
		const input = document.getElementById('customKeywordInput');
		const keyword = input.value.trim();
		
		if (!keyword) {
			alert('Please enter a keyword');
			return;
		}
		
		if (selectedTopics.includes(keyword)) {
			alert('This keyword is already selected');
			return;
		}
		
		selectedTopics.push(keyword);
		localStorage.setItem('medcity_keywords', JSON.stringify(selectedTopics));
		input.value = '';
		
		updateSelectedKeywordsDisplay();
		console.log('Added custom keyword:', keyword);
	}

	// Initialize on page load
	document.addEventListener('DOMContentLoaded', function() {
		console.log('DOMContentLoaded - Initializing keywords modal');
		checkFirstVisit();
	});

	// Send interaction data to Google Apps Script
	async function sendClick(pmid, action) {
		try {
			console.log('Sending to Google Apps Script:', { action, pmid });
			
			const url = `https://script.google.com/macros/s/AKfycbw2g5z_1ALbqWjcdY7YsCkwpOpztGJhjOgfRxhGhB8dDA1nwtvySoB5nivNpCnaxIz4/exec?action=${encodeURIComponent(action)}&pmid=${encodeURIComponent(pmid)}&timestamp=${encodeURIComponent(new Date().toISOString())}`;
			
			const response = await fetch(url, {
				method: "GET",
				mode: "no-cors"
			});
			
		console.log('Data sent successfully');
	} catch (error) {
		console.error('Error sending click data:', error);
	}
}	// Fetch all counts from Google Sheet
	async function fetchLikeCounts() {
		try {
			console.log('Fetching like counts from Google Sheet...');
			const url = 'https://script.google.com/macros/s/AKfycbw2g5z_1ALbqWjcdY7YsCkwpOpztGJhjOgfRxhGhB8dDA1nwtvySoB5nivNpCnaxIz4/exec?action=getCounts';
			
			const response = await fetch(url);
			const data = await response.json();
			
			console.log('Received counts:', data);
			
			// Update all like buttons with counts
			document.querySelectorAll('.like-button').forEach(button => {
				const pmid = button.getAttribute('data-pmid');
				const count = data[pmid] || 0;
				
				// Add or update count span
				let countSpan = button.querySelector('.like-count');
				if (!countSpan) {
					countSpan = document.createElement('span');
					countSpan.className = 'like-count';
					button.appendChild(countSpan);
				}
				countSpan.textContent = count;
			});
		} catch (error) {
			console.error('Error fetching like counts:', error);
			// Set all counts to 0 on error
			document.querySelectorAll('.like-button').forEach(button => {
				let countSpan = button.querySelector('.like-count');
				if (!countSpan) {
					countSpan = document.createElement('span');
					countSpan.className = 'like-count';
					button.appendChild(countSpan);
				}
				countSpan.textContent = '0';
			});
		}
	}		// Like button functionality
		function toggleLike(event, pmid) {
			event.stopPropagation();
			event.preventDefault();
			
			const button = event.currentTarget;
			const isLiked = button.classList.contains('liked');
			
			// Only allow liking, not unliking
			if (isLiked) {
				return; // Do nothing if already liked
			}
			
			button.classList.add('liked');
			localStorage.setItem(`liked_${pmid}`, 'true');
			
			// Immediately update count display
			const countSpan = button.querySelector('.like-count');
			if (countSpan) {
				const currentCount = parseInt(countSpan.textContent) || 0;
				countSpan.textContent = currentCount + 1;
			}
			
			sendClick(pmid, 'liked');
		}
		
		// Initialize like buttons from local storage
		function initializeLikes() {
			document.querySelectorAll('.like-button').forEach(button => {
				const pmid = button.getAttribute('data-pmid');
				if (localStorage.getItem(`liked_${pmid}`) === 'true') {
					button.classList.add('liked');
				}
			});
			
			// Fetch and display counts from Google Sheet
			fetchLikeCounts();
		}

		// Function to flip card and match heights (with keyboard support)
		function flipCard(container, event) {
			// Support both click and keyboard events
			if (event.type === 'keydown' && event.key !== 'Enter' && event.key !== ' ') {
				return; // Only respond to Enter or Space key
			}
			
			event.stopPropagation();
			event.preventDefault(); // Prevent space from scrolling
			
			const cardFront = container.querySelector('.card-front');
			const cardBack = container.querySelector('.card-back');
			
			// Get PMID from like button if available
			const likeButton = container.querySelector('.like-button');
			const pmid = likeButton ? likeButton.getAttribute('data-pmid') : null;
			
			// If there's a currently flipped card and it's not this one, flip it back
			if (currentlyFlippedCard && currentlyFlippedCard !== container && currentlyFlippedCard.classList.contains('flipped')) {
				currentlyFlippedCard.classList.remove('flipped');
			}
			
			if (!container.classList.contains('flipped')) {
				// Flipping to back - capture front height and apply to back
				const frontHeight = cardFront.offsetHeight;
				cardBack.style.height = frontHeight + 'px';
				currentlyFlippedCard = container;
			} else {
				currentlyFlippedCard = null;
			}
			
			container.classList.toggle('flipped');
		}

		// Load CSV data
		async function loadCSVData() {
			try {
				const response = await fetch('pubmed_data.csv');
				if (!response.ok) throw new Error('CSV file not found');
				
				const csvText = await response.text();
				const lines = csvText.split('\n');
				
				// Parse header
				const headers = lines[0].split(',').map(h => h.trim().replace(/^"|"$/g, ''));
				
				// Parse data rows
				allArticlesData = [];
				for (let i = 1; i < lines.length; i++) {
					if (!lines[i].trim()) continue;
					
					const row = parseCSVLine(lines[i]);
					if (row.length === headers.length) {
						const article = {};
						headers.forEach((header, index) => {
							article[header] = row[index];
						});
						allArticlesData.push(article);
					}
				}
				
				console.log(`Loaded ${allArticlesData.length} articles from CSV`);
				return allArticlesData;
			} catch (error) {
				console.error('Error loading CSV:', error);
				return [];
			}
		}




		// Parse CSV line handling quoted fields
		function parseCSVLine(line) {
			const result = [];
			let current = '';
			let inQuotes = false;
			
			for (let i = 0; i < line.length; i++) {
				const char = line[i];
				
				if (char === '"') {
					inQuotes = !inQuotes;
				} else if (char === ',' && !inQuotes) {
					result.push(current.trim());
					current = '';
				} else {
					current += char;
				}
			}
			result.push(current.trim());
			
			return result;
		}



		// PubMed data display with search and pagination (now using CSV data)
		async function fetchPubMedResults(searchQuery = '', page = 1, departmentFilter = '') {
			currentSearchQuery = searchQuery;
			currentPage = page;
			
			// Ensure data is loaded
			if (allArticlesData.length === 0) {
				await loadCSVData();
			}
			
			// Filter articles based on search query
			if (searchQuery && searchQuery.trim() !== '') {
				const query = searchQuery.trim().toLowerCase();
				filteredArticlesData = allArticlesData.filter(article => {
					return article.title.toLowerCase().includes(query) ||
						   article.abstract.toLowerCase().includes(query) ||
						   article.authors.toLowerCase().includes(query) ||
						   article.journal.toLowerCase().includes(query);
				});
			} else {
				// No search query, show all articles
				filteredArticlesData = [...allArticlesData];
			}
			
			// Apply department filter if selected
			if (departmentFilter && departmentFilter.trim() !== '') {
				// Define category mappings
				const categoryKeywords = {
					'Surgery': ['surgery', 'surgical', 'cardiovascular surgery', 'cardiac surgery', 'thoracic surgery', 'neurosurgery', 'orthopedic surgery', 'plastic surgery', 'vascular surgery', 'transplant surgery'],
					'Cardiology': ['cardiology', 'cardiovascular', 'cardiac', 'heart'],
					'Neurology': ['neurology', 'neurological', 'neuroscience', 'neuroimaging', 'brain'],
					'Oncology': ['oncology', 'cancer', 'hematology', 'medical oncology', 'leukemia', 'lymphoma'],
					'Radiation Oncology': ['radiation oncology', 'radiation', 'radiotherapy'],
					'Radiology': ['radiology', 'imaging', 'diagnostic radiology', 'interventional radiology'],
					'Pediatrics': ['pediatrics', 'pediatric', 'child', 'children', 'neonatal'],
					'Internal Medicine': ['internal medicine', 'medicine', 'general medicine'],
					'Psychiatry': ['psychiatry', 'psychiatric', 'mental health', 'psychology'],
					'AI/ML/DL': ['artificial intelligence', 'machine learning', 'deep learning', 'neural network', 'ai', 'ml', 'dl',
						'generative ai', 'large language model', 'llm', 'chatgpt', 'gpt', 'generative', 'gen ai'
					]
				};
				
				filteredArticlesData = filteredArticlesData.filter(article => {
					const affiliationsList = article.affiliations ? article.affiliations.split('|') : [];
					
					// Check if any affiliation contains a department that matches the selected category
					return affiliationsList.some(affiliation => {
						const deptMatch = affiliation.match(/(?:Department|Division|Center|Institute|Clinic|Unit|Section)\s+of\s+([^,\.]+)/i);
						if (deptMatch) {
							const deptName = deptMatch[1].trim().toLowerCase();
							
							// Check if department name contains any keyword from the selected category
							const keywords = categoryKeywords[departmentFilter] || [];
							return keywords.some(keyword => deptName.includes(keyword));
						}
						return false;
					});
				});
			}
			
			// Check if we have results
			if (filteredArticlesData.length === 0) {
				document.getElementById("pubmed-results").innerHTML = "<p style='text-align:center; padding:40px; color:#666;'>No results found. Try a different search term.</p>";
				document.getElementById("pagination-controls").style.display = 'none';
				return;
			}
			
			// Calculate pagination
			const totalPages = Math.ceil(filteredArticlesData.length / resultsPerPage);
			const startIdx = (page - 1) * resultsPerPage;
			const endIdx = Math.min(startIdx + resultsPerPage, filteredArticlesData.length);
			const pageArticles = filteredArticlesData.slice(startIdx, endIdx);
			
			// Show/hide pagination controls
			if (filteredArticlesData.length > resultsPerPage) {
				document.getElementById("pagination-controls").style.display = 'block';
				document.getElementById("pageInfo").textContent = `Page ${page} of ${totalPages} (${filteredArticlesData.length} results)`;
				document.getElementById("prevPage").disabled = page === 1;
				document.getElementById("nextPage").disabled = page === totalPages;
				document.getElementById("prevPage").style.opacity = page === 1 ? '0.5' : '1';
				document.getElementById("nextPage").style.opacity = page === totalPages ? '0.5' : '1';
			} else {
				document.getElementById("pagination-controls").style.display = 'none';
			}
			
			// Get current date for NEW badge logic
			const now = new Date();
			const threeDaysAgo = new Date(now.getTime() - (3 * 24 * 60 * 60 * 1000));
			
			// Build results HTML from CSV data
			let resultsHTML = '';
			
			pageArticles.forEach(article => {
				const pmid = article.pmid;
				const title = article.title;
				const abstract = article.abstract;
				const journal = article.journal;
				const pubdate = article.pubdate;
				const url = article.url;
				const llmSummary = article.llm_summary || '';
				
				// Parse publication date to check if NEW
				const year = article.year;
				const month = article.month;
				const day = article.day;
				
				let articleDate = null;
				const monthNames = ["", "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
				if (year && month && day) {
					const monthNum = monthNames.indexOf(month);
					if (monthNum > 0) {
						articleDate = new Date(year, monthNum - 1, day);
					}
				} else if (year && month) {
					const monthNum = monthNames.indexOf(month);
					if (monthNum > 0) {
						articleDate = new Date(year, monthNum - 1, 1);
					}
				}
				
				// Determine if article is NEW (within last 3 days)
				const isNew = articleDate && articleDate >= threeDaysAgo;
				
				// Parse authors (pipe-separated in CSV)
				const authorsList = article.authors ? article.authors.split('|') : [];
				const rochesterAuthorsList = article.rochester_authors ? article.rochester_authors.split('|') : [];
				
				// Format authors for display
				let authorsHtml = "";
				if (article.authors_display) {
					authorsHtml = article.authors_display;
						// Make Rochester authors clickable
						rochesterAuthorsList.forEach(rochAuthor => {
							if (rochAuthor) {
								const escapedAuthor = rochAuthor.replace(/'/g, "\\'");
								authorsHtml = authorsHtml.replace(
									rochAuthor,
									`<span class="roch-author" data-author="${escapedAuthor}" tabindex="0" role="button" aria-label="View publications by ${escapedAuthor}">${rochAuthor}</span>`
								);
							}
						});

					// Fallback: if replacement didn't inject any clickable spans, rebuild from raw authors list
					if (!authorsHtml.includes('roch-author') && authorsList.length) {
						const rebuilt = authorsList.map(raw => {
							const t = (raw || '').trim();
							if (!t) return t;
							if (rochesterAuthorsList.includes(t)) {
								const esc = t.replace(/'/g, "\\'");
								return `<span class="roch-author" data-author="${esc}" tabindex="0" role="button" aria-label="View publications by ${esc}">${t}</span>`;
							}
							return t;
						}).join(', ');
						if (rebuilt) {
							authorsHtml = rebuilt;
						}
					}
				}
				
				// Parse affiliations (pipe-separated in CSV)
				const affiliationsList = article.affiliations ? article.affiliations.split('|') : [];
				
				// Extract department/division - prioritize first Rochester author's department
				let departmentText = '';
				
				// First, try to get department from first Rochester author
				if (rochesterAuthorsList.length > 0 && affiliationsList.length > 0) {
					const firstRochAuthor = rochesterAuthorsList[0];
					const authorIndex = authorsList.indexOf(firstRochAuthor);
					
					if (authorIndex >= 0 && authorIndex < affiliationsList.length) {
						const affiliation = affiliationsList[authorIndex];
						const deptMatch = affiliation.match(/(?:Department|Division|Center|Institute|Clinic|Unit|Section)\s+of\s+([^,\.]+)/i);
						if (deptMatch) {
							departmentText = deptMatch[1].trim();
						}
					}
				}
				
				// If no department found from first Rochester author, check all affiliations
				if (!departmentText && affiliationsList.length > 0) {
					for (let i = 0; i < affiliationsList.length; i++) {
						const affiliation = affiliationsList[i];
						const deptMatch = affiliation.match(/(?:Department|Division|Center|Institute|Clinic|Unit|Section)\s+of\s+([^,\.]+)/i);
						if (deptMatch) {
							departmentText = deptMatch[1].trim();
							break; // Use the first match found
						}
					}
				}
				
				// Default to "Medicine" if no department found
				if (!departmentText) {
					departmentText = 'Medicine';
				}
				
				const citation = `${journal}. ${pubdate}.`;

				// Build card with flip effect
				const hasSummary = llmSummary && llmSummary.trim() !== '' && llmSummary !== 'No abstract available.';
				
				resultsHTML += `
					<div class="result-item">
						<div class="card-flip-container" role="group" aria-label="${title.substring(0, 100)}...">
							<!-- Front of card -->
							<div class="card-face card-front" onclick="flipCard(this.closest('.card-flip-container'), event);" style="cursor: pointer;">
								${isNew ? '<div class="new-tab">NEW</div>' : ''}
								${departmentText ? `<div class="department-badge">${departmentText}</div>` : ''}
								<br>
								<a href="#" class="result-title" 
								   onclick="event.preventDefault(); event.stopPropagation(); flipCard(this.closest('.card-flip-container'), event);" 
								   onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();flipCard(this.closest('.card-flip-container'), event);}"
								   tabindex="0"
								   role="button"
								   aria-label="Click to view AI summary of: ${title}">${title}</a>
								<div class="result-authors" onclick="event.stopPropagation();">${authorsHtml}</div>
								<div class="result-citation"><em>${citation}</em></div>
								<div style="margin-top: 8px; margin-bottom: 10px;">
									<a href="${url}" target="_blank" onclick="event.stopPropagation();" style="color: #0056a3; text-decoration: none; font-size: 14px; font-weight: 500;">
										View on PubMed ‚Üí
									</a>
								</div>
								<div class="share-buttons" role="group" aria-label="Share on social media" onclick="event.stopPropagation();">
									<a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}" class="facebook" target="_blank" aria-label="Share on Facebook">
										<i class="icon brands fa-facebook-f" aria-hidden="true"></i> 
									</a>
									<a href="https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(title)}" class="twitter" target="_blank" aria-label="Share on Twitter">
										<i class="icon brands fa-twitter" aria-hidden="true"></i> 
									</a>
									<a href="https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(url)}&title=${encodeURIComponent(title)}" class="linkedin" target="_blank" aria-label="Share on LinkedIn">
										<i class="icon brands fa-linkedin" aria-hidden="true"></i> 
									</a>
									<button class="like-button" data-pmid="${pmid}" onclick="toggleLike(event, '${pmid}')" aria-label="Like this article" title="Like">
										<i class="icon far fa-heart" aria-hidden="true"></i>
									</button>
								</div>
							</div>
							
							<!-- Back of card (AI Summary) -->
							${hasSummary ? `
							<div class="card-face card-back" onclick="flipCard(this.closest('.card-flip-container'), event);" style="cursor: pointer;">
								<div class="card-back-header">
									<h4 style="color: #1565c0; margin: 0; font-size: 16px; font-weight: 700; cursor: pointer;"
									    onclick="event.stopPropagation(); flipCard(this.closest('.card-flip-container'), event);"
									    onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();flipCard(this.closest('.card-flip-container'), event);}"
									    tabindex="0"
									    role="button"
									    aria-label="Click to return to article details">
										AI SUMMARY <span style="font-size: 14px;">‚Ü©</span>
									</h4>
								</div>
								<div class="card-back-content">
									<div class="card-back-summary">${llmSummary}</div>
									<div class="card-back-disclaimer">
										<p style="margin: 0 0 10px 0; font-size: 11px; color: #546e7a; font-style: italic; line-height: 1.4;">
											This summary was generated by AI and may contain inaccuracies. Refer to the full publication for accurate information.
										</p>
										<a href="${url}" target="_blank" onclick="event.stopPropagation();" style="color: #0056a3; text-decoration: none; font-size: 14px; font-weight: 500;">
											View on PubMed ‚Üí
										</a>
									</div>
								</div>
							</div>
							` : ''}
						</div>
					</div>
				`;
			});

			document.getElementById("pubmed-results").innerHTML = `<div class="results">${resultsHTML}</div>`;
			
			// Initialize like buttons
			setTimeout(() => initializeLikes(), 100);
			
			// Scroll to top of results after page change
			if (page > 1) {
				document.getElementById("pubmed-results").scrollIntoView({ behavior: 'smooth', block: 'start' });
			}
		}

		// Featured Carousel Functions
		let carouselInterval;
		let currentSlideIndex = 0;

		function initializeFeaturedCarousel(articles) {
			if (!articles || articles.length === 0) return;

			// Populate each slide
			articles.forEach((article, index) => {
				const slide = document.getElementById(`featuredSlide${index + 1}`);
				if (slide) {
					slide.innerHTML = createFeaturedCard(article);
				}
			});

			// Show first slide
			showSlide(0);

			// Set up dot navigation
			const dots = document.querySelectorAll('.carousel-dots .dot');
			dots.forEach((dot, index) => {
				dot.addEventListener('click', () => {
					showSlide(index);
					resetCarouselTimer();
				});
			});

			// Start auto-rotation
			startCarouselRotation();
		}

		function createFeaturedCard(article) {
			const title = article.title || 'Untitled';
			const authors = article.authors_display || article.authors?.replaceAll('|', ', ') || 'Authors unavailable';
			const journal = article.journal || 'Journal pending';
			const pubdate = article.pubdate || '';
			const pmid = article.pmid || '';
			const abstract = article.abstract || 'No abstract available.';
			const url = article.url || `https://pubmed.ncbi.nlm.nih.gov/${pmid}/`;
			
			// Truncate authors if too long
			let authorsHtml = authors;
			const authorList = authors.split(',').map(a => a.trim());
			if (authorList.length > 8) {
				authorsHtml = authorList.slice(0, 7).join(', ') + ', et al.';
			}

			// Truncate abstract for preview
			const abstractPreview = abstract.length > 250 ? abstract.substring(0, 247) + '...' : abstract;

			const citation = `${journal}. ${pubdate}. PMID: ${pmid}`;

			return `
				<div class="featured-card">
					<div class="featured-badge">
						FEATURED
					</div>
					<i class="fas fa-star featured-star"></i>
					<a href="${url}" class="result-title" target="_blank" rel="noopener noreferrer">
						${title}
					</a>
					<div class="result-authors">${authorsHtml}</div>
					<div class="result-citation"><em>${citation}</em></div>
					<div class="result-abstract">${abstractPreview}</div>
				</div>
			`;
		}

		function showSlide(index) {
			const slides = document.querySelectorAll('.carousel-slide');
			const dots = document.querySelectorAll('.carousel-dots .dot');

			// Remove active class from all slides and dots
			slides.forEach(slide => slide.classList.remove('active'));
			dots.forEach(dot => dot.classList.remove('active'));

			// Add active class to current slide and dot
			if (slides[index]) {
				slides[index].classList.add('active');
			}
			if (dots[index]) {
				dots[index].classList.add('active');
			}

			currentSlideIndex = index;
		}

		function startCarouselRotation() {
			carouselInterval = setInterval(() => {
				const nextIndex = (currentSlideIndex + 1) % 3;
				showSlide(nextIndex);
			}, 5000); // Rotate every 5 seconds
		}

		function resetCarouselTimer() {
			clearInterval(carouselInterval);
			startCarouselRotation();
		}

		// Initialize application
		// Move to global scope so event delegation works
	async function showAuthorBibliography(authorName) {
			const modal = document.getElementById('authorModal');
			const title = document.getElementById('authorModalTitle');
			const loading = document.getElementById('authorModalLoading');
			const bibliography = document.getElementById('authorBibliography');
			const statsDiv = document.getElementById('authorStats');
			
		// Show modal and loading state
		modal.style.display = 'flex';
		title.textContent = '';
		loading.style.display = 'block';
		bibliography.innerHTML = '';
		statsDiv.style.display = 'none';
		
		try {
			// Build query for this author (all publications)
			const query = `${authorName}[Author]`;
			
			// First, get total count
			const countUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&term=${encodeURIComponent(query)}&retmode=json&retmax=0`;
			const countResponse = await fetch(countUrl);
			const countData = await countResponse.json();
			const totalCount = parseInt(countData.esearchresult.count);
			
			if (totalCount === 0) {
				title.textContent = authorName;
				bibliography.innerHTML = '<li style="color: #7f8c8d; text-align: center; padding: 40px;">No publications found for this author.</li>';
				loading.style.display = 'none';
				return;
			}				// Search PubMed for most recent 100
				const searchUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&term=${encodeURIComponent(query)}&retmax=100&retmode=json&sort=pub+date`;
				const searchResponse = await fetch(searchUrl);
				const searchData = await searchResponse.json();
				
				const articleIds = searchData.esearchresult.idlist;
				
				// Fetch article details
				const fetchUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=pubmed&id=${articleIds.join(',')}&retmode=xml`;
				const fetchResponse = await fetch(fetchUrl);
				const xmlText = await fetchResponse.text();
				
				// Parse XML
				const parser = new DOMParser();
				const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
				const articleNodes = xmlDoc.querySelectorAll('PubmedArticle');
				
				// Extract full name and departments
				let fullName = authorName;
				const departments = {};
				const articles = [];
				
				articleNodes.forEach(articleNode => {
					try {
						// Find the author and get full name
						const authorNodes = articleNode.querySelectorAll('Author');
						authorNodes.forEach(authorNode => {
							const lastNameNode = authorNode.querySelector('LastName');
							const foreNameNode = authorNode.querySelector('ForeName');
							const lastName = lastNameNode ? lastNameNode.textContent : '';
							const foreName = foreNameNode ? foreNameNode.textContent : '';
							
							// Check if this matches our author
							if (lastName && foreName && authorName.includes(lastName)) {
								fullName = `${foreName} ${lastName}`;
								
								// Extract department from affiliation
								const affiliationNodes = authorNode.querySelectorAll('Affiliation');
								affiliationNodes.forEach(affNode => {
									const affText = affNode.textContent;
									if (affText.toLowerCase().includes('rochester')) {
										// Try to extract department name
										const deptMatch = affText.match(/Department of ([^,;.]+)/i);
										if (deptMatch) {
											const dept = deptMatch[1].trim();
											departments[dept] = (departments[dept] || 0) + 1;
										}
									}
								});
							}
						});
						
						// Parse article details
						const pmidNode = articleNode.querySelector('PMID');
						const pmid = pmidNode ? pmidNode.textContent : '';
						
						const titleNode = articleNode.querySelector('ArticleTitle');
						const title = titleNode ? titleNode.textContent : 'No title';
						
						const journalNode = articleNode.querySelector('Journal Title');
						let journal = journalNode ? journalNode.textContent : '';
						if (!journal || journal.split(/\s+/).length > 5) {
							const isoAbbrevNode = articleNode.querySelector('ISOAbbreviation');
							if (isoAbbrevNode) journal = isoAbbrevNode.textContent;
						}
						
						const yearNode = articleNode.querySelector('PubDate Year');
						const year = yearNode ? yearNode.textContent : '';
						
						const monthNode = articleNode.querySelector('PubDate Month');
						const month = monthNode ? monthNode.textContent : '';
						
						let pubdate = '';
						if (year && month) {
							pubdate = `${month} ${year}`;
						} else if (year) {
							pubdate = year;
						}
						
						const authorNodesAll = articleNode.querySelectorAll('Author');
						const authorsArray = [];
						authorNodesAll.forEach(an => {
							const ln = an.querySelector('LastName');
							const fn = an.querySelector('ForeName');
							if (ln && fn) {
								const initials = fn.textContent.split(' ').map(n => n[0]).join('');
								authorsArray.push(`${ln.textContent} ${initials}`);
							}
						});
						let authorsDisplay = authorsArray.join(', ');
						if (authorsArray.length > 15) {
							authorsDisplay = authorsArray.slice(0, 14).join(', ') + ', et al.';
						}
						
						articles.push({
							pmid,
							title,
							journal,
							year,
							pubdate,
							authors: authorsDisplay,
							url: `https://pubmed.ncbi.nlm.nih.gov/${pmid}/`
						});
						
					} catch (error) {
						console.error('Error parsing article:', error);
					}
				});
				
				// Sort by year (most recent first)
				articles.sort((a, b) => {
					const yearA = parseInt(a.year) || 0;
					const yearB = parseInt(b.year) || 0;
					return yearB - yearA;
				});
				
				// Find most common department
				let primaryDepartment = '‚Äî';
				let maxCount = 0;
				for (const [dept, count] of Object.entries(departments)) {
					if (count > maxCount) {
						maxCount = count;
						primaryDepartment = dept;
			}
		}
		
		// Display stats with actual total count
		title.textContent = fullName;
		document.getElementById('authorPubCount').textContent = totalCount.toLocaleString();
		document.getElementById('authorDepartment').textContent = primaryDepartment;
		
		// Update bibliography header
		const bibHeader = document.getElementById('authorBibHeader');
		if (articles.length < totalCount) {
			bibHeader.textContent = `Recent Publications (showing ${articles.length} of ${totalCount})`;
		} else {
			bibHeader.textContent = `Recent Publications`;
		}
		
		statsDiv.style.display = 'block';				// Display bibliography with numbering
				let bibliographyHTML = '';
				articles.forEach((article, index) => {
					const citation = generateMLACitation(article);
					bibliographyHTML += `<li><strong style="color: #3498db; margin-right: 8px;">${index + 1}.</strong>${citation}</li>`;
				});
				
				bibliography.innerHTML = bibliographyHTML;
				loading.style.display = 'none';
				
			} catch (error) {
				console.error('Error fetching author bibliography:', error);
				bibliography.innerHTML = '<li style="color: #e74c3c; text-align: center; padding: 40px;">Error loading publications. Please try again.</li>';
				loading.style.display = 'none';
			}
		}
		
		function generateMLACitation(article) {
			// Format: Authors. "Title." Journal, Month Year.
			const dateStr = article.pubdate || article.year || 'n.d.';
			return `${article.authors}. "${article.title}" <span class="pub-journal">${article.journal}</span>, <span class="pub-year">${dateStr}</span>. <a href="${article.url}" target="_blank" style="color: #3498db;">PubMed</a>`;
		}		
		function closeAuthorModal() {
			document.getElementById('authorModal').style.display = 'none';
		}

		// Set up event listeners after DOM is loaded
		document.addEventListener('DOMContentLoaded', function() {
			// Close button for author modal
			const authorModalCloseBtn = document.getElementById('authorModalCloseBtn');
			if (authorModalCloseBtn) {
				authorModalCloseBtn.addEventListener('click', closeAuthorModal);
			}

			// Event delegation for Rochester author clicks
			document.addEventListener('click', function(e) {
			const trigger = e.target.closest('.roch-author');
			if (trigger) {
				const name = (trigger.getAttribute('data-author') || trigger.textContent || '').trim();
				if (name) {
					e.preventDefault();
					e.stopPropagation();
					showAuthorBibliography(name);
				}
			}
		}, true);

		document.addEventListener('keydown', function(e) {
			if ((e.key === 'Enter' || e.key === ' ') && e.target && e.target.classList && e.target.classList.contains('roch-author')) {
				e.preventDefault();
				const name = (e.target.getAttribute('data-author') || e.target.textContent || '').trim();
				if (name) showAuthorBibliography(name);
			}
		});
		
			
			// Load data and initialize featured carousel
			loadCSVData().then(articles => {
				if (articles && articles.length > 0) {
					initializeFeaturedCarousel(articles.slice(0, 3));
				}
			});

			// Hero button event listeners
			const newTodayBtn = document.getElementById('newTodayBtn');
			const featuredBtn = document.getElementById('featuredBtn');
			const searchDatabaseBtn = document.getElementById('searchDatabaseBtn');

			if (newTodayBtn) {
				newTodayBtn.addEventListener('click', function() {
					// Get today's date in YYYY-MM-DD format
					const today = new Date().toISOString().split('T')[0];
					
					// Scroll to results section with header offset
					const resultsSection = document.getElementById('pubmed-results');
					if (resultsSection) {
						const headerHeight = 70; // Fixed header height
						const elementPosition = resultsSection.getBoundingClientRect().top;
						const offsetPosition = elementPosition + window.pageYOffset - headerHeight;
						
						window.scrollTo({
							top: offsetPosition,
							behavior: 'smooth'
						});
					}
					
					// Filter for today's publications
					setTimeout(() => {
						fetchPubMedResults('', 1, '', today);
					}, 500);
				});
			}

			if (featuredBtn) {
				featuredBtn.addEventListener('click', function() {
					// Navigate to featured page
					window.location.href = 'featured.html';
				});
			}

			if (searchDatabaseBtn) {
				searchDatabaseBtn.addEventListener('click', function() {
					// Scroll to search/filter section
					const searchSection = document.getElementById('pubmed-results');
					if (searchSection) {
						searchSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
						
						// Focus on search input after scroll
						setTimeout(() => {
							const searchInput = document.getElementById('search-input');
							if (searchInput) {
								searchInput.focus();
							}
						}, 600);
					}
				});
			}

			// Set up modal event listeners
			const modalBg = document.getElementById('modalBg');
			const modalClose = document.getElementById('modalClose');
            
			modalClose.addEventListener('click', closeModal);
			modalBg.addEventListener('click', function(e) {
				if (e.target === modalBg) closeModal();
			});
			
			// Set up author modal close event listener
			const authorModal = document.getElementById('authorModal');
			authorModal.addEventListener('click', function(e) {
				if (e.target === authorModal) closeAuthorModal();
			});

			// Set up pagination event listeners
			document.getElementById('prevPage').addEventListener('click', function() {
				if (currentPage > 1) {
					fetchPubMedResults(currentSearchQuery, currentPage - 1);
				}
			});

			document.getElementById('nextPage').addEventListener('click', function() {
				const totalPages = Math.ceil(filteredArticlesData.length / resultsPerPage);
				if (currentPage < totalPages) {
					fetchPubMedResults(currentSearchQuery, currentPage + 1);
				}
			});

			// Load data and display results
			loadStatistics();
			loadCSVData().then(() => {
				fetchPubMedResults('', 1);
			});
		});
		</script>
	</body>
</html>