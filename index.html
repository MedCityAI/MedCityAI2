<!DOCTYPE HTML>
<!--
	MedCityAI - Real-time research analytics
-->
<html>
	<head>
		<title>Med City AI</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
		<style>
		/* Popup modal for abstract */
		.modal-bg {
			display: none;
			position: fixed;
			top: 0; left: 0; width: 100vw; height: 100vh;
			background: rgba(0,0,0,0.5);
			z-index: 3000;
			justify-content: center;
			align-items: center;
		}
		.modal-content {
			background: #fff;
			border-radius: 10px;
			max-width: 500px;
			width: 90vw;
			max-height: 80vh;
			overflow-y: auto;
			padding: 32px 24px 24px 24px;
			box-shadow: 0 4px 24px rgba(0,0,0,0.18);
			position: relative;
		}
		.modal-close {
			position: absolute;
			top: 12px;
			right: 18px;
			font-size: 22px;
			color: #333;
			cursor: pointer;
			font-weight: bold;
		}
		.modal-abstract {
			margin-top: 18px;
			font-size: 15px;
			color: #222;
			line-height: 1.6;
		}
		/* 'new' tab for grid articles */
		.new-tab {
			position: absolute;
			top: 0;
			left: 0;
			background: #e74c3c;
			color: #fff;
			font-size: 12px;
			font-weight: bold;
			padding: 4px 12px;
			border-radius: 8px 0 8px 0;
			z-index: 10;
		}
		.result-item { position: relative; }
		/* Results Masonry Grid (from generic.html) */
		.results {
			max-width: 1100px;
			margin: 40px auto;
			column-count: 3;
			column-gap: 20px;
		}
		.result-item {
			background: #fff;
			border-radius: 10px;
			padding: 20px;
			margin: 0 0 20px;
			box-shadow: 0 2px 6px rgba(0,0,0,0.05);
			display: inline-block;
			width: 100%;
			box-sizing: border-box;
		}
		.result-title {
			display: block;
			font-size: 18px;
			font-weight: 600;
			color: #0056a3;
			text-decoration: none;
			margin-bottom: 8px;
		}
		.result-title:hover { text-decoration: underline; }
		.result-authors { color: #333; font-size: 14px; margin-bottom: 6px; }
		.result-citation { color: #666; font-size: 13px; margin-bottom: 10px; }
		/* Share Buttons */
		.share-buttons { margin-top: 10px; }
		.share-buttons a {
			display: inline-block;
			margin-right: 10px;
			font-size: 20px;
			color: #5e5e5e;
			padding: 6px 10px;
			border-radius: 6px;
			text-decoration: none;
			transition: opacity 0.3s ease;
		}
		.share-buttons a:hover { opacity: 0.85; }
		.twitter { background: #ffffff; }
		.linkedin { background: #ffffff; }
		.facebook { background: #ffffff; }

		@media (max-width: 900px) {
			.results { column-count: 2; }
		}
		@media (max-width: 600px) {
			.results { column-count: 1; }
		}
		</style>
	</head>
	<body class="landing is-preload">

			<script>
		// Show abstract modal (global)
		function showAbstractModal(link) {
			var modalBg = document.getElementById('modalBg');
			var modalTitle = document.getElementById('modalTitle');
			var modalAbstract = document.getElementById('modalAbstract');
			const title = link.getAttribute('data-title');
			const pmid = link.getAttribute('data-pmid');
			const originalAbstract = link.getAttribute('data-abstract');
			modalTitle.textContent = title;
			if (pubmedSummaryData && pubmedSummaryData.has(pmid)) {
				const summaryData = pubmedSummaryData.get(pmid);
				let content = '';
				if (summaryData.llm_summary) {
					content += '<h4>AI Summary</h4><p>' + summaryData.llm_summary + '</p>';
				}
				if (summaryData.main_findings) {
					content += '<h4>Main Findings</h4><p>' + summaryData.main_findings + '</p>';
				}
				if (!content) {
					content = '<h4>Abstract</h4><p>' + originalAbstract + '</p>';
				}
				modalAbstract.innerHTML = content;
			} else {
				modalAbstract.innerHTML = '<h4>Abstract</h4><p>' + originalAbstract + '</p>';
			}
			modalBg.style.display = 'flex';
			// Prevent scroll to top
			if (window.scrollY) {
				setTimeout(function() { window.scrollTo({top: window.scrollY}); }, 0);
			}
		}
		document.addEventListener('DOMContentLoaded', function() {
			var modalBg = document.getElementById('modalBg');
			var modalClose = document.getElementById('modalClose');
			modalClose.addEventListener('click', function() {
				modalBg.style.display = 'none';
			});
			modalBg.addEventListener('click', function(e) {
				if (e.target === modalBg) modalBg.style.display = 'none';
			});
		});
			// Global variables
			var VarTot = 0, VarDay = 0, VarWeek = 0, VarMonth = 0;

			// Fetch and process summary_stats.txt from ./database/summary_stats.txt
			async function fetchAndRecordVars() {
				const statsPath = './database/summary_stats.txt';
				try {
					const response = await fetch(statsPath);
					if (!response.ok) throw new Error('summary_stats.txt not found');
					const statsText = await response.text();
					// Parse lines like VarTot=1500
					statsText.split('\n').forEach(line => {
						const [key, value] = line.split('=');
						if (key && value) {
							if (key.trim() === 'VarTot') VarTot = parseInt(value.trim());
							if (key.trim() === 'VarDay') VarDay = parseInt(value.trim());
							if (key.trim() === 'VarWeek') VarWeek = parseInt(value.trim());
							if (key.trim() === 'VarMonth') VarMonth = parseInt(value.trim());
						}
					});
				} catch (err) {
					console.error('Error loading summary_stats.txt:', err);
				}
			}

			// Call at start
			fetchAndRecordVars().then(() => {
				const bannerSpan = document.getElementById("VarTot");
				const bannerDay = document.getElementById("VarDay");
				const bannerWeek = document.getElementById("VarWeek");
				const bannerMonth = document.getElementById("VarMonth");
				if (bannerSpan) bannerSpan.textContent = VarTot;
				if (bannerDay) bannerDay.textContent = VarDay;
				if (bannerWeek) bannerWeek.textContent = VarWeek;
				if (bannerMonth) bannerMonth.textContent = VarMonth;
			});
			</script>
			<!-- Page Wrapper -->
			<div id="page-wrapper">

				<!-- Header -->
					<header id="header" class="alt" style="position:fixed;top:0;left:0;width:100%;z-index:1000;background:rgba(34, 34, 34, 0.95);box-shadow:0 2px 8px rgba(0,0,0,0.07);">
						<h1><a href="index.html">Med City AI</a></h1>
						<nav id="nav">
							<ul>
								<li class="special">
									<a href="#menu" class="menuToggle"><span>Menu</span></a>
									<div id="menu">
										<ul>
											<li><a href="index.html">Home</a></li>
											<li><a href="generic.html">Generic</a></li>
											<li><a href="elements.html">Elements</a></li>
											<li><a href="#">Sign Up</a></li>
											<li><a href="#">Log In</a></li>
										</ul>
									</div>
								</li>
							</ul>
						</nav>
					</header>
				<!-- here is where I'd like to open one folder up database/pubmed_results.csv and then export three variables VarTot (number of total entries) VarDay (number of entries in past 24 hours) VarWeek (number of entries in past 7 days) VarMonth (number of entries in past 30 days) and then have those variables populate the following sections below% -->

				<!-- One -->


					<section id="one" class="wrapper style1 special" style="background: url('images/banner.jpg') center center/cover no-repeat; background-attachment: fixed;">
						<div class="inner">
							<header class="major">
								<br><h2>Med City AI</h2>
								<p>Explore the latest biomedical research from Rochester, Minnesota. Powered by PubMed.</p>
							</header>
						
						    <!-- Numbers Section -->
						    <div style="display: flex; justify-content: space-around; text-align: center; margin-top: 2em;">
						      <div class="stat-item">
						        <!-- <h2 class="count" id="VarDay" data-target="0">0</h2> -->
						        <h2 id="VarDay">0</h2> <!-- dynamically replaced by JS -->								<p>new today</p>
						      </div>
						      <div class="stat-item">
						        <!-- <h2 class="count" id="VarWeek" data-target="0">0</h2> replace 100 with VarWeek -->
						        <h2 id="VarWeek">0</h2> <!-- dynamically replaced by JS -->						        
								<p>new this week</p>
						      </div>
						      <div class="stat-item">
						        <h2 id="VarMonth">0</h2> <!-- replace 10000 with VarMonth -->
						        <p>new this month</p>
						      </div>
						    </div>
						  </div>


							<!-- Results Masonry Grid will render here -->
							<div id="pubmed-results" style="margin-top:20px;"></div>
			<!-- Modal for abstract -->
			<div id="modalBg" class="modal-bg">
				<div class="modal-content">
					<span class="modal-close" id="modalClose">&times;</span>
					<h3 id="modalTitle"></h3>
					<div class="modal-abstract" id="modalAbstract"></div>
				</div>
			</div>
						</div>
					
						<!-- Fetch and display PubMed results -->
						<script>
						async function fetchPubMedResults() {
    // Only show Everything
    const term = '("Rochester"[AD] AND ("Minnesota"[AD] OR "MN"[AD]))';
    const esearchUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&term=${encodeURIComponent(term)}&sort=pub+date&retmode=json&datetype=pdat&reldate=1`;
    try {
        const esearchRes = await fetch(esearchUrl);
        const esearchData = await esearchRes.json();
        const ids = esearchData.esearchresult.idlist;
        if (ids.length === 0) {
            document.getElementById("pubmed-results").innerHTML = "<p>No results found.</p>";
            return;
        }
        // Fetch full article details via efetch
        const efetchUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=pubmed&id=${ids.join(",")}&retmode=xml`;
        const efetchRes = await fetch(efetchUrl);
        const efetchXml = await efetchRes.text();
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(efetchXml, "text/xml");
        let resultsHTML = '';
        const articles = xmlDoc.querySelectorAll("PubmedArticle");
        articles.forEach(article => {
            const pmid = article.querySelector("PMID")?.textContent || "";
            const title = article.querySelector("ArticleTitle")?.textContent || "No title";
            let llmSummary = '';
            if (pubmedSummaryData.has(pmid)) {
                llmSummary = pubmedSummaryData.get(pmid).llm_summary || '';
            }
            resultsHTML += `
                <div class="result-item">
                    <div class="new-tab">NEW</div>
                    <br><a href="#" class="result-title" data-title="${title.replace(/"/g,'&quot;')}" data-pmid="${pmid}" data-llm-summary="${llmSummary.replace(/"/g,'&quot;')}" onclick="showLLMSummaryModal(this)">${title}</a>
                </div>
            `;
        });
        document.getElementById("pubmed-results").innerHTML = `<div class="results">${resultsHTML}</div>`;
    } catch (error) {
        console.error(error);
        document.getElementById("pubmed-results").innerHTML = "<p>Error fetching results.</p>";
    }
}

function showLLMSummaryModal(link) {
    var modalBg = document.getElementById('modalBg');
    var modalTitle = document.getElementById('modalTitle');
    var modalAbstract = document.getElementById('modalAbstract');
    const title = link.getAttribute('data-title');
    const llmSummary = link.getAttribute('data-llm-summary');
    modalTitle.textContent = title;
    if (llmSummary) {
        modalAbstract.innerHTML = '<h4>LLM Summary</h4><p>' + llmSummary + '</p>';
    } else {
        modalAbstract.innerHTML = '<p>No summary available.</p>';
    }
    modalBg.style.display = 'flex';
    if (window.scrollY) {
        setTimeout(function() { window.scrollTo({top: window.scrollY}); }, 0);
    }
}

						// Fetch default ("everything") on page load
						document.addEventListener("DOMContentLoaded", fetchPubMedResults);
						</script>
						<script>
						document.addEventListener("DOMContentLoaded", () => {
						const track = document.querySelector('.carousel-track');
						const slides = Array.from(track.children);
						const nextButton = document.querySelector('.carousel-btn.next');
						const prevButton = document.querySelector('.carousel-btn.prev');

						let index = 0;
						const slidesToShow = 3;
						const slideWidth = slides[0].getBoundingClientRect().width;

						// Clone first few slides to the end for looping
						for (let i = 0; i < slidesToShow; i++) {
							const clone = slides[i].cloneNode(true);
							track.appendChild(clone);
						}

						function updateCarousel() {
							track.style.transform = `translateX(-${index * slideWidth}px)`;
						}

						function moveNext() {
							index = (index + 1) % slides.length;
							updateCarousel();
						}

						function movePrev() {
							index = (index - 1 + slides.length) % slides.length;
							updateCarousel();
						}

						nextButton.addEventListener('click', moveNext);
						prevButton.addEventListener('click', movePrev);

						// ðŸ”¹ Auto-play every 3 seconds
						setInterval(moveNext, 6000);

						updateCarousel();
						});
						</script>
						
				<!-- CTA -->
					<section id="cta" class="wrapper style4">
						<div class="inner">
							<header>
								<h2>Arcue ut vel commodo</h2>
								<p>Aliquam ut ex ut augue consectetur interdum endrerit imperdiet amet eleifend fringilla.</p>
							</header>
							<ul class="actions stacked">
								<li><a href="#" class="button fit primary">Activate</a></li>
								<li><a href="#" class="button fit">Learn More</a></li>
							</ul>
						</div>
					</section>

				<!-- Footer -->
					<footer id="footer">
						<ul class="icons">
							<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
							<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
							<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
							<li><a href="#" class="icon brands fa-dribbble"><span class="label">Dribbble</span></a></li>
							<li><a href="#" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
						</ul>
						<ul class="copyright">
							<li>&copy; Untitled</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
						</ul>
					</footer>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script>
// Store PMID -> {llm_summary, main_findings}
var pubmedSummaryData = new Map();
async function fetchPubMedSummaries() {
    try {
        const response = await fetch('../query_pubmed/pubmed_results2.csv');
        if (!response.ok) throw new Error('pubmed_results2.csv not found');
        const csvText = await response.text();
        const lines = csvText.split('\n');
        const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());
        const pmidIndex = headers.indexOf('PMID');
        const summaryIndex = headers.indexOf('llm_summary');
        const findingsIndex = headers.indexOf('main_findings');
        if (pmidIndex === -1 || summaryIndex === -1 || findingsIndex === -1) return;
        for (let i = 1; i < lines.length; i++) {
            if (lines[i].trim() === '') continue;
            const row = lines[i].split(',');
            if (row.length > Math.max(pmidIndex, summaryIndex, findingsIndex)) {
                const pmid = row[pmidIndex].replace(/"/g, '').trim();
                const summary = row[summaryIndex].replace(/"/g, '').trim();
                const findings = row[findingsIndex].replace(/"/g, '').trim();
                if (pmid && (summary || findings)) {
                    pubmedSummaryData.set(pmid, {
                        llm_summary: summary,
                        main_findings: findings
                    });
                }
            }
        }
    } catch (err) {
        console.error('Error loading pubmed_results2.csv:', err);
    }
}
</script>

	</body>

</html>


























